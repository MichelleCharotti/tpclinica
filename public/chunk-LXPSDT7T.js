import{o as G}from"./chunk-TNGGSYNN.js";import{a as Y}from"./chunk-JUPKOMRS.js";import{$ as I,B as P,C as c,D as C,H as m,I as l,K as a,L as s,M as F,N as b,O as f,P as p,U as d,V as D,W as j,aa as T,ba as w,bb as L,ca as M,da as U,la as V,ma as z,na as H,oa as R,p as O,pa as B,qa as $,s as k,u as _,ua as A,v as g,xa as N}from"./chunk-CITMPR77.js";var y=class n{transform(i,...e){return i.nombre+" "+i.apellido}static \u0275fac=function(e){return new(e||n)};static \u0275pipe=k({name:"nombreCompleto",type:n,pure:!0,standalone:!0})};var E=n=>({activo:n});function K(n,i){if(n&1&&(a(0,"p"),d(1),s()),n&2){let e=p().$implicit;c(),D(e.nombre)}}function Q(n,i){if(n&1){let e=b();a(0,"button",6),f("click",function(){let o=_(e).$implicit,r=p();return g(r.seleccionarEspecialidad(o.nombre))}),m(1,K,2,1,"p",7),s()}if(n&2){let e=i.$implicit,t=p();l("ngClass",T(2,E,t.especialidadSeleccionada==e.nombre)),c(),l("ngIf",!e.foto)}}function W(n,i){if(n&1){let e=b();a(0,"button",6),f("click",function(){let o=_(e).$implicit,r=p(2);return g(r.seleccionarEspecialista(o))}),a(1,"p"),d(2),w(3,"nombreCompleto"),s(),F(4,"img",8),s()}if(n&2){let e=i.$implicit,t=p(2);l("ngClass",T(5,E,(t.especialistaSeleccionado==null?null:t.especialistaSeleccionado.id)===e.id)),c(2),D(M(3,3,e)),c(2),l("src",e.imagen1,P)}}function X(n,i){if(n&1&&(a(0,"div",0)(1,"h4"),d(2,"Especialialistas"),s(),a(3,"div",1),m(4,W,5,7,"button",2),s()()),n&2){let e=p();c(4),l("ngForOf",e.especialistas)}}function Z(n,i){if(n&1){let e=b();a(0,"button",10),f("click",function(){let o=_(e).$implicit,r=p(2);return g(r.seleccionarDia(o))}),d(1),w(2,"date"),s()}if(n&2){let e=i.$implicit,t=p(2);l("ngClass",T(6,E,t.diaSeleccionado===e)),c(),j(" ",U(2,2,e,"d/M HH:mm","-0300")," ")}}function ee(n,i){if(n&1&&(a(0,"div",0)(1,"h4"),d(2,"Dias Disponibles"),s(),a(3,"div",1),m(4,Z,3,8,"button",9),s()()),n&2){let e=p();c(4),l("ngForOf",e.diasDisponibles)}}function ie(n,i){if(n&1){let e=b();a(0,"div",11)(1,"div",12)(2,"p"),d(3),s(),a(4,"button",13),f("click",function(){_(e);let o=p();return g(o.finalizarRegistro())}),d(5,"Ok"),s()()()}if(n&2){let e=p();c(3),D(e.mensaje)}}var q=class n{constructor(i,e,t){this.usuario=i;this.db=e;this.router=t;this.usuario.datos?.tipo=="paciente"&&(this._paciente=this.usuario.datos),this.especialidades=this.db.obtenerEspecialidades(),this.subEsp=this.db.obtenerEspecialistas().subscribe(o=>{this._especialistas=o})}_paciente;especialidades;_especialistas;subEsp;especialidadSeleccionada;especialistaSeleccionado;diasDisponibles;diaSeleccionado;mensaje="";set paciente(i){this._paciente=i,this.especialidadSeleccionada=void 0,this.especialistaSeleccionado=void 0,this.diaSeleccionado=void 0,this.diasDisponibles=void 0}ngDestroy(){this.terminarSub()}get especialistas(){return this._especialistas?.filter(i=>i.especialidades&&this.especialidadSeleccionada?i.especialidades.includes(this.especialidadSeleccionada):!1)}seleccionarEspecialidad(i){this.especialidadSeleccionada=i,this.especialistaSeleccionado=void 0,this.diaSeleccionado=void 0,this.diasDisponibles=void 0}seleccionarEspecialista(i){if(this.especialistaSeleccionado=i,this.diaSeleccionado=void 0,this.diasDisponibles=void 0,i.horarios){let e=i.horarios.find(t=>t.especialidad==this.especialidadSeleccionada);this.terminarSub(),this.subEsp=this.db.obtenerTurnosEspecialista(i.id).subscribe(t=>{if(e){let o=this.generarDiasDisponibles(e);this.diasDisponibles=this.filtrarDisponibles(o,t,e.tiempo)}})}}terminarSub(){this.subEsp&&this.subEsp.unsubscribe()}seleccionarDia(i){this.diaSeleccionado=i}sacarTurno(){this._paciente&&this.especialidadSeleccionada&&this.especialistaSeleccionado&&this.diaSeleccionado&&(this.db.agregarTurno(this._paciente,this.especialistaSeleccionado,this.especialidadSeleccionada,this.diaSeleccionado),this.mensaje="Turno Generado Exitosamente")}finalizarRegistro(){this.router.navigate(["/perfil"])}generarDiasDisponibles(i){let e=[];if(i){let t=new Date;t.setHours(3,0,0,1);let o=["domingo","lunes","martes","miercoles","jueves","viernes","sabado"];for(let r=0;r<15;r++){t.setDate(t.getDate()+1);let h=o[t.getDay()],u=i.dias.find(x=>x.nombre.toLowerCase()===h.toLowerCase());if(u&&u.estado){let x=new Date(t);x.setHours(u.inicio+3,0,0,0);let S=new Date(t);S.setHours(u.fin+3,0,0,0),S.setMinutes(S.getMinutes()-i.tiempo);let v=new Date(x);for(;v<=S;)e.push(new Date(v)),v.setMinutes(v.getMinutes()+i.tiempo)}}}return e}filtrarDisponibles(i,e,t){let o=[];for(let r of i){let h=!0;for(let u of e)if(u.estado!=4&&u.estado!=3&&u.estado!=2&&u.estado!=5&&this.compararTurnoFecha(r,u,t)){h=!1;break}h&&o.push(r)}return o}compararTurnoFecha(i,e,t){if(e.fecha=new Date(e.fecha),i.getDay()==e.fecha.getDay()&&i.getMonth()==e.fecha.getMonth()&&i.getFullYear()==e.fecha.getFullYear()){let o=new Date(i);o.setMinutes(i.getMinutes()+t);let r=new Date(e.fecha);return r.setMinutes(e.fecha.getMinutes()+e.duracion),!(r<=i||e.fecha>=o)}return!1}static \u0275fac=function(e){return new(e||n)(C(Y),C(L),C(A))};static \u0275cmp=O({type:n,selectors:[["app-solicitar-turno"]],inputs:{paciente:"paciente"},standalone:!0,features:[I],decls:13,vars:7,consts:[[1,"titulo"],[1,"opciones"],["class","opciones-imagen",3,"ngClass","click",4,"ngFor","ngForOf"],["class","titulo",4,"ngIf"],[3,"click","disabled"],["class","pantalla-completa",4,"ngIf"],[1,"opciones-imagen",3,"click","ngClass"],[4,"ngIf"],[3,"src"],[3,"ngClass","click",4,"ngFor","ngForOf"],[3,"click","ngClass"],[1,"pantalla-completa"],[1,"mensaje"],[3,"click"]],template:function(e,t){e&1&&(a(0,"h3"),d(1,"Solicitar Turnos"),s(),a(2,"div",0)(3,"h4"),d(4,"Especialidades"),s(),a(5,"div",1),m(6,Q,2,4,"button",2),w(7,"async"),s()(),m(8,X,5,1,"div",3)(9,ee,5,1,"div",3),a(10,"button",4),f("click",function(){return t.sacarTurno()}),d(11,"Sacar Turno"),s(),m(12,ie,6,1,"div",5)),e&2&&(c(6),l("ngForOf",M(7,5,t.especialidades)),c(2),l("ngIf",t.especialidadSeleccionada),c(),l("ngIf",t.especialistaSeleccionado),c(),l("disabled",!(t.diaSeleccionado&&t.especialidadSeleccionada&&t.especialistaSeleccionado)),c(2),l("ngIf",t.mensaje))},dependencies:[N,$,V,z,H,R,B,G,y],styles:["[_nghost-%COMP%]{display:flex;align-items:center;flex-direction:column}button[_ngcontent-%COMP%]{margin:5px;width:150px;padding:10px 0;border:none;border-radius:5px;font-size:1rem;font-weight:700;cursor:pointer}.activo[_ngcontent-%COMP%]{background-color:#3485c3;color:#fff}.titulo[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column}.opciones[_ngcontent-%COMP%]{background-color:#f5f5f5;display:flex;align-items:center;justify-content:center;flex-wrap:wrap;max-height:50vh;max-width:80vw;padding:5px;border-radius:10px;border:1px solid grey;overflow-y:auto}.mensaje[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;width:400px;background-color:#f5f5f5;border-radius:25px;border:1px solid black}.mensaje[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:20px;font-weight:700;text-align:center}.mensaje[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:60%;margin:10px;border-radius:10px;background-color:#3485c3;color:#fff}.mensaje[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#2f75aa}.pantalla-completa[_ngcontent-%COMP%]{position:absolute;display:flex;justify-content:center;align-items:center;top:0%;width:100vw;height:100vh;background-color:#3485c333}.opciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:70px;height:70px}.opciones-imagen[_ngcontent-%COMP%]{width:200px;height:110px}.opciones-imagen[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;margin:0;text-transform:capitalize}"]})};export{y as a,q as b};
