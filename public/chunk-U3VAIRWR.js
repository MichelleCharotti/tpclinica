import{C as Nt,H as Ot,J as Ke,L as $h,a as Mh,b as Fh,c as qg,d as Ct,e as g,f as Nr,h as Uh,i as Bh,j as Qo,k as Jo,l as Yo,la as jh,ma as zh,n as Or,p as qh,s as Cn,u as kt,w as Dt,y as ge}from"./chunk-K7SDNGR6.js";var ey={};qg(ey,{FirebaseError:()=>Te,SDK_VERSION:()=>qe,_DEFAULT_ENTRY_NAME:()=>Mr,_addComponent:()=>_a,_addOrOverwriteComponent:()=>z_,_apps:()=>Vt,_clearComponents:()=>G_,_components:()=>On,_getProvider:()=>lt,_isFirebaseApp:()=>yd,_isFirebaseServerApp:()=>Le,_registerComponent:()=>Be,_removeServiceInstance:()=>_d,_serverApps:()=>Nn,deleteApp:()=>wa,getApp:()=>ht,getApps:()=>Ur,initializeApp:()=>Yi,initializeServerApp:()=>Id,onLog:()=>vd,registerVersion:()=>Z,setLogLevel:()=>wd});var Wh=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},$g=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=n[t++],a=n[t++],u=n[t++],l=((i&7)<<18|(s&63)<<12|(a&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{let s=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|a&63)}}return e.join("")},Kh={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let s=n[i],a=i+1<n.length,u=a?n[i+1]:0,l=i+2<n.length,d=l?n[i+2]:0,p=s>>2,I=(s&3)<<4|u>>4,w=(u&15)<<2|d>>6,R=d&63;l||(R=64,a||(w=64)),r.push(t[p],t[I],t[w],t[R])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Wh(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):$g(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let s=t[n.charAt(i++)],u=i<n.length?t[n.charAt(i)]:0;++i;let d=i<n.length?t[n.charAt(i)]:64;++i;let I=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||u==null||d==null||I==null)throw new Zo;let w=s<<2|u>>4;if(r.push(w),d!==64){let R=u<<4&240|d>>2;if(r.push(R),I!==64){let k=d<<6&192|I;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},Zo=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},jg=function(n){let e=Wh(n);return Kh.encodeByteArray(e,!0)},xr=function(n){return jg(n).replace(/\./g,"")},ta=function(n){try{return Kh.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function zg(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:let t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(let t in e)!e.hasOwnProperty(t)||!Gg(t)||(n[t]=zg(n[t],e[t]));return n}function Gg(n){return n!=="__proto__"}function Wg(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var Kg=()=>Wg().__FIREBASE_DEFAULTS__,Hg=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Qg=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&ta(n[1]);return e&&JSON.parse(e)},Gi=()=>{try{return Kg()||Hg()||Qg()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},na=n=>{var e,t;return(t=(e=Gi())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},Wi=n=>{let e=na(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},ra=()=>{var n;return(n=Gi())===null||n===void 0?void 0:n.config},ia=n=>{var e;return(e=Gi())===null||e===void 0?void 0:e[`_${n}`]};var zi=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function Ki(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[xr(JSON.stringify(t)),xr(JSON.stringify(a)),""].join(".")}function fe(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Hh(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(fe())}function Jg(){var n;let e=(n=Gi())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Qh(){return typeof window<"u"||sa()}function sa(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Jh(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Yh(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Xh(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Zh(){let n=fe();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function ed(){return!Jg()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function oa(){try{return typeof indexedDB=="object"}catch{return!1}}function td(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}var Yg="FirebaseError",Te=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Yg,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ct.prototype.create)}},ct=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],a=s?Xg(s,r):"Error",u=`${this.serviceName}: ${a} (${i}).`;return new Te(i,u,r)}};function Xg(n,e){return n.replace(Zg,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var Zg=/\{\$([^}]+)}/g;function oA(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function nd(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Zt(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let s=n[i],a=e[i];if(Gh(s)&&Gh(a)){if(!Zt(s,a))return!1}else if(s!==a)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function Gh(n){return n!==null&&typeof n=="object"}function Vr(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function kn(n){let e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){let[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function Dn(n){let e=n.indexOf("?");if(!e)return"";let t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function rd(n,e){let t=new ea(n,e);return t.subscribe.bind(t)}var ea=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");e_(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=Xo),i.error===void 0&&(i.error=Xo),i.complete===void 0&&(i.complete=Xo);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function e_(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Xo(){}var aA=4*60*60*1e3;function te(n){return n&&n._delegate?n._delegate:n}var ke=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var en="[DEFAULT]";var aa=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new zi;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(e?.identifier),i=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(n_(e))try{this.getOrInitializeService({instanceIdentifier:en})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=en){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return g(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=en){return this.instances.has(e)}getOptions(e=en){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[s,a]of this.instancesDeferred.entries()){let u=this.normalizeInstanceIdentifier(s);r===u&&a.resolve(i)}return i}onInit(e,t){var r;let i=this.normalizeInstanceIdentifier(t),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);let a=this.instances.get(i);return a&&e(a,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:t_(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=en){return this.component?this.component.multipleInstances?e:en:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function t_(n){return n===en?void 0:n}function n_(n){return n.instantiationMode==="EAGER"}var Lr=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new aa(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var ca=[],G=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(G||{}),id={debug:G.DEBUG,verbose:G.VERBOSE,info:G.INFO,warn:G.WARN,error:G.ERROR,silent:G.SILENT},r_=G.INFO,i_={[G.DEBUG]:"log",[G.VERBOSE]:"log",[G.INFO]:"info",[G.WARN]:"warn",[G.ERROR]:"error"},s_=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=i_[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},xt=class{constructor(e){this.name=e,this._logLevel=r_,this._logHandler=s_,this._userLogHandler=null,ca.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in G))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?id[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,G.DEBUG,...e),this._logHandler(this,G.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,G.VERBOSE,...e),this._logHandler(this,G.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,G.INFO,...e),this._logHandler(this,G.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,G.WARN,...e),this._logHandler(this,G.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,G.ERROR,...e),this._logHandler(this,G.ERROR,...e)}};function sd(n){ca.forEach(e=>{e.setLogLevel(n)})}function od(n,e){for(let t of ca){let r=null;e&&e.level&&(r=id[e.level]),n===null?t.userLogHandler=null:t.userLogHandler=(i,s,...a)=>{let u=a.map(l=>{if(l==null)return null;if(typeof l=="string")return l;if(typeof l=="number"||typeof l=="boolean")return l.toString();if(l instanceof Error)return l.message;try{return JSON.stringify(l)}catch{return null}}).filter(l=>l).join(" ");s>=(r??i.logLevel)&&n({level:G[s].toLowerCase(),message:u,args:a,type:i.name})}}}var o_=(n,e)=>e.some(t=>n instanceof t),ad,cd;function a_(){return ad||(ad=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function c_(){return cd||(cd=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var ud=new WeakMap,la=new WeakMap,ld=new WeakMap,ua=new WeakMap,da=new WeakMap;function u_(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",a)},s=()=>{t(He(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&ud.set(t,n)}).catch(()=>{}),da.set(e,n),e}function l_(n){if(la.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",a),n.removeEventListener("abort",a)},s=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",a),n.addEventListener("abort",a)});la.set(n,e)}var ha={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return la.get(n);if(e==="objectStoreNames")return n.objectStoreNames||ld.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return He(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function hd(n){ha=n(ha)}function h_(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(Hi(this),e,...t);return ld.set(r,e.sort?e.sort():[e]),He(r)}:c_().includes(n)?function(...e){return n.apply(Hi(this),e),He(ud.get(this))}:function(...e){return He(n.apply(Hi(this),e))}}function d_(n){return typeof n=="function"?h_(n):(n instanceof IDBTransaction&&l_(n),o_(n,a_())?new Proxy(n,ha):n)}function He(n){if(n instanceof IDBRequest)return u_(n);if(ua.has(n))return ua.get(n);let e=d_(n);return e!==n&&(ua.set(n,e),da.set(e,n)),e}var Hi=n=>da.get(n);function fd(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){let a=indexedDB.open(n,e),u=He(a);return r&&a.addEventListener("upgradeneeded",l=>{r(He(a.result),l.oldVersion,l.newVersion,He(a.transaction),l)}),t&&a.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),u.then(l=>{s&&l.addEventListener("close",()=>s()),i&&l.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}var f_=["get","getKey","getAll","getAllKeys","count"],p_=["put","add","delete","clear"],fa=new Map;function dd(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(fa.get(e))return fa.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=p_.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||f_.includes(t)))return;let s=function(a,...u){return g(this,null,function*(){let l=this.transaction(a,i?"readwrite":"readonly"),d=l.store;return r&&(d=d.index(u.shift())),(yield Promise.all([d[t](...u),i&&l.done]))[0]})};return fa.set(e,s),s}hd(n=>Fh(Mh({},n),{get:(e,t,r)=>dd(e,t)||n.get(e,t,r),has:(e,t)=>!!dd(e,t)||n.has(e,t)}));var ma=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(m_(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function m_(n){let e=n.getComponent();return e?.type==="VERSION"}var Qi="@firebase/app",ga="0.10.13";var ut=new xt("@firebase/app"),g_="@firebase/app-compat",__="@firebase/analytics-compat",y_="@firebase/analytics",I_="@firebase/app-check-compat",v_="@firebase/app-check",w_="@firebase/auth",E_="@firebase/auth-compat",T_="@firebase/database",A_="@firebase/data-connect",b_="@firebase/database-compat",S_="@firebase/functions",R_="@firebase/functions-compat",P_="@firebase/installations",C_="@firebase/installations-compat",k_="@firebase/messaging",D_="@firebase/messaging-compat",N_="@firebase/performance",O_="@firebase/performance-compat",x_="@firebase/remote-config",V_="@firebase/remote-config-compat",L_="@firebase/storage",M_="@firebase/storage-compat",F_="@firebase/firestore",U_="@firebase/vertexai-preview",B_="@firebase/firestore-compat",q_="firebase",$_="10.14.1";var Mr="[DEFAULT]",j_={[Qi]:"fire-core",[g_]:"fire-core-compat",[y_]:"fire-analytics",[__]:"fire-analytics-compat",[v_]:"fire-app-check",[I_]:"fire-app-check-compat",[w_]:"fire-auth",[E_]:"fire-auth-compat",[T_]:"fire-rtdb",[A_]:"fire-data-connect",[b_]:"fire-rtdb-compat",[S_]:"fire-fn",[R_]:"fire-fn-compat",[P_]:"fire-iid",[C_]:"fire-iid-compat",[k_]:"fire-fcm",[D_]:"fire-fcm-compat",[N_]:"fire-perf",[O_]:"fire-perf-compat",[x_]:"fire-rc",[V_]:"fire-rc-compat",[L_]:"fire-gcs",[M_]:"fire-gcs-compat",[F_]:"fire-fst",[B_]:"fire-fst-compat",[U_]:"fire-vertex","fire-js":"fire-js",[q_]:"fire-js-all"};var Vt=new Map,Nn=new Map,On=new Map;function _a(n,e){try{n.container.addComponent(e)}catch(t){ut.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function z_(n,e){n.container.addOrOverwriteComponent(e)}function Be(n){let e=n.name;if(On.has(e))return ut.debug(`There were multiple attempts to register component ${e}.`),!1;On.set(e,n);for(let t of Vt.values())_a(t,n);for(let t of Nn.values())_a(t,n);return!0}function lt(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function _d(n,e,t=Mr){lt(n,e).clearInstance(t)}function yd(n){return n.options!==void 0}function Le(n){return n.settings!==void 0}function G_(){On.clear()}var W_={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ve=new ct("app","Firebase",W_);var Ji=class{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ke("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ve.create("app-deleted",{appName:this._name})}};var ya=class extends Ji{constructor(e,t,r,i){let s=t.automaticDataCollectionEnabled!==void 0?t.automaticDataCollectionEnabled:!1,a={name:r,automaticDataCollectionEnabled:s};if(e.apiKey!==void 0)super(e,a,i);else{let u=e;super(u.options,a,i)}this._serverConfig=Object.assign({automaticDataCollectionEnabled:s},t),this._finalizationRegistry=null,typeof FinalizationRegistry<"u"&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,Z(Qi,ga,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,e!==void 0&&this._finalizationRegistry!==null&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){wa(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw Ve.create("server-app-deleted")}};var qe=$_;function Yi(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=Object.assign({name:Mr,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw Ve.create("bad-app-name",{appName:String(i)});if(t||(t=ra()),!t)throw Ve.create("no-options");let s=Vt.get(i);if(s){if(Zt(t,s.options)&&Zt(r,s.config))return s;throw Ve.create("duplicate-app",{appName:i})}let a=new Lr(i);for(let l of On.values())a.addComponent(l);let u=new Ji(t,r,a);return Vt.set(i,u),u}function Id(n,e){if(Qh()&&!sa())throw Ve.create("invalid-server-app-environment");e.automaticDataCollectionEnabled===void 0&&(e.automaticDataCollectionEnabled=!1);let t;yd(n)?t=n.options:t=n;let r=Object.assign(Object.assign({},e),t);r.releaseOnDeref!==void 0&&delete r.releaseOnDeref;let i=d=>[...d].reduce((p,I)=>Math.imul(31,p)+I.charCodeAt(0)|0,0);if(e.releaseOnDeref!==void 0&&typeof FinalizationRegistry>"u")throw Ve.create("finalization-registry-not-supported",{});let s=""+i(JSON.stringify(r)),a=Nn.get(s);if(a)return a.incRefCount(e.releaseOnDeref),a;let u=new Lr(s);for(let d of On.values())u.addComponent(d);let l=new ya(t,e,s,u);return Nn.set(s,l),l}function ht(n=Mr){let e=Vt.get(n);if(!e&&n===Mr&&ra())return Yi();if(!e)throw Ve.create("no-app",{appName:n});return e}function Ur(){return Array.from(Vt.values())}function wa(n){return g(this,null,function*(){let e=!1,t=n.name;Vt.has(t)?(e=!0,Vt.delete(t)):Nn.has(t)&&n.decRefCount()<=0&&(Nn.delete(t),e=!0),e&&(yield Promise.all(n.container.getProviders().map(r=>r.delete())),n.isDeleted=!0)})}function Z(n,e,t){var r;let i=(r=j_[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);let s=i.match(/\s|\//),a=e.match(/\s|\//);if(s||a){let u=[`Unable to register library "${i}" with version "${e}":`];s&&u.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&a&&u.push("and"),a&&u.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ut.warn(u.join(" "));return}Be(new ke(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}function vd(n,e){if(n!==null&&typeof n!="function")throw Ve.create("invalid-log-argument");od(n,e)}function wd(n){sd(n)}var K_="firebase-heartbeat-database",H_=1,Fr="firebase-heartbeat-store",pa=null;function Ed(){return pa||(pa=fd(K_,H_,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Fr)}catch(t){console.warn(t)}}}}).catch(n=>{throw Ve.create("idb-open",{originalErrorMessage:n.message})})),pa}function Q_(n){return g(this,null,function*(){try{let t=(yield Ed()).transaction(Fr),r=yield t.objectStore(Fr).get(Td(n));return yield t.done,r}catch(e){if(e instanceof Te)ut.warn(e.message);else{let t=Ve.create("idb-get",{originalErrorMessage:e?.message});ut.warn(t.message)}}})}function pd(n,e){return g(this,null,function*(){try{let r=(yield Ed()).transaction(Fr,"readwrite");yield r.objectStore(Fr).put(e,Td(n)),yield r.done}catch(t){if(t instanceof Te)ut.warn(t.message);else{let r=Ve.create("idb-set",{originalErrorMessage:t?.message});ut.warn(r.message)}}})}function Td(n){return`${n.name}!${n.options.appId}`}var J_=1024,Y_=30*24*60*60*1e3,Ia=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new va(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return g(this,null,function*(){var e,t;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=md();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(a=>a.date===s)?void 0:(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{let u=new Date(a.date).valueOf();return Date.now()-u<=Y_}),this._storage.overwrite(this._heartbeatsCache))}catch(r){ut.warn(r)}})}getHeartbeatsHeader(){return g(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=md(),{heartbeatsToSend:r,unsentEntries:i}=X_(this._heartbeatsCache.heartbeats),s=xr(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return ut.warn(t),""}})}};function md(){return new Date().toISOString().substring(0,10)}function X_(n,e=J_){let t=[],r=n.slice();for(let i of n){let s=t.find(a=>a.agent===i.agent);if(s){if(s.dates.push(i.date),gd(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),gd(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var va=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return g(this,null,function*(){return oa()?td().then(()=>!0).catch(()=>!1):!1})}read(){return g(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield Q_(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return g(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return pd(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return g(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return pd(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return})}};function gd(n){return xr(JSON.stringify({version:2,heartbeats:n})).length}function Z_(n){Be(new ke("platform-logger",e=>new ma(e),"PRIVATE")),Be(new ke("heartbeat",e=>new Ia(e),"PRIVATE")),Z(Qi,ga,n),Z(Qi,ga,"esm2017"),Z("fire-js","")}Z_("");var ty="firebase",ny="10.14.1";Z(ty,ny,"app");var dt=new jh("ANGULARFIRE2_VERSION");function Vn(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(a=>a.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var nn=(n,e)=>{let t=e?[e]:Ur(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(a=>{r.includes(a)||r.push(a)})}),r},Lt=class{constructor(){return nn(ry)}},ry="app-check";function xn(){}var Xi=class{zone;delegate;constructor(e,t=Bh){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(a){i.runGuarded(()=>{e.apply(this,[a])})};return this.delegate.schedule(s,t,r)}},Ea=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",xn,{},xn,xn)),t.pipe(qh({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},Mt=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new Xi(Zone.current)),this.insideAngular=t.run(()=>new Xi(Zone.current,Uh)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(Dt(Ke))};static \u0275prov=Cn({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Zi(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function iy(n){return Zi().ngZone.runOutsideAngular(()=>n())}function tn(n){return Zi().ngZone.run(()=>n())}function sy(n){return oy(Zi())(n)}function oy(n){return function(t){return t=t.lift(new Ea(n.ngZone)),t.pipe(Yo(n.outsideAngular),Jo(n.insideAngular))}}var ay=(n,e)=>function(){let r=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),tn(()=>n.apply(void 0,r))},ne=(n,e)=>function(){let t,r=arguments;for(let s=0;s<arguments.length;s++)typeof r[s]=="function"&&(e&&(t||=tn(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",xn,{},xn,xn))),r[s]=ay(r[s],t));let i=iy(()=>n.apply(this,r));if(!e)if(i instanceof Nr){let s=Zi();return i.pipe(Yo(s.outsideAngular),Jo(s.insideAngular))}else return tn(()=>i);return i instanceof Nr?i.pipe(sy):i instanceof Promise?tn(()=>new Promise((s,a)=>i.then(u=>tn(()=>s(u)),u=>tn(()=>a(u))))):typeof i=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),i.apply(this,arguments)}:tn(()=>i)};var $e=class{constructor(e){return e}},ft=class{constructor(){return Ur()}};function cy(n){return n&&n.length===1?n[0]:new $e(ht())}var Ta=new kt("angularfire2._apps"),uy={provide:$e,useFactory:cy,deps:[[new ge,Ta]]},ly={provide:ft,deps:[[new ge,Ta]]};function hy(n){return(e,t)=>{let r=t.get($h);Z("angularfire",dt.full,"core"),Z("angularfire",dt.full,"app"),Z("angular",zh.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new $e(i)}}function FA(n,...e){return Nt([uy,ly,{provide:Ta,useFactory:hy(n),multi:!0,deps:[Ke,Ot,Mt,...e]}])}var UA=ne(Yi,!0);function qd(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var $d=qd,jd=new ct("auth","Firebase",qd());var ss=new xt("@firebase/auth");function dy(n,...e){ss.logLevel<=G.WARN&&ss.warn(`Auth (${qe}): ${n}`,...e)}function ts(n,...e){ss.logLevel<=G.ERROR&&ss.error(`Auth (${qe}): ${n}`,...e)}function Je(n,...e){throw Wa(n,...e)}function rn(n,...e){return Wa(n,...e)}function zd(n,e,t){let r=Object.assign(Object.assign({},$d()),{[e]:t});return new ct("auth","Firebase",r).create(e,{appName:n.name})}function gt(n){return zd(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Wa(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return jd.create(n,...e)}function F(n,e,...t){if(!n)throw Wa(e,...t)}function pt(n){let e="INTERNAL ASSERTION FAILED: "+n;throw ts(e),new Error(e)}function Ut(n,e){n||pt(e)}function Ra(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function fy(){return bd()==="http:"||bd()==="https:"}function bd(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function py(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(fy()||Yh()||"connection"in navigator)?navigator.onLine:!0}function my(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var sn=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ut(t>e,"Short delay should be less than long delay!"),this.isMobile=Hh()||Xh()}get(){return py()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function Ka(n,e){Ut(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var os=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;pt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;pt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;pt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var gy={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var _y=new sn(3e4,6e4);function _t(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function yt(s,a,u,l){return g(this,arguments,function*(n,e,t,r,i={}){return Gd(n,i,()=>g(this,null,function*(){let d={},p={};r&&(e==="GET"?p=r:d={body:JSON.stringify(r)});let I=Vr(Object.assign({key:n.config.apiKey},p)).slice(1),w=yield n._getAdditionalHeaders();w["Content-Type"]="application/json",n.languageCode&&(w["X-Firebase-Locale"]=n.languageCode);let R=Object.assign({method:e,headers:w},d);return Jh()||(R.referrerPolicy="no-referrer"),os.fetch()(Wd(n,n.config.apiHost,t,I),R)}))})}function Gd(n,e,t){return g(this,null,function*(){n._canInitEmulator=!1;let r=Object.assign(Object.assign({},gy),e);try{let i=new Pa(n),s=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let a=yield s.json();if("needConfirmation"in a)throw es(n,"account-exists-with-different-credential",a);if(s.ok&&!("errorMessage"in a))return a;{let u=s.ok?a.errorMessage:a.error.message,[l,d]=u.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw es(n,"credential-already-in-use",a);if(l==="EMAIL_EXISTS")throw es(n,"email-already-in-use",a);if(l==="USER_DISABLED")throw es(n,"user-disabled",a);let p=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw zd(n,p,d);Je(n,p)}}catch(i){if(i instanceof Te)throw i;Je(n,"network-request-failed",{message:String(i)})}})}function Kr(s,a,u,l){return g(this,arguments,function*(n,e,t,r,i={}){let d=yield yt(n,e,t,r,i);return"mfaPendingCredential"in d&&Je(n,"multi-factor-auth-required",{_serverResponse:d}),d})}function Wd(n,e,t,r){let i=`${e}${t}?${r}`;return n.config.emulator?Ka(n.config,i):`${n.config.apiScheme}://${i}`}function yy(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}var Pa=class{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(rn(this.auth,"network-request-failed")),_y.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}};function es(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=rn(n,e,r);return i.customData._tokenResponse=t,i}function Sd(n){return n!==void 0&&n.enterprise!==void 0}var Ca=class{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return yy(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}};function Iy(n,e){return g(this,null,function*(){return yt(n,"GET","/v2/recaptchaConfig",_t(n,e))})}function vy(n,e){return g(this,null,function*(){return yt(n,"POST","/v1/accounts:delete",e)})}function Kd(n,e){return g(this,null,function*(){return yt(n,"POST","/v1/accounts:lookup",e)})}function Br(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function Ha(n,e=!1){return g(this,null,function*(){let t=te(n),r=yield t.getIdToken(e),i=Qa(r);F(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let s=typeof i.firebase=="object"?i.firebase:void 0,a=s?.sign_in_provider;return{claims:i,token:r,authTime:Br(Aa(i.auth_time)),issuedAtTime:Br(Aa(i.iat)),expirationTime:Br(Aa(i.exp)),signInProvider:a||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function Aa(n){return Number(n)*1e3}function Qa(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return ts("JWT malformed, contained fewer than 3 sections"),null;try{let i=ta(t);return i?JSON.parse(i):(ts("Failed to decode base64 JWT payload"),null)}catch(i){return ts("Caught error parsing JWT payload as JSON",i?.toString()),null}}function Rd(n){let e=Qa(n);return F(e,"internal-error"),F(typeof e.exp<"u","internal-error"),F(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function $r(n,e,t=!1){return g(this,null,function*(){if(t)return e;try{return yield e}catch(r){throw r instanceof Te&&wy(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function wy({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var ka=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;let i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>g(this,null,function*(){yield this.iteration()}),t)}iteration(){return g(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var jr=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Br(this.lastLoginAt),this.creationTime=Br(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function as(n){return g(this,null,function*(){var e;let t=n.auth,r=yield n.getIdToken(),i=yield $r(n,Kd(t,{idToken:r}));F(i?.users.length,t,"internal-error");let s=i.users[0];n._notifyReloadListener(s);let a=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?Hd(s.providerUserInfo):[],u=Ey(n.providerData,a),l=n.isAnonymous,d=!(n.email&&s.passwordHash)&&!u?.length,p=l?d:!1,I={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:u,metadata:new jr(s.createdAt,s.lastLoginAt),isAnonymous:p};Object.assign(n,I)})}function Ja(n){return g(this,null,function*(){let e=te(n);yield as(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function Ey(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function Hd(n){return n.map(e=>{var{providerId:t}=e,r=Qo(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}function Ty(n,e){return g(this,null,function*(){let t=yield Gd(n,{},()=>g(this,null,function*(){let r=Vr({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,a=Wd(n,i,"/v1/token",`key=${s}`),u=yield n._getAdditionalHeaders();return u["Content-Type"]="application/x-www-form-urlencoded",os.fetch()(a,{method:"POST",headers:u,body:r})}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function Ay(n,e){return g(this,null,function*(){return yt(n,"POST","/v2/accounts:revokeToken",_t(n,e))})}var qr=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){F(e.idToken,"internal-error"),F(typeof e.idToken<"u","internal-error"),F(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Rd(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){F(e.length!==0,"internal-error");let t=Rd(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return g(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(F(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return g(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:s}=yield Ty(e,t);this.updateTokensAndExpiration(r,i,Number(s))})}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:s}=t,a=new n;return r&&(F(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(F(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),s&&(F(typeof s=="number","internal-error",{appName:e}),a.expirationTime=s),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return pt("not implemented")}};function Ft(n,e){F(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var Ln=class n{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,s=Qo(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ka(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new jr(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){return g(this,null,function*(){let t=yield $r(this,this.stsTokenManager.getToken(this.auth,e));return F(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return Ha(this,e)}reload(){return Ja(this)}_assign(e){this!==e&&(F(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){F(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return g(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield as(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return g(this,null,function*(){if(Le(this.auth.app))return Promise.reject(gt(this.auth));let e=yield this.getIdToken();return yield $r(this,vy(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,s,a,u,l,d,p;let I=(r=t.displayName)!==null&&r!==void 0?r:void 0,w=(i=t.email)!==null&&i!==void 0?i:void 0,R=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,k=(a=t.photoURL)!==null&&a!==void 0?a:void 0,O=(u=t.tenantId)!==null&&u!==void 0?u:void 0,C=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,U=(d=t.createdAt)!==null&&d!==void 0?d:void 0,q=(p=t.lastLoginAt)!==null&&p!==void 0?p:void 0,{uid:M,emailVerified:j,isAnonymous:ae,providerData:W,stsTokenManager:E}=t;F(M&&E,e,"internal-error");let m=qr.fromJSON(this.name,E);F(typeof M=="string",e,"internal-error"),Ft(I,e.name),Ft(w,e.name),F(typeof j=="boolean",e,"internal-error"),F(typeof ae=="boolean",e,"internal-error"),Ft(R,e.name),Ft(k,e.name),Ft(O,e.name),Ft(C,e.name),Ft(U,e.name),Ft(q,e.name);let _=new n({uid:M,auth:e,email:w,emailVerified:j,displayName:I,isAnonymous:ae,photoURL:k,phoneNumber:R,tenantId:O,stsTokenManager:m,createdAt:U,lastLoginAt:q});return W&&Array.isArray(W)&&(_.providerData=W.map(v=>Object.assign({},v))),C&&(_._redirectEventId=C),_}static _fromIdTokenResponse(e,t,r=!1){return g(this,null,function*(){let i=new qr;i.updateFromServerResponse(t);let s=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield as(s),s})}static _fromGetAccountInfoResponse(e,t,r){return g(this,null,function*(){let i=t.users[0];F(i.localId!==void 0,"internal-error");let s=i.providerUserInfo!==void 0?Hd(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!s?.length,u=new qr;u.updateFromIdToken(r);let l=new n({uid:i.localId,auth:e,stsTokenManager:u,isAnonymous:a}),d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new jr(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(l,d),l})}};var Pd=new Map;function mt(n){Ut(n instanceof Function,"Expected a class definition");let e=Pd.get(n);return e?(Ut(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Pd.set(n,e),e)}var by=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return g(this,null,function*(){return!0})}_set(t,r){return g(this,null,function*(){this.storage[t]=r})}_get(t){return g(this,null,function*(){let r=this.storage[t];return r===void 0?null:r})}_remove(t){return g(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),Da=by;function ns(n,e,t){return`firebase:${n}:${e}:${t}`}var cs=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:s}=this.auth;this.fullUserKey=ns(this.userKey,i.apiKey,s),this.fullPersistenceKey=ns("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return g(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);return e?Ln._fromJSON(this.auth,e):null})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return g(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return g(this,null,function*(){if(!t.length)return new n(mt(Da),e,r);let i=(yield Promise.all(t.map(d=>g(this,null,function*(){if(yield d._isAvailable())return d})))).filter(d=>d),s=i[0]||mt(Da),a=ns(r,e.config.apiKey,e.name),u=null;for(let d of t)try{let p=yield d._get(a);if(p){let I=Ln._fromJSON(e,p);d!==s&&(u=I),s=d;break}}catch{}let l=i.filter(d=>d._shouldAllowMigration);return!s._shouldAllowMigration||!l.length?new n(s,e,r):(s=l[0],u&&(yield s._set(a,u.toJSON())),yield Promise.all(t.map(d=>g(this,null,function*(){if(d!==s)try{yield d._remove(a)}catch{}}))),new n(s,e,r))})}};function Cd(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Xd(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Qd(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(ef(e))return"Blackberry";if(tf(e))return"Webos";if(Jd(e))return"Safari";if((e.includes("chrome/")||Yd(e))&&!e.includes("edge/"))return"Chrome";if(Zd(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Qd(n=fe()){return/firefox\//i.test(n)}function Jd(n=fe()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Yd(n=fe()){return/crios\//i.test(n)}function Xd(n=fe()){return/iemobile/i.test(n)}function Zd(n=fe()){return/android/i.test(n)}function ef(n=fe()){return/blackberry/i.test(n)}function tf(n=fe()){return/webos/i.test(n)}function Ya(n=fe()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Sy(n=fe()){var e;return Ya(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Ry(){return Zh()&&document.documentMode===10}function nf(n=fe()){return Ya(n)||Zd(n)||tf(n)||ef(n)||/windows phone/i.test(n)||Xd(n)}function rf(n,e=[]){let t;switch(n){case"Browser":t=Cd(fe());break;case"Worker":t=`${Cd(fe())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${qe}/${r}`}var Na=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=s=>new Promise((a,u)=>{try{let l=e(s);a(l)}catch(l){u(l)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return g(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)yield r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function Py(t){return g(this,arguments,function*(n,e={}){return yt(n,"GET","/v2/passwordPolicy",_t(n,e))})}var Cy=6,Oa=class{constructor(e){var t,r,i,s;let a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:Cy,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,s,a,u;let l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(i=l.containsLowercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(s=l.containsUppercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(a=l.containsNumericCharacter)!==null&&a!==void 0?a:!0),l.isValid&&(l.isValid=(u=l.containsNonAlphanumericCharacter)!==null&&u!==void 0?u:!0),l}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};var xa=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new us(this),this.idTokenSubscription=new us(this),this.beforeStateQueue=new Na(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=jd,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=mt(t)),this._initializationPromise=this.queue(()=>g(this,null,function*(){var r,i;if(!this._deleted&&(this.persistenceManager=yield cs.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return g(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return g(this,null,function*(){try{let t=yield Kd(this,{idToken:e}),r=yield Ln._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return g(this,null,function*(){var t;if(Le(this.app)){let a=this.app.settings.authIdToken;return a?new Promise(u=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(u,u))}):this.directlySetCurrentUser(null)}let r=yield this.assertedPersistence.getCurrentUser(),i=r,s=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,u=i?._redirectEventId,l=yield this.tryRedirectSignIn(e);(!a||a===u)&&l?.user&&(i=l.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{yield this.beforeStateQueue.runMiddleware(i)}catch(a){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return F(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(e){return g(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return g(this,null,function*(){try{yield as(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=my()}_delete(){return g(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return g(this,null,function*(){if(Le(this.app))return Promise.reject(gt(this));let t=e?te(e):null;return t&&F(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return g(this,null,function*(){if(!this._deleted)return e&&F(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>g(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return g(this,null,function*(){return Le(this.app)?Promise.reject(gt(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return Le(this.app)?Promise.reject(gt(this)):this.queue(()=>g(this,null,function*(){yield this.assertedPersistence.setPersistence(mt(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return g(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return g(this,null,function*(){let e=yield Py(this),t=new Oa(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new ct("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){return g(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),yield Ay(this,r)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return g(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return g(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&mt(e)||this._popupRedirectResolver;F(t,this,"argument-error"),this.redirectPersistenceManager=yield cs.create(this,[mt(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return g(this,null,function*(){var t,r;return this._isInitialized&&(yield this.queue(()=>g(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return g(this,null,function*(){if(e===this.currentUser)return this.queue(()=>g(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),a=!1,u=this._isInitialized?Promise.resolve():this._initializationPromise;if(F(u,this,"internal-error"),u.then(()=>{a||s(this.currentUser)}),typeof t=="function"){let l=e.addObserver(t,r,i);return()=>{a=!0,l()}}else{let l=e.addObserver(t);return()=>{a=!0,l()}}}directlySetCurrentUser(e){return g(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return F(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=rf(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return g(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();r&&(t["X-Firebase-Client"]=r);let i=yield this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t})}_getAppCheckToken(){return g(this,null,function*(){var e;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t?.error&&dy(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function an(n){return te(n)}var us=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=rd(t=>this.observer=t)}get next(){return F(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var gs={loadJS(){return g(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function ky(n){gs=n}function sf(n){return gs.loadJS(n)}function Dy(){return gs.recaptchaEnterpriseScript}function Ny(){return gs.gapiScript}function of(n){return`__${n}${Math.floor(Math.random()*1e6)}`}var Oy="recaptcha-enterprise",xy="NO_RECAPTCHA",Va=class{constructor(e){this.type=Oy,this.auth=an(e)}verify(e="verify",t=!1){return g(this,null,function*(){function r(s){return g(this,null,function*(){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise((a,u)=>g(this,null,function*(){Iy(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)u(new Error("recaptcha Enterprise site key undefined"));else{let d=new Ca(l);return s.tenantId==null?s._agentRecaptchaConfig=d:s._tenantRecaptchaConfigs[s.tenantId]=d,a(d.siteKey)}}).catch(l=>{u(l)})}))})}function i(s,a,u){let l=window.grecaptcha;Sd(l)?l.enterprise.ready(()=>{l.enterprise.execute(s,{action:e}).then(d=>{a(d)}).catch(()=>{a(xy)})}):u(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((s,a)=>{r(this.auth).then(u=>{if(!t&&Sd(window.grecaptcha))i(u,s,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let l=Dy();l.length!==0&&(l+=u),sf(l).then(()=>{i(u,s,a)}).catch(d=>{a(d)})}}).catch(u=>{a(u)})})})}};function kd(n,e,t,r=!1){return g(this,null,function*(){let i=new Va(n),s;try{s=yield i.verify(t)}catch{s=yield i.verify(t,!0)}let a=Object.assign({},e);return r?Object.assign(a,{captchaResp:s}):Object.assign(a,{captchaResponse:s}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a})}function La(n,e,t,r){return g(this,null,function*(){var i;if(!((i=n._getRecaptchaConfig())===null||i===void 0)&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){let s=yield kd(n,e,t,t==="getOobCode");return r(n,s)}else return r(n,e).catch(s=>g(this,null,function*(){if(s.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let a=yield kd(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(s)}))})}function Xa(n,e){let t=lt(n,"auth");if(t.isInitialized()){let i=t.getImmediate(),s=t.getOptions();if(Zt(s,e??{}))return i;Je(i,"already-initialized")}return t.initialize({options:e})}function Vy(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(mt);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function Za(n,e,t){let r=an(n);F(r._canInitEmulator,r,"emulator-config-failed"),F(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");let i=!!t?.disableWarnings,s=af(e),{host:a,port:u}=Ly(e),l=u===null?"":`:${u}`;r.config.emulator={url:`${s}//${a}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:u,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||My()}function af(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Ly(n){let e=af(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let s=i[1];return{host:s,port:Dd(r.substr(s.length+1))}}else{let[s,a]=r.split(":");return{host:s,port:Dd(a)}}}function Dd(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function My(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var zr=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return pt("not implemented")}_getIdTokenResponse(e){return pt("not implemented")}_linkToIdToken(e,t){return pt("not implemented")}_getReauthenticationResolver(e){return pt("not implemented")}};function Fy(n,e){return g(this,null,function*(){return yt(n,"POST","/v1/accounts:signUp",e)})}function Uy(n,e){return g(this,null,function*(){return Kr(n,"POST","/v1/accounts:signInWithPassword",_t(n,e))})}function By(n,e){return g(this,null,function*(){return yt(n,"POST","/v1/accounts:sendOobCode",_t(n,e))})}function qy(n,e){return g(this,null,function*(){return By(n,e)})}function $y(n,e){return g(this,null,function*(){return Kr(n,"POST","/v1/accounts:signInWithEmailLink",_t(n,e))})}function jy(n,e){return g(this,null,function*(){return Kr(n,"POST","/v1/accounts:signInWithEmailLink",_t(n,e))})}var Gr=class n extends zr{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new n(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new n(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){return g(this,null,function*(){switch(this.signInMethod){case"password":let t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return La(e,t,"signInWithPassword",Uy);case"emailLink":return $y(e,{email:this._email,oobCode:this._password});default:Je(e,"internal-error")}})}_linkToIdToken(e,t){return g(this,null,function*(){switch(this.signInMethod){case"password":let r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return La(e,r,"signUpPassword",Fy);case"emailLink":return jy(e,{idToken:t,email:this._email,oobCode:this._password});default:Je(e,"internal-error")}})}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}};function ba(n,e){return g(this,null,function*(){return Kr(n,"POST","/v1/accounts:signInWithIdp",_t(n,e))})}function zy(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Gy(n){let e=kn(Dn(n)).link,t=e?kn(Dn(e)).deep_link_id:null,r=kn(Dn(n)).deep_link_id;return(r?kn(Dn(r)).link:null)||r||t||e||n}var ls=class n{constructor(e){var t,r,i,s,a,u;let l=kn(Dn(e)),d=(t=l.apiKey)!==null&&t!==void 0?t:null,p=(r=l.oobCode)!==null&&r!==void 0?r:null,I=zy((i=l.mode)!==null&&i!==void 0?i:null);F(d&&p&&I,"argument-error"),this.apiKey=d,this.operation=I,this.code=p,this.continueUrl=(s=l.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(a=l.languageCode)!==null&&a!==void 0?a:null,this.tenantId=(u=l.tenantId)!==null&&u!==void 0?u:null}static parseLink(e){let t=Gy(e);try{return new n(t)}catch{return null}}};var cf=(()=>{class n{constructor(){this.providerId=n.PROVIDER_ID}static credential(t,r){return Gr._fromEmailAndPassword(t,r)}static credentialWithLink(t,r){let i=ls.parseLink(r);return F(i,"argument-error"),Gr._fromEmailAndCode(t,i.code,i.tenantId)}}n.PROVIDER_ID="password",n.EMAIL_PASSWORD_SIGN_IN_METHOD="password",n.EMAIL_LINK_SIGN_IN_METHOD="emailLink";return n})(),hs=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var Ma=class extends hs{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};function Wy(n,e){return g(this,null,function*(){return Kr(n,"POST","/v1/accounts:signUp",_t(n,e))})}var Mn=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,r,i=!1){return g(this,null,function*(){let s=yield Ln._fromIdTokenResponse(e,r,i),a=Nd(r);return new n({user:s,providerId:a,_tokenResponse:r,operationType:t})})}static _forOperation(e,t,r){return g(this,null,function*(){yield e._updateTokensIfNecessary(r,!0);let i=Nd(r);return new n({user:e,providerId:i,_tokenResponse:r,operationType:t})})}};function Nd(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}var Fa=class n extends Te{constructor(e,t,r,i){var s;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new n(e,t,r,i)}};function uf(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?Fa._fromErrorAndOperation(n,s,e,r):s})}function Ky(n,e,t=!1){return g(this,null,function*(){let r=yield $r(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return Mn._forOperation(n,"link",r)})}function Hy(n,e,t=!1){return g(this,null,function*(){let{auth:r}=n;if(Le(r.app))return Promise.reject(gt(r));let i="reauthenticate";try{let s=yield $r(n,uf(r,i,e,n),t);F(s.idToken,r,"internal-error");let a=Qa(s.idToken);F(a,r,"internal-error");let{sub:u}=a;return F(n.uid===u,r,"user-mismatch"),Mn._forOperation(n,i,s)}catch(s){throw s?.code==="auth/user-not-found"&&Je(r,"user-mismatch"),s}})}function lf(n,e,t=!1){return g(this,null,function*(){if(Le(n.app))return Promise.reject(gt(n));let r="signIn",i=yield uf(n,r,e),s=yield Mn._fromIdTokenResponse(n,r,i);return t||(yield n._updateCurrentUser(s.user)),s})}function ec(n,e){return g(this,null,function*(){return lf(an(n),e)})}function Qy(n,e,t){var r;F(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),F(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(F(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(F(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}function hf(n){return g(this,null,function*(){let e=an(n);e._getPasswordPolicyInternal()&&(yield e._updatePasswordPolicy())})}function tc(n,e,t){return g(this,null,function*(){if(Le(n.app))return Promise.reject(gt(n));let r=an(n),a=yield La(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Wy).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&hf(n),l}),u=yield Mn._fromIdTokenResponse(r,"signIn",a);return yield r._updateCurrentUser(u.user),u})}function nc(n,e,t){return Le(n.app)?Promise.reject(gt(n)):ec(te(n),cf.credential(e,t)).catch(r=>g(this,null,function*(){throw r.code==="auth/password-does-not-meet-requirements"&&hf(n),r}))}function rc(n,e){return g(this,null,function*(){let t=te(n),i={requestType:"VERIFY_EMAIL",idToken:yield n.getIdToken()};e&&Qy(t.auth,i,e);let{email:s}=yield qy(t.auth,i);s!==n.email&&(yield n.reload())})}function ic(n,e,t,r){return te(n).onIdTokenChanged(e,t,r)}function sc(n,e,t){return te(n).beforeAuthStateChanged(e,t)}var ds="__sak";var fs=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(ds,"1"),this.storage.removeItem(ds),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var Jy=1e3,Yy=10,Xy=(()=>{class n extends fs{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=nf(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let r of Object.keys(this.listeners)){let i=this.storage.getItem(r),s=this.localCache[r];i!==s&&t(r,s,i)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((u,l,d)=>{this.notifyListeners(u,d)});return}let i=t.key;r?this.detachListener():this.stopPolling();let s=()=>{let u=this.storage.getItem(i);!r&&this.localCache[i]===u||this.notifyListeners(i,u)},a=this.storage.getItem(i);Ry()&&a!==t.newValue&&t.newValue!==t.oldValue?setTimeout(s,Yy):s()}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:i}),!0)})},Jy)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,r){return g(this,null,function*(){yield Ct(n.prototype,this,"_set").call(this,t,r),this.localCache[t]=JSON.stringify(r)})}_get(t){return g(this,null,function*(){let r=yield Ct(n.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(r),r})}_remove(t){return g(this,null,function*(){yield Ct(n.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return n.type="LOCAL",n})(),df=Xy;var Zy=(()=>{class n extends fs{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}return n.type="SESSION",n})(),oc=Zy;function eI(n){return Promise.all(n.map(e=>g(this,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}var tI=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let r=this.receivers.find(s=>s.isListeningto(t));if(r)return r;let i=new n(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}handleEvent(t){return g(this,null,function*(){let r=t,{eventId:i,eventType:s,data:a}=r.data,u=this.handlersMap[s];if(!u?.size)return;r.ports[0].postMessage({status:"ack",eventId:i,eventType:s});let l=Array.from(u).map(p=>g(this,null,function*(){return p(r.origin,a)})),d=yield eI(l);r.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:d})})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function ff(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}var Ua=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,r=50){return g(this,null,function*(){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,a;return new Promise((u,l)=>{let d=ff("",20);i.port1.start();let p=setTimeout(()=>{l(new Error("unsupported_event"))},r);a={messageChannel:i,onMessage(I){let w=I;if(w.data.eventId===d)switch(w.data.status){case"ack":clearTimeout(p),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),u(w.data.response);break;default:clearTimeout(p),clearTimeout(s),l(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})})}};function Qe(){return window}function nI(n){Qe().location.href=n}function pf(){return typeof Qe().WorkerGlobalScope<"u"&&typeof Qe().importScripts=="function"}function rI(){return g(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function iI(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function sI(){return pf()?self:null}var mf="firebaseLocalStorageDb",oI=1,ps="firebaseLocalStorage",gf="fbase_key",on=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function _s(n,e){return n.transaction([ps],e?"readwrite":"readonly").objectStore(ps)}function aI(){let n=indexedDB.deleteDatabase(mf);return new on(n).toPromise()}function Ba(){let n=indexedDB.open(mf,oI);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let r=n.result;try{r.createObjectStore(ps,{keyPath:gf})}catch(i){t(i)}}),n.addEventListener("success",()=>g(this,null,function*(){let r=n.result;r.objectStoreNames.contains(ps)?e(r):(r.close(),yield aI(),e(yield Ba()))}))})}function Od(n,e,t){return g(this,null,function*(){let r=_s(n,!0).put({[gf]:e,value:t});return new on(r).toPromise()})}function cI(n,e){return g(this,null,function*(){let t=_s(n,!1).get(e),r=yield new on(t).toPromise();return r===void 0?null:r.value})}function xd(n,e){let t=_s(n,!0).delete(e);return new on(t).toPromise()}var uI=800,lI=3,hI=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return g(this,null,function*(){return this.db?this.db:(this.db=yield Ba(),this.db)})}_withRetries(t){return g(this,null,function*(){let r=0;for(;;)try{let i=yield this._openDb();return yield t(i)}catch(i){if(r++>lI)throw i;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return g(this,null,function*(){return pf()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return g(this,null,function*(){this.receiver=tI._getInstance(sI()),this.receiver._subscribe("keyChanged",(t,r)=>g(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(r.key)}})),this.receiver._subscribe("ping",(t,r)=>g(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return g(this,null,function*(){var t,r;if(this.activeServiceWorker=yield rI(),!this.activeServiceWorker)return;this.sender=new Ua(this.activeServiceWorker);let i=yield this.sender._send("ping",{},800);i&&!((t=i[0])===null||t===void 0)&&t.fulfilled&&!((r=i[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return g(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||iI()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return g(this,null,function*(){try{if(!indexedDB)return!1;let t=yield Ba();return yield Od(t,ds,"1"),yield xd(t,ds),!0}catch{}return!1})}_withPendingWrite(t){return g(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,r){return g(this,null,function*(){return this._withPendingWrite(()=>g(this,null,function*(){return yield this._withRetries(i=>Od(i,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)}))})}_get(t){return g(this,null,function*(){let r=yield this._withRetries(i=>cI(i,t));return this.localCache[t]=r,r})}_remove(t){return g(this,null,function*(){return this._withPendingWrite(()=>g(this,null,function*(){return yield this._withRetries(r=>xd(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return g(this,null,function*(){let t=yield this._withRetries(s=>{let a=_s(s,!1).getAll();return new on(a).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let r=[],i=new Set;if(t.length!==0)for(let{fbase_key:s,value:a}of t)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(a)&&(this.notifyListeners(s,a),r.push(s));for(let s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r})}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>g(this,null,function*(){return this._poll()}),uI)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),_f=hI;var KA=of("rcb"),HA=new sn(3e4,6e4);function dI(n,e){return e?mt(e):(F(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var Wr=class extends zr{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ba(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ba(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ba(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function fI(n){return lf(n.auth,new Wr(n),n.bypassAuthState)}function pI(n){let{auth:e,user:t}=n;return F(t,e,"internal-error"),Hy(t,new Wr(n),n.bypassAuthState)}function mI(n){return g(this,null,function*(){let{auth:e,user:t}=n;return F(t,e,"internal-error"),Ky(t,new Wr(n),n.bypassAuthState)})}var qa=class{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>g(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}}))}onAuthEvent(e){return g(this,null,function*(){let{urlResponse:t,sessionId:r,postBody:i,tenantId:s,error:a,type:u}=e;if(a){this.reject(a);return}let l={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(u)(l))}catch(d){this.reject(d)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return fI;case"linkViaPopup":case"linkViaRedirect":return mI;case"reauthViaPopup":case"reauthViaRedirect":return pI;default:Je(this.auth,"internal-error")}}resolve(e){Ut(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ut(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var QA=new sn(2e3,1e4);var gI="pendingRedirect",rs=new Map,$a=class n extends qa{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}execute(){return g(this,null,function*(){let e=rs.get(this.auth._key());if(!e){try{let r=(yield _I(this.resolver,this.auth))?yield Ct(n.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}rs.set(this.auth._key(),e)}return this.bypassAuthState||rs.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return g(this,null,function*(){if(e.type==="signInViaRedirect")return Ct(n.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,Ct(n.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return g(this,null,function*(){})}cleanUp(){}};function _I(n,e){return g(this,null,function*(){let t=vI(e),r=II(n);if(!(yield r._isAvailable()))return!1;let i=(yield r._get(t))==="true";return yield r._remove(t),i})}function yI(n,e){rs.set(n._key(),e)}function II(n){return mt(n._redirectPersistence)}function vI(n){return ns(gI,n.config.apiKey,n.name)}function wI(n,e,t=!1){return g(this,null,function*(){if(Le(n.app))return Promise.reject(gt(n));let r=an(n),i=dI(r,e),a=yield new $a(r,i,t).execute();return a&&!t&&(delete a.user._redirectEventId,yield r._persistUserIfCurrent(a.user),yield r._setRedirectUser(null,e)),a})}var EI=10*60*1e3,ja=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!TI(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!yf(e)){let i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(rn(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=EI&&this.cachedEventUids.clear(),this.cachedEventUids.has(Vd(e))}saveEventToCache(e){this.cachedEventUids.add(Vd(e)),this.lastProcessedEventTime=Date.now()}};function Vd(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function yf({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function TI(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return yf(n);default:return!1}}function AI(t){return g(this,arguments,function*(n,e={}){return yt(n,"GET","/v1/projects",e)})}var bI=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,SI=/^https?/;function RI(n){return g(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:e}=yield AI(n);for(let t of e)try{if(PI(t))return}catch{}Je(n,"unauthorized-domain")})}function PI(n){let e=Ra(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){let a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!SI.test(t))return!1;if(bI.test(n))return r===n;let i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}var CI=new sn(3e4,6e4);function Ld(){let n=Qe().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function kI(n){return new Promise((e,t)=>{var r,i,s;function a(){Ld(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Ld(),t(rn(n,"network-request-failed"))},timeout:CI.get()})}if(!((i=(r=Qe().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=Qe().gapi)===null||s===void 0)&&s.load)a();else{let u=of("iframefcb");return Qe()[u]=()=>{gapi.load?a():t(rn(n,"network-request-failed"))},sf(`${Ny()}?onload=${u}`).catch(l=>t(l))}}).catch(e=>{throw is=null,e})}var is=null;function DI(n){return is=is||kI(n),is}var NI=new sn(5e3,15e3),OI="__/auth/iframe",xI="emulator/auth/iframe",VI={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},LI=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function MI(n){let e=n.config;F(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?Ka(e,xI):`https://${n.config.authDomain}/${OI}`,r={apiKey:e.apiKey,appName:n.name,v:qe},i=LI.get(n.config.apiHost);i&&(r.eid=i);let s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${Vr(r).slice(1)}`}function FI(n){return g(this,null,function*(){let e=yield DI(n),t=Qe().gapi;return F(t,n,"internal-error"),e.open({where:document.body,url:MI(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:VI,dontclear:!0},r=>new Promise((i,s)=>g(this,null,function*(){yield r.restyle({setHideOnLeave:!1});let a=rn(n,"network-request-failed"),u=Qe().setTimeout(()=>{s(a)},NI.get());function l(){Qe().clearTimeout(u),i(r)}r.ping(l).then(l,()=>{s(a)})})))})}var UI={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},BI=500,qI=600,$I="_blank",jI="http://localhost",ms=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function zI(n,e,t,r=BI,i=qI){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString(),u="",l=Object.assign(Object.assign({},UI),{width:r.toString(),height:i.toString(),top:s,left:a}),d=fe().toLowerCase();t&&(u=Yd(d)?$I:t),Qd(d)&&(e=e||jI,l.scrollbars="yes");let p=Object.entries(l).reduce((w,[R,k])=>`${w}${R}=${k},`,"");if(Sy(d)&&u!=="_self")return GI(e||"",u),new ms(null);let I=window.open(e||"",u,p);F(I,n,"popup-blocked");try{I.focus()}catch{}return new ms(I)}function GI(n,e){let t=document.createElement("a");t.href=n,t.target=e;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}var WI="__/auth/handler",KI="emulator/auth/handler",HI=encodeURIComponent("fac");function Md(n,e,t,r,i,s){return g(this,null,function*(){F(n.config.authDomain,n,"auth-domain-config-required"),F(n.config.apiKey,n,"invalid-api-key");let a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:qe,eventId:i};if(e instanceof hs){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",nd(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(let[p,I]of Object.entries(s||{}))a[p]=I}if(e instanceof Ma){let p=e.getScopes().filter(I=>I!=="");p.length>0&&(a.scopes=p.join(","))}n.tenantId&&(a.tid=n.tenantId);let u=a;for(let p of Object.keys(u))u[p]===void 0&&delete u[p];let l=yield n._getAppCheckToken(),d=l?`#${HI}=${encodeURIComponent(l)}`:"";return`${QI(n)}?${Vr(u).slice(1)}${d}`})}function QI({config:n}){return n.emulator?Ka(n,KI):`https://${n.authDomain}/${WI}`}var Sa="webStorageSupport",za=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=oc,this._completeRedirectFn=wI,this._overrideRedirectResult=yI}_openPopup(e,t,r,i){return g(this,null,function*(){var s;Ut((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");let a=yield Md(e,t,r,Ra(),i);return zI(e,a,ff())})}_openRedirect(e,t,r,i){return g(this,null,function*(){yield this._originValidation(e);let s=yield Md(e,t,r,Ra(),i);return nI(s),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(Ut(s,"If manager is not set, promise should be"),s)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}initAndGetManager(e){return g(this,null,function*(){let t=yield FI(e),r=new ja(e);return t.register("authEvent",i=>(F(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Sa,{type:Sa},i=>{var s;let a=(s=i?.[0])===null||s===void 0?void 0:s[Sa];a!==void 0&&t(!!a),Je(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=RI(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return nf()||Jd()||Ya()}},If=za;var Fd="@firebase/auth",Ud="1.7.9";var Ga=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return g(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){F(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function JI(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function YI(n){Be(new ke("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:a,authDomain:u}=r.options;F(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let l={apiKey:a,authDomain:u,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:rf(n)},d=new xa(r,i,s,l);return Vy(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Be(new ke("auth-internal",e=>{let t=an(e.getProvider("auth").getImmediate());return(r=>new Ga(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Z(Fd,Ud,JI(n)),Z(Fd,Ud,"esm2017")}var XI=5*60,ZI=ia("authIdTokenMaxAge")||XI,Bd=null,ev=n=>e=>g(void 0,null,function*(){let t=e&&(yield e.getIdTokenResult()),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>ZI)return;let i=t?.token;Bd!==i&&(Bd=i,yield fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});function ac(n=ht()){let e=lt(n,"auth");if(e.isInitialized())return e.getImmediate();let t=Xa(n,{popupRedirectResolver:If,persistence:[_f,df,oc]}),r=ia("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){let s=new URL(r,location.origin);if(location.origin===s.origin){let a=ev(s.toString());sc(t,a,()=>a(t.currentUser)),ic(t,u=>a(u))}}let i=na("auth");return i&&Za(t,`http://${i}`),t}function tv(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}ky({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let s=rn("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",tv().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});YI("Browser");var vf="auth",cn=class{constructor(e){return e}},un=class{constructor(){return nn(vf)}};var cc=new kt("angularfire2.auth-instances");function Gv(n,e){let t=Vn(vf,n,e);return t&&new cn(t)}function Wv(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new cn(r)}}var Kv={provide:un,deps:[[new ge,cc]]},Hv={provide:cn,useFactory:Gv,deps:[[new ge,cc],$e]};function Nb(n,...e){return Z("angularfire",dt.full,"auth"),Nt([Hv,Kv,{provide:cc,useFactory:Wv(n),multi:!0,deps:[Ke,Ot,Mt,ft,[new ge,Lt],...e]}])}var Ob=ne(tc,!0);var xb=ne(ac,!0);var Vb=ne(rc,!0);var Lb=ne(nc,!0);var wf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ef={};var Bt,uc;(function(){var n;function e(E,m){function _(){}_.prototype=m.prototype,E.D=m.prototype,E.prototype=new _,E.prototype.constructor=E,E.C=function(v,T,b){for(var y=Array(arguments.length-2),st=2;st<arguments.length;st++)y[st-2]=arguments[st];return m.prototype[T].apply(v,y)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(E,m,_){_||(_=0);var v=Array(16);if(typeof m=="string")for(var T=0;16>T;++T)v[T]=m.charCodeAt(_++)|m.charCodeAt(_++)<<8|m.charCodeAt(_++)<<16|m.charCodeAt(_++)<<24;else for(T=0;16>T;++T)v[T]=m[_++]|m[_++]<<8|m[_++]<<16|m[_++]<<24;m=E.g[0],_=E.g[1],T=E.g[2];var b=E.g[3],y=m+(b^_&(T^b))+v[0]+3614090360&4294967295;m=_+(y<<7&4294967295|y>>>25),y=b+(T^m&(_^T))+v[1]+3905402710&4294967295,b=m+(y<<12&4294967295|y>>>20),y=T+(_^b&(m^_))+v[2]+606105819&4294967295,T=b+(y<<17&4294967295|y>>>15),y=_+(m^T&(b^m))+v[3]+3250441966&4294967295,_=T+(y<<22&4294967295|y>>>10),y=m+(b^_&(T^b))+v[4]+4118548399&4294967295,m=_+(y<<7&4294967295|y>>>25),y=b+(T^m&(_^T))+v[5]+1200080426&4294967295,b=m+(y<<12&4294967295|y>>>20),y=T+(_^b&(m^_))+v[6]+2821735955&4294967295,T=b+(y<<17&4294967295|y>>>15),y=_+(m^T&(b^m))+v[7]+4249261313&4294967295,_=T+(y<<22&4294967295|y>>>10),y=m+(b^_&(T^b))+v[8]+1770035416&4294967295,m=_+(y<<7&4294967295|y>>>25),y=b+(T^m&(_^T))+v[9]+2336552879&4294967295,b=m+(y<<12&4294967295|y>>>20),y=T+(_^b&(m^_))+v[10]+4294925233&4294967295,T=b+(y<<17&4294967295|y>>>15),y=_+(m^T&(b^m))+v[11]+2304563134&4294967295,_=T+(y<<22&4294967295|y>>>10),y=m+(b^_&(T^b))+v[12]+1804603682&4294967295,m=_+(y<<7&4294967295|y>>>25),y=b+(T^m&(_^T))+v[13]+4254626195&4294967295,b=m+(y<<12&4294967295|y>>>20),y=T+(_^b&(m^_))+v[14]+2792965006&4294967295,T=b+(y<<17&4294967295|y>>>15),y=_+(m^T&(b^m))+v[15]+1236535329&4294967295,_=T+(y<<22&4294967295|y>>>10),y=m+(T^b&(_^T))+v[1]+4129170786&4294967295,m=_+(y<<5&4294967295|y>>>27),y=b+(_^T&(m^_))+v[6]+3225465664&4294967295,b=m+(y<<9&4294967295|y>>>23),y=T+(m^_&(b^m))+v[11]+643717713&4294967295,T=b+(y<<14&4294967295|y>>>18),y=_+(b^m&(T^b))+v[0]+3921069994&4294967295,_=T+(y<<20&4294967295|y>>>12),y=m+(T^b&(_^T))+v[5]+3593408605&4294967295,m=_+(y<<5&4294967295|y>>>27),y=b+(_^T&(m^_))+v[10]+38016083&4294967295,b=m+(y<<9&4294967295|y>>>23),y=T+(m^_&(b^m))+v[15]+3634488961&4294967295,T=b+(y<<14&4294967295|y>>>18),y=_+(b^m&(T^b))+v[4]+3889429448&4294967295,_=T+(y<<20&4294967295|y>>>12),y=m+(T^b&(_^T))+v[9]+568446438&4294967295,m=_+(y<<5&4294967295|y>>>27),y=b+(_^T&(m^_))+v[14]+3275163606&4294967295,b=m+(y<<9&4294967295|y>>>23),y=T+(m^_&(b^m))+v[3]+4107603335&4294967295,T=b+(y<<14&4294967295|y>>>18),y=_+(b^m&(T^b))+v[8]+1163531501&4294967295,_=T+(y<<20&4294967295|y>>>12),y=m+(T^b&(_^T))+v[13]+2850285829&4294967295,m=_+(y<<5&4294967295|y>>>27),y=b+(_^T&(m^_))+v[2]+4243563512&4294967295,b=m+(y<<9&4294967295|y>>>23),y=T+(m^_&(b^m))+v[7]+1735328473&4294967295,T=b+(y<<14&4294967295|y>>>18),y=_+(b^m&(T^b))+v[12]+2368359562&4294967295,_=T+(y<<20&4294967295|y>>>12),y=m+(_^T^b)+v[5]+4294588738&4294967295,m=_+(y<<4&4294967295|y>>>28),y=b+(m^_^T)+v[8]+2272392833&4294967295,b=m+(y<<11&4294967295|y>>>21),y=T+(b^m^_)+v[11]+1839030562&4294967295,T=b+(y<<16&4294967295|y>>>16),y=_+(T^b^m)+v[14]+4259657740&4294967295,_=T+(y<<23&4294967295|y>>>9),y=m+(_^T^b)+v[1]+2763975236&4294967295,m=_+(y<<4&4294967295|y>>>28),y=b+(m^_^T)+v[4]+1272893353&4294967295,b=m+(y<<11&4294967295|y>>>21),y=T+(b^m^_)+v[7]+4139469664&4294967295,T=b+(y<<16&4294967295|y>>>16),y=_+(T^b^m)+v[10]+3200236656&4294967295,_=T+(y<<23&4294967295|y>>>9),y=m+(_^T^b)+v[13]+681279174&4294967295,m=_+(y<<4&4294967295|y>>>28),y=b+(m^_^T)+v[0]+3936430074&4294967295,b=m+(y<<11&4294967295|y>>>21),y=T+(b^m^_)+v[3]+3572445317&4294967295,T=b+(y<<16&4294967295|y>>>16),y=_+(T^b^m)+v[6]+76029189&4294967295,_=T+(y<<23&4294967295|y>>>9),y=m+(_^T^b)+v[9]+3654602809&4294967295,m=_+(y<<4&4294967295|y>>>28),y=b+(m^_^T)+v[12]+3873151461&4294967295,b=m+(y<<11&4294967295|y>>>21),y=T+(b^m^_)+v[15]+530742520&4294967295,T=b+(y<<16&4294967295|y>>>16),y=_+(T^b^m)+v[2]+3299628645&4294967295,_=T+(y<<23&4294967295|y>>>9),y=m+(T^(_|~b))+v[0]+4096336452&4294967295,m=_+(y<<6&4294967295|y>>>26),y=b+(_^(m|~T))+v[7]+1126891415&4294967295,b=m+(y<<10&4294967295|y>>>22),y=T+(m^(b|~_))+v[14]+2878612391&4294967295,T=b+(y<<15&4294967295|y>>>17),y=_+(b^(T|~m))+v[5]+4237533241&4294967295,_=T+(y<<21&4294967295|y>>>11),y=m+(T^(_|~b))+v[12]+1700485571&4294967295,m=_+(y<<6&4294967295|y>>>26),y=b+(_^(m|~T))+v[3]+2399980690&4294967295,b=m+(y<<10&4294967295|y>>>22),y=T+(m^(b|~_))+v[10]+4293915773&4294967295,T=b+(y<<15&4294967295|y>>>17),y=_+(b^(T|~m))+v[1]+2240044497&4294967295,_=T+(y<<21&4294967295|y>>>11),y=m+(T^(_|~b))+v[8]+1873313359&4294967295,m=_+(y<<6&4294967295|y>>>26),y=b+(_^(m|~T))+v[15]+4264355552&4294967295,b=m+(y<<10&4294967295|y>>>22),y=T+(m^(b|~_))+v[6]+2734768916&4294967295,T=b+(y<<15&4294967295|y>>>17),y=_+(b^(T|~m))+v[13]+1309151649&4294967295,_=T+(y<<21&4294967295|y>>>11),y=m+(T^(_|~b))+v[4]+4149444226&4294967295,m=_+(y<<6&4294967295|y>>>26),y=b+(_^(m|~T))+v[11]+3174756917&4294967295,b=m+(y<<10&4294967295|y>>>22),y=T+(m^(b|~_))+v[2]+718787259&4294967295,T=b+(y<<15&4294967295|y>>>17),y=_+(b^(T|~m))+v[9]+3951481745&4294967295,E.g[0]=E.g[0]+m&4294967295,E.g[1]=E.g[1]+(T+(y<<21&4294967295|y>>>11))&4294967295,E.g[2]=E.g[2]+T&4294967295,E.g[3]=E.g[3]+b&4294967295}r.prototype.u=function(E,m){m===void 0&&(m=E.length);for(var _=m-this.blockSize,v=this.B,T=this.h,b=0;b<m;){if(T==0)for(;b<=_;)i(this,E,b),b+=this.blockSize;if(typeof E=="string"){for(;b<m;)if(v[T++]=E.charCodeAt(b++),T==this.blockSize){i(this,v),T=0;break}}else for(;b<m;)if(v[T++]=E[b++],T==this.blockSize){i(this,v),T=0;break}}this.h=T,this.o+=m},r.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var m=1;m<E.length-8;++m)E[m]=0;var _=8*this.o;for(m=E.length-8;m<E.length;++m)E[m]=_&255,_/=256;for(this.u(E),E=Array(16),m=_=0;4>m;++m)for(var v=0;32>v;v+=8)E[_++]=this.g[m]>>>v&255;return E};function s(E,m){var _=u;return Object.prototype.hasOwnProperty.call(_,E)?_[E]:_[E]=m(E)}function a(E,m){this.h=m;for(var _=[],v=!0,T=E.length-1;0<=T;T--){var b=E[T]|0;v&&b==m||(_[T]=b,v=!1)}this.g=_}var u={};function l(E){return-128<=E&&128>E?s(E,function(m){return new a([m|0],0>m?-1:0)}):new a([E|0],0>E?-1:0)}function d(E){if(isNaN(E)||!isFinite(E))return I;if(0>E)return C(d(-E));for(var m=[],_=1,v=0;E>=_;v++)m[v]=E/_|0,_*=4294967296;return new a(m,0)}function p(E,m){if(E.length==0)throw Error("number format error: empty string");if(m=m||10,2>m||36<m)throw Error("radix out of range: "+m);if(E.charAt(0)=="-")return C(p(E.substring(1),m));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var _=d(Math.pow(m,8)),v=I,T=0;T<E.length;T+=8){var b=Math.min(8,E.length-T),y=parseInt(E.substring(T,T+b),m);8>b?(b=d(Math.pow(m,b)),v=v.j(b).add(d(y))):(v=v.j(_),v=v.add(d(y)))}return v}var I=l(0),w=l(1),R=l(16777216);n=a.prototype,n.m=function(){if(O(this))return-C(this).m();for(var E=0,m=1,_=0;_<this.g.length;_++){var v=this.i(_);E+=(0<=v?v:4294967296+v)*m,m*=4294967296}return E},n.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(k(this))return"0";if(O(this))return"-"+C(this).toString(E);for(var m=d(Math.pow(E,6)),_=this,v="";;){var T=j(_,m).g;_=U(_,T.j(m));var b=((0<_.g.length?_.g[0]:_.h)>>>0).toString(E);if(_=T,k(_))return b+v;for(;6>b.length;)b="0"+b;v=b+v}},n.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function k(E){if(E.h!=0)return!1;for(var m=0;m<E.g.length;m++)if(E.g[m]!=0)return!1;return!0}function O(E){return E.h==-1}n.l=function(E){return E=U(this,E),O(E)?-1:k(E)?0:1};function C(E){for(var m=E.g.length,_=[],v=0;v<m;v++)_[v]=~E.g[v];return new a(_,~E.h).add(w)}n.abs=function(){return O(this)?C(this):this},n.add=function(E){for(var m=Math.max(this.g.length,E.g.length),_=[],v=0,T=0;T<=m;T++){var b=v+(this.i(T)&65535)+(E.i(T)&65535),y=(b>>>16)+(this.i(T)>>>16)+(E.i(T)>>>16);v=y>>>16,b&=65535,y&=65535,_[T]=y<<16|b}return new a(_,_[_.length-1]&-2147483648?-1:0)};function U(E,m){return E.add(C(m))}n.j=function(E){if(k(this)||k(E))return I;if(O(this))return O(E)?C(this).j(C(E)):C(C(this).j(E));if(O(E))return C(this.j(C(E)));if(0>this.l(R)&&0>E.l(R))return d(this.m()*E.m());for(var m=this.g.length+E.g.length,_=[],v=0;v<2*m;v++)_[v]=0;for(v=0;v<this.g.length;v++)for(var T=0;T<E.g.length;T++){var b=this.i(v)>>>16,y=this.i(v)&65535,st=E.i(T)>>>16,fr=E.i(T)&65535;_[2*v+2*T]+=y*fr,q(_,2*v+2*T),_[2*v+2*T+1]+=b*fr,q(_,2*v+2*T+1),_[2*v+2*T+1]+=y*st,q(_,2*v+2*T+1),_[2*v+2*T+2]+=b*st,q(_,2*v+2*T+2)}for(v=0;v<m;v++)_[v]=_[2*v+1]<<16|_[2*v];for(v=m;v<2*m;v++)_[v]=0;return new a(_,0)};function q(E,m){for(;(E[m]&65535)!=E[m];)E[m+1]+=E[m]>>>16,E[m]&=65535,m++}function M(E,m){this.g=E,this.h=m}function j(E,m){if(k(m))throw Error("division by zero");if(k(E))return new M(I,I);if(O(E))return m=j(C(E),m),new M(C(m.g),C(m.h));if(O(m))return m=j(E,C(m)),new M(C(m.g),m.h);if(30<E.g.length){if(O(E)||O(m))throw Error("slowDivide_ only works with positive integers.");for(var _=w,v=m;0>=v.l(E);)_=ae(_),v=ae(v);var T=W(_,1),b=W(v,1);for(v=W(v,2),_=W(_,2);!k(v);){var y=b.add(v);0>=y.l(E)&&(T=T.add(_),b=y),v=W(v,1),_=W(_,1)}return m=U(E,T.j(m)),new M(T,m)}for(T=I;0<=E.l(m);){for(_=Math.max(1,Math.floor(E.m()/m.m())),v=Math.ceil(Math.log(_)/Math.LN2),v=48>=v?1:Math.pow(2,v-48),b=d(_),y=b.j(m);O(y)||0<y.l(E);)_-=v,b=d(_),y=b.j(m);k(b)&&(b=w),T=T.add(b),E=U(E,y)}return new M(T,E)}n.A=function(E){return j(this,E).h},n.and=function(E){for(var m=Math.max(this.g.length,E.g.length),_=[],v=0;v<m;v++)_[v]=this.i(v)&E.i(v);return new a(_,this.h&E.h)},n.or=function(E){for(var m=Math.max(this.g.length,E.g.length),_=[],v=0;v<m;v++)_[v]=this.i(v)|E.i(v);return new a(_,this.h|E.h)},n.xor=function(E){for(var m=Math.max(this.g.length,E.g.length),_=[],v=0;v<m;v++)_[v]=this.i(v)^E.i(v);return new a(_,this.h^E.h)};function ae(E){for(var m=E.g.length+1,_=[],v=0;v<m;v++)_[v]=E.i(v)<<1|E.i(v-1)>>>31;return new a(_,E.h)}function W(E,m){var _=m>>5;m%=32;for(var v=E.g.length-_,T=[],b=0;b<v;b++)T[b]=0<m?E.i(b+_)>>>m|E.i(b+_+1)<<32-m:E.i(b+_);return new a(T,E.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,uc=Ef.Md5=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,Bt=Ef.Integer=a}).apply(typeof wf<"u"?wf:typeof self<"u"?self:typeof window<"u"?window:{});var ys=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},It={};var lc,Jv,Fn,hc,Hr,Is,dc,fc,pc;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,c,h){return o==Array.prototype||o==Object.prototype||(o[c]=h.value),o};function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof ys=="object"&&ys];for(var c=0;c<o.length;++c){var h=o[c];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var r=t(this);function i(o,c){if(c)e:{var h=r;o=o.split(".");for(var f=0;f<o.length-1;f++){var A=o[f];if(!(A in h))break e;h=h[A]}o=o[o.length-1],f=h[o],c=c(f),c!=f&&c!=null&&e(h,o,{configurable:!0,writable:!0,value:c})}}function s(o,c){o instanceof String&&(o+="");var h=0,f=!1,A={next:function(){if(!f&&h<o.length){var S=h++;return{value:c(S,o[S]),done:!1}}return f=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}i("Array.prototype.values",function(o){return o||function(){return s(this,function(c,h){return h})}});var a=a||{},u=this||self;function l(o){var c=typeof o;return c=c!="object"?c:o?Array.isArray(o)?"array":c:"null",c=="array"||c=="object"&&typeof o.length=="number"}function d(o){var c=typeof o;return c=="object"&&o!=null||c=="function"}function p(o,c,h){return o.call.apply(o.bind,arguments)}function I(o,c,h){if(!o)throw Error();if(2<arguments.length){var f=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,f),o.apply(c,A)}}return function(){return o.apply(c,arguments)}}function w(o,c,h){return w=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?p:I,w.apply(null,arguments)}function R(o,c){var h=Array.prototype.slice.call(arguments,1);return function(){var f=h.slice();return f.push.apply(f,arguments),o.apply(this,f)}}function k(o,c){function h(){}h.prototype=c.prototype,o.aa=c.prototype,o.prototype=new h,o.prototype.constructor=o,o.Qb=function(f,A,S){for(var N=Array(arguments.length-2),X=2;X<arguments.length;X++)N[X-2]=arguments[X];return c.prototype[A].apply(f,N)}}function O(o){let c=o.length;if(0<c){let h=Array(c);for(let f=0;f<c;f++)h[f]=o[f];return h}return[]}function C(o,c){for(let h=1;h<arguments.length;h++){let f=arguments[h];if(l(f)){let A=o.length||0,S=f.length||0;o.length=A+S;for(let N=0;N<S;N++)o[A+N]=f[N]}else o.push(f)}}class U{constructor(c,h){this.i=c,this.j=h,this.h=0,this.g=null}get(){let c;return 0<this.h?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function q(o){return/^[\s\xa0]*$/.test(o)}function M(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function j(o){return j[" "](o),o}j[" "]=function(){};var ae=M().indexOf("Gecko")!=-1&&!(M().toLowerCase().indexOf("webkit")!=-1&&M().indexOf("Edge")==-1)&&!(M().indexOf("Trident")!=-1||M().indexOf("MSIE")!=-1)&&M().indexOf("Edge")==-1;function W(o,c,h){for(let f in o)c.call(h,o[f],f,o)}function E(o,c){for(let h in o)c.call(void 0,o[h],h,o)}function m(o){let c={};for(let h in o)c[h]=o[h];return c}let _="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function v(o,c){let h,f;for(let A=1;A<arguments.length;A++){f=arguments[A];for(h in f)o[h]=f[h];for(let S=0;S<_.length;S++)h=_[S],Object.prototype.hasOwnProperty.call(f,h)&&(o[h]=f[h])}}function T(o){var c=1;o=o.split(":");let h=[];for(;0<c&&o.length;)h.push(o.shift()),c--;return o.length&&h.push(o.join(":")),h}function b(o){u.setTimeout(()=>{throw o},0)}function y(){var o=Ao;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}class st{constructor(){this.h=this.g=null}add(c,h){let f=fr.get();f.set(c,h),this.h?this.h.next=f:this.g=f,this.h=f}}var fr=new U(()=>new ag,o=>o.reset());class ag{constructor(){this.next=this.g=this.h=null}set(c,h){this.h=c,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let pr,mr=!1,Ao=new st,Ll=()=>{let o=u.Promise.resolve(void 0);pr=()=>{o.then(cg)}};var cg=()=>{for(var o;o=y();){try{o.h.call(o.g)}catch(h){b(h)}var c=fr;c.j(o),100>c.h&&(c.h++,o.next=c.g,c.g=o)}mr=!1};function bt(){this.s=this.s,this.C=this.C}bt.prototype.s=!1,bt.prototype.ma=function(){this.s||(this.s=!0,this.N())},bt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ie(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}Ie.prototype.h=function(){this.defaultPrevented=!0};var ug=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let h=()=>{};u.addEventListener("test",h,c),u.removeEventListener("test",h,c)}catch{}return o}();function gr(o,c){if(Ie.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var h=this.type=o.type,f=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget){if(ae){e:{try{j(c.nodeName);var A=!0;break e}catch{}A=!1}A||(c=null)}}else h=="mouseover"?c=o.fromElement:h=="mouseout"&&(c=o.toElement);this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:lg[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&gr.aa.h.call(this)}}k(gr,Ie);var lg={2:"touch",3:"pen",4:"mouse"};gr.prototype.h=function(){gr.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var _r="closure_listenable_"+(1e6*Math.random()|0),hg=0;function dg(o,c,h,f,A){this.listener=o,this.proxy=null,this.src=c,this.type=h,this.capture=!!f,this.ha=A,this.key=++hg,this.da=this.fa=!1}function Ri(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function Pi(o){this.src=o,this.g={},this.h=0}Pi.prototype.add=function(o,c,h,f,A){var S=o.toString();o=this.g[S],o||(o=this.g[S]=[],this.h++);var N=So(o,c,f,A);return-1<N?(c=o[N],h||(c.fa=!1)):(c=new dg(c,this.src,S,!!f,A),c.fa=h,o.push(c)),c};function bo(o,c){var h=c.type;if(h in o.g){var f=o.g[h],A=Array.prototype.indexOf.call(f,c,void 0),S;(S=0<=A)&&Array.prototype.splice.call(f,A,1),S&&(Ri(c),o.g[h].length==0&&(delete o.g[h],o.h--))}}function So(o,c,h,f){for(var A=0;A<o.length;++A){var S=o[A];if(!S.da&&S.listener==c&&S.capture==!!h&&S.ha==f)return A}return-1}var Ro="closure_lm_"+(1e6*Math.random()|0),Po={};function Ml(o,c,h,f,A){if(f&&f.once)return Ul(o,c,h,f,A);if(Array.isArray(c)){for(var S=0;S<c.length;S++)Ml(o,c[S],h,f,A);return null}return h=No(h),o&&o[_r]?o.K(c,h,d(f)?!!f.capture:!!f,A):Fl(o,c,h,!1,f,A)}function Fl(o,c,h,f,A,S){if(!c)throw Error("Invalid event type");var N=d(A)?!!A.capture:!!A,X=ko(o);if(X||(o[Ro]=X=new Pi(o)),h=X.add(c,h,f,N,S),h.proxy)return h;if(f=fg(),h.proxy=f,f.src=o,f.listener=h,o.addEventListener)ug||(A=N),A===void 0&&(A=!1),o.addEventListener(c.toString(),f,A);else if(o.attachEvent)o.attachEvent(ql(c.toString()),f);else if(o.addListener&&o.removeListener)o.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return h}function fg(){function o(h){return c.call(o.src,o.listener,h)}let c=pg;return o}function Ul(o,c,h,f,A){if(Array.isArray(c)){for(var S=0;S<c.length;S++)Ul(o,c[S],h,f,A);return null}return h=No(h),o&&o[_r]?o.L(c,h,d(f)?!!f.capture:!!f,A):Fl(o,c,h,!0,f,A)}function Bl(o,c,h,f,A){if(Array.isArray(c))for(var S=0;S<c.length;S++)Bl(o,c[S],h,f,A);else f=d(f)?!!f.capture:!!f,h=No(h),o&&o[_r]?(o=o.i,c=String(c).toString(),c in o.g&&(S=o.g[c],h=So(S,h,f,A),-1<h&&(Ri(S[h]),Array.prototype.splice.call(S,h,1),S.length==0&&(delete o.g[c],o.h--)))):o&&(o=ko(o))&&(c=o.g[c.toString()],o=-1,c&&(o=So(c,h,f,A)),(h=-1<o?c[o]:null)&&Co(h))}function Co(o){if(typeof o!="number"&&o&&!o.da){var c=o.src;if(c&&c[_r])bo(c.i,o);else{var h=o.type,f=o.proxy;c.removeEventListener?c.removeEventListener(h,f,o.capture):c.detachEvent?c.detachEvent(ql(h),f):c.addListener&&c.removeListener&&c.removeListener(f),(h=ko(c))?(bo(h,o),h.h==0&&(h.src=null,c[Ro]=null)):Ri(o)}}}function ql(o){return o in Po?Po[o]:Po[o]="on"+o}function pg(o,c){if(o.da)o=!0;else{c=new gr(c,this);var h=o.listener,f=o.ha||o.src;o.fa&&Co(o),o=h.call(f,c)}return o}function ko(o){return o=o[Ro],o instanceof Pi?o:null}var Do="__closure_events_fn_"+(1e9*Math.random()>>>0);function No(o){return typeof o=="function"?o:(o[Do]||(o[Do]=function(c){return o.handleEvent(c)}),o[Do])}function ve(){bt.call(this),this.i=new Pi(this),this.M=this,this.F=null}k(ve,bt),ve.prototype[_r]=!0,ve.prototype.removeEventListener=function(o,c,h,f){Bl(this,o,c,h,f)};function Pe(o,c){var h,f=o.F;if(f)for(h=[];f;f=f.F)h.push(f);if(o=o.M,f=c.type||c,typeof c=="string")c=new Ie(c,o);else if(c instanceof Ie)c.target=c.target||o;else{var A=c;c=new Ie(f,o),v(c,A)}if(A=!0,h)for(var S=h.length-1;0<=S;S--){var N=c.g=h[S];A=Ci(N,f,!0,c)&&A}if(N=c.g=o,A=Ci(N,f,!0,c)&&A,A=Ci(N,f,!1,c)&&A,h)for(S=0;S<h.length;S++)N=c.g=h[S],A=Ci(N,f,!1,c)&&A}ve.prototype.N=function(){if(ve.aa.N.call(this),this.i){var o=this.i,c;for(c in o.g){for(var h=o.g[c],f=0;f<h.length;f++)Ri(h[f]);delete o.g[c],o.h--}}this.F=null},ve.prototype.K=function(o,c,h,f){return this.i.add(String(o),c,!1,h,f)},ve.prototype.L=function(o,c,h,f){return this.i.add(String(o),c,!0,h,f)};function Ci(o,c,h,f){if(c=o.i.g[String(c)],!c)return!0;c=c.concat();for(var A=!0,S=0;S<c.length;++S){var N=c[S];if(N&&!N.da&&N.capture==h){var X=N.listener,me=N.ha||N.src;N.fa&&bo(o.i,N),A=X.call(me,f)!==!1&&A}}return A&&!f.defaultPrevented}function $l(o,c,h){if(typeof o=="function")h&&(o=w(o,h));else if(o&&typeof o.handleEvent=="function")o=w(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(c)?-1:u.setTimeout(o,c||0)}function jl(o){o.g=$l(()=>{o.g=null,o.i&&(o.i=!1,jl(o))},o.l);let c=o.h;o.h=null,o.m.apply(null,c)}class mg extends bt{constructor(c,h){super(),this.m=c,this.l=h,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:jl(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function yr(o){bt.call(this),this.h=o,this.g={}}k(yr,bt);var zl=[];function Gl(o){W(o.g,function(c,h){this.g.hasOwnProperty(h)&&Co(c)},o),o.g={}}yr.prototype.N=function(){yr.aa.N.call(this),Gl(this)},yr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Oo=u.JSON.stringify,gg=u.JSON.parse,_g=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function xo(){}xo.prototype.h=null;function Wl(o){return o.h||(o.h=o.i())}function Kl(){}var Ir={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Vo(){Ie.call(this,"d")}k(Vo,Ie);function Lo(){Ie.call(this,"c")}k(Lo,Ie);var Qt={},Hl=null;function ki(){return Hl=Hl||new ve}Qt.La="serverreachability";function Ql(o){Ie.call(this,Qt.La,o)}k(Ql,Ie);function vr(o){let c=ki();Pe(c,new Ql(c))}Qt.STAT_EVENT="statevent";function Jl(o,c){Ie.call(this,Qt.STAT_EVENT,o),this.stat=c}k(Jl,Ie);function Ce(o){let c=ki();Pe(c,new Jl(c,o))}Qt.Ma="timingevent";function Yl(o,c){Ie.call(this,Qt.Ma,o),this.size=c}k(Yl,Ie);function wr(o,c){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},c)}function Er(){this.g=!0}Er.prototype.xa=function(){this.g=!1};function yg(o,c,h,f,A,S){o.info(function(){if(o.g)if(S)for(var N="",X=S.split("&"),me=0;me<X.length;me++){var Q=X[me].split("=");if(1<Q.length){var we=Q[0];Q=Q[1];var Ee=we.split("_");N=2<=Ee.length&&Ee[1]=="type"?N+(we+"="+Q+"&"):N+(we+"=redacted&")}}else N=null;else N=S;return"XMLHTTP REQ ("+f+") [attempt "+A+"]: "+c+`
`+h+`
`+N})}function Ig(o,c,h,f,A,S,N){o.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+A+"]: "+c+`
`+h+`
`+S+" "+N})}function bn(o,c,h,f){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+wg(o,h)+(f?" "+f:"")})}function vg(o,c){o.info(function(){return"TIMEOUT: "+c})}Er.prototype.info=function(){};function wg(o,c){if(!o.g)return c;if(!c)return null;try{var h=JSON.parse(c);if(h){for(o=0;o<h.length;o++)if(Array.isArray(h[o])){var f=h[o];if(!(2>f.length)){var A=f[1];if(Array.isArray(A)&&!(1>A.length)){var S=A[0];if(S!="noop"&&S!="stop"&&S!="close")for(var N=1;N<A.length;N++)A[N]=""}}}}return Oo(h)}catch{return c}}var Di={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Xl={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Mo;function Ni(){}k(Ni,xo),Ni.prototype.g=function(){return new XMLHttpRequest},Ni.prototype.i=function(){return{}},Mo=new Ni;function St(o,c,h,f){this.j=o,this.i=c,this.l=h,this.R=f||1,this.U=new yr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Zl}function Zl(){this.i=null,this.g="",this.h=!1}var eh={},Fo={};function Uo(o,c,h){o.L=1,o.v=Li(ot(c)),o.m=h,o.P=!0,th(o,null)}function th(o,c){o.F=Date.now(),Oi(o),o.A=ot(o.v);var h=o.A,f=o.R;Array.isArray(f)||(f=[String(f)]),mh(h.i,"t",f),o.C=0,h=o.j.J,o.h=new Zl,o.g=Oh(o.j,h?c:null,!o.m),0<o.O&&(o.M=new mg(w(o.Y,o,o.g),o.O)),c=o.U,h=o.g,f=o.ca;var A="readystatechange";Array.isArray(A)||(A&&(zl[0]=A.toString()),A=zl);for(var S=0;S<A.length;S++){var N=Ml(h,A[S],f||c.handleEvent,!1,c.h||c);if(!N)break;c.g[N.key]=N}c=o.H?m(o.H):{},o.m?(o.u||(o.u="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,c)):(o.u="GET",o.g.ea(o.A,o.u,null,c)),vr(),yg(o.i,o.u,o.A,o.l,o.R,o.m)}St.prototype.ca=function(o){o=o.target;let c=this.M;c&&at(o)==3?c.j():this.Y(o)},St.prototype.Y=function(o){try{if(o==this.g)e:{let Ee=at(this.g);var c=this.g.Ba();let Pn=this.g.Z();if(!(3>Ee)&&(Ee!=3||this.g&&(this.h.h||this.g.oa()||Eh(this.g)))){this.J||Ee!=4||c==7||(c==8||0>=Pn?vr(3):vr(2)),Bo(this);var h=this.g.Z();this.X=h;t:if(nh(this)){var f=Eh(this.g);o="";var A=f.length,S=at(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Jt(this),Tr(this);var N="";break t}this.h.i=new u.TextDecoder}for(c=0;c<A;c++)this.h.h=!0,o+=this.h.i.decode(f[c],{stream:!(S&&c==A-1)});f.length=0,this.h.g+=o,this.C=0,N=this.h.g}else N=this.g.oa();if(this.o=h==200,Ig(this.i,this.u,this.A,this.l,this.R,Ee,h),this.o){if(this.T&&!this.K){t:{if(this.g){var X,me=this.g;if((X=me.g?me.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!q(X)){var Q=X;break t}}Q=null}if(h=Q)bn(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,qo(this,h);else{this.o=!1,this.s=3,Ce(12),Jt(this),Tr(this);break e}}if(this.P){h=!0;let Ue;for(;!this.J&&this.C<N.length;)if(Ue=Eg(this,N),Ue==Fo){Ee==4&&(this.s=4,Ce(14),h=!1),bn(this.i,this.l,null,"[Incomplete Response]");break}else if(Ue==eh){this.s=4,Ce(15),bn(this.i,this.l,N,"[Invalid Chunk]"),h=!1;break}else bn(this.i,this.l,Ue,null),qo(this,Ue);if(nh(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ee!=4||N.length!=0||this.h.h||(this.s=1,Ce(16),h=!1),this.o=this.o&&h,!h)bn(this.i,this.l,N,"[Invalid Chunked Response]"),Jt(this),Tr(this);else if(0<N.length&&!this.W){this.W=!0;var we=this.j;we.g==this&&we.ba&&!we.M&&(we.j.info("Great, no buffering proxy detected. Bytes received: "+N.length),Ko(we),we.M=!0,Ce(11))}}else bn(this.i,this.l,N,null),qo(this,N);Ee==4&&Jt(this),this.o&&!this.J&&(Ee==4?Ch(this.j,this):(this.o=!1,Oi(this)))}else Ug(this.g),h==400&&0<N.indexOf("Unknown SID")?(this.s=3,Ce(12)):(this.s=0,Ce(13)),Jt(this),Tr(this)}}}catch{}finally{}};function nh(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function Eg(o,c){var h=o.C,f=c.indexOf(`
`,h);return f==-1?Fo:(h=Number(c.substring(h,f)),isNaN(h)?eh:(f+=1,f+h>c.length?Fo:(c=c.slice(f,f+h),o.C=f+h,c)))}St.prototype.cancel=function(){this.J=!0,Jt(this)};function Oi(o){o.S=Date.now()+o.I,rh(o,o.I)}function rh(o,c){if(o.B!=null)throw Error("WatchDog timer not null");o.B=wr(w(o.ba,o),c)}function Bo(o){o.B&&(u.clearTimeout(o.B),o.B=null)}St.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(vg(this.i,this.A),this.L!=2&&(vr(),Ce(17)),Jt(this),this.s=2,Tr(this)):rh(this,this.S-o)};function Tr(o){o.j.G==0||o.J||Ch(o.j,o)}function Jt(o){Bo(o);var c=o.M;c&&typeof c.ma=="function"&&c.ma(),o.M=null,Gl(o.U),o.g&&(c=o.g,o.g=null,c.abort(),c.ma())}function qo(o,c){try{var h=o.j;if(h.G!=0&&(h.g==o||$o(h.h,o))){if(!o.K&&$o(h.h,o)&&h.G==3){try{var f=h.Da.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var A=f;if(A[0]==0){e:if(!h.u){if(h.g)if(h.g.F+3e3<o.F)qi(h),Ui(h);else break e;Wo(h),Ce(18)}}else h.za=A[1],0<h.za-h.T&&37500>A[2]&&h.F&&h.v==0&&!h.C&&(h.C=wr(w(h.Za,h),6e3));if(1>=oh(h.h)&&h.ca){try{h.ca()}catch{}h.ca=void 0}}else Xt(h,11)}else if((o.K||h.g==o)&&qi(h),!q(c))for(A=h.Da.g.parse(c),c=0;c<A.length;c++){let Q=A[c];if(h.T=Q[0],Q=Q[1],h.G==2)if(Q[0]=="c"){h.K=Q[1],h.ia=Q[2];let we=Q[3];we!=null&&(h.la=we,h.j.info("VER="+h.la));let Ee=Q[4];Ee!=null&&(h.Aa=Ee,h.j.info("SVER="+h.Aa));let Pn=Q[5];Pn!=null&&typeof Pn=="number"&&0<Pn&&(f=1.5*Pn,h.L=f,h.j.info("backChannelRequestTimeoutMs_="+f)),f=h;let Ue=o.g;if(Ue){let ji=Ue.g?Ue.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ji){var S=f.h;S.g||ji.indexOf("spdy")==-1&&ji.indexOf("quic")==-1&&ji.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(jo(S,S.h),S.h=null))}if(f.D){let Ho=Ue.g?Ue.g.getResponseHeader("X-HTTP-Session-Id"):null;Ho&&(f.ya=Ho,ee(f.I,f.D,Ho))}}h.G=3,h.l&&h.l.ua(),h.ba&&(h.R=Date.now()-o.F,h.j.info("Handshake RTT: "+h.R+"ms")),f=h;var N=o;if(f.qa=Nh(f,f.J?f.ia:null,f.W),N.K){ah(f.h,N);var X=N,me=f.L;me&&(X.I=me),X.B&&(Bo(X),Oi(X)),f.g=N}else Rh(f);0<h.i.length&&Bi(h)}else Q[0]!="stop"&&Q[0]!="close"||Xt(h,7);else h.G==3&&(Q[0]=="stop"||Q[0]=="close"?Q[0]=="stop"?Xt(h,7):Go(h):Q[0]!="noop"&&h.l&&h.l.ta(Q),h.v=0)}}vr(4)}catch{}}var Tg=class{constructor(o,c){this.g=o,this.map=c}};function ih(o){this.l=o||10,u.PerformanceNavigationTiming?(o=u.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function sh(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function oh(o){return o.h?1:o.g?o.g.size:0}function $o(o,c){return o.h?o.h==c:o.g?o.g.has(c):!1}function jo(o,c){o.g?o.g.add(c):o.h=c}function ah(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}ih.prototype.cancel=function(){if(this.i=ch(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function ch(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let c=o.i;for(let h of o.g.values())c=c.concat(h.D);return c}return O(o.i)}function Ag(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(l(o)){for(var c=[],h=o.length,f=0;f<h;f++)c.push(o[f]);return c}c=[],h=0;for(f in o)c[h++]=o[f];return c}function bg(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(l(o)||typeof o=="string"){var c=[];o=o.length;for(var h=0;h<o;h++)c.push(h);return c}c=[],h=0;for(let f in o)c[h++]=f;return c}}}function uh(o,c){if(o.forEach&&typeof o.forEach=="function")o.forEach(c,void 0);else if(l(o)||typeof o=="string")Array.prototype.forEach.call(o,c,void 0);else for(var h=bg(o),f=Ag(o),A=f.length,S=0;S<A;S++)c.call(void 0,f[S],h&&h[S],o)}var lh=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Sg(o,c){if(o){o=o.split("&");for(var h=0;h<o.length;h++){var f=o[h].indexOf("="),A=null;if(0<=f){var S=o[h].substring(0,f);A=o[h].substring(f+1)}else S=o[h];c(S,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function Yt(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof Yt){this.h=o.h,xi(this,o.j),this.o=o.o,this.g=o.g,Vi(this,o.s),this.l=o.l;var c=o.i,h=new Sr;h.i=c.i,c.g&&(h.g=new Map(c.g),h.h=c.h),hh(this,h),this.m=o.m}else o&&(c=String(o).match(lh))?(this.h=!1,xi(this,c[1]||"",!0),this.o=Ar(c[2]||""),this.g=Ar(c[3]||"",!0),Vi(this,c[4]),this.l=Ar(c[5]||"",!0),hh(this,c[6]||"",!0),this.m=Ar(c[7]||"")):(this.h=!1,this.i=new Sr(null,this.h))}Yt.prototype.toString=function(){var o=[],c=this.j;c&&o.push(br(c,dh,!0),":");var h=this.g;return(h||c=="file")&&(o.push("//"),(c=this.o)&&o.push(br(c,dh,!0),"@"),o.push(encodeURIComponent(String(h)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.s,h!=null&&o.push(":",String(h))),(h=this.l)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(br(h,h.charAt(0)=="/"?Cg:Pg,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",br(h,Dg)),o.join("")};function ot(o){return new Yt(o)}function xi(o,c,h){o.j=h?Ar(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function Vi(o,c){if(c){if(c=Number(c),isNaN(c)||0>c)throw Error("Bad port number "+c);o.s=c}else o.s=null}function hh(o,c,h){c instanceof Sr?(o.i=c,Ng(o.i,o.h)):(h||(c=br(c,kg)),o.i=new Sr(c,o.h))}function ee(o,c,h){o.i.set(c,h)}function Li(o){return ee(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function Ar(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function br(o,c,h){return typeof o=="string"?(o=encodeURI(o).replace(c,Rg),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Rg(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var dh=/[#\/\?@]/g,Pg=/[#\?:]/g,Cg=/[#\?]/g,kg=/[#\?@]/g,Dg=/#/g;function Sr(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function Rt(o){o.g||(o.g=new Map,o.h=0,o.i&&Sg(o.i,function(c,h){o.add(decodeURIComponent(c.replace(/\+/g," ")),h)}))}n=Sr.prototype,n.add=function(o,c){Rt(this),this.i=null,o=Sn(this,o);var h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(c),this.h+=1,this};function fh(o,c){Rt(o),c=Sn(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function ph(o,c){return Rt(o),c=Sn(o,c),o.g.has(c)}n.forEach=function(o,c){Rt(this),this.g.forEach(function(h,f){h.forEach(function(A){o.call(c,A,f,this)},this)},this)},n.na=function(){Rt(this);let o=Array.from(this.g.values()),c=Array.from(this.g.keys()),h=[];for(let f=0;f<c.length;f++){let A=o[f];for(let S=0;S<A.length;S++)h.push(c[f])}return h},n.V=function(o){Rt(this);let c=[];if(typeof o=="string")ph(this,o)&&(c=c.concat(this.g.get(Sn(this,o))));else{o=Array.from(this.g.values());for(let h=0;h<o.length;h++)c=c.concat(o[h])}return c},n.set=function(o,c){return Rt(this),this.i=null,o=Sn(this,o),ph(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},n.get=function(o,c){return o?(o=this.V(o),0<o.length?String(o[0]):c):c};function mh(o,c,h){fh(o,c),0<h.length&&(o.i=null,o.g.set(Sn(o,c),O(h)),o.h+=h.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],c=Array.from(this.g.keys());for(var h=0;h<c.length;h++){var f=c[h];let S=encodeURIComponent(String(f)),N=this.V(f);for(f=0;f<N.length;f++){var A=S;N[f]!==""&&(A+="="+encodeURIComponent(String(N[f]))),o.push(A)}}return this.i=o.join("&")};function Sn(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function Ng(o,c){c&&!o.j&&(Rt(o),o.i=null,o.g.forEach(function(h,f){var A=f.toLowerCase();f!=A&&(fh(this,f),mh(this,A,h))},o)),o.j=c}function Og(o,c){let h=new Er;if(u.Image){let f=new Image;f.onload=R(Pt,h,"TestLoadImage: loaded",!0,c,f),f.onerror=R(Pt,h,"TestLoadImage: error",!1,c,f),f.onabort=R(Pt,h,"TestLoadImage: abort",!1,c,f),f.ontimeout=R(Pt,h,"TestLoadImage: timeout",!1,c,f),u.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=o}else c(!1)}function xg(o,c){let h=new Er,f=new AbortController,A=setTimeout(()=>{f.abort(),Pt(h,"TestPingServer: timeout",!1,c)},1e4);fetch(o,{signal:f.signal}).then(S=>{clearTimeout(A),S.ok?Pt(h,"TestPingServer: ok",!0,c):Pt(h,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(A),Pt(h,"TestPingServer: error",!1,c)})}function Pt(o,c,h,f,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),f(h)}catch{}}function Vg(){this.g=new _g}function Lg(o,c,h){let f=h||"";try{uh(o,function(A,S){let N=A;d(A)&&(N=Oo(A)),c.push(f+S+"="+encodeURIComponent(N))})}catch(A){throw c.push(f+"type="+encodeURIComponent("_badmap")),A}}function Rr(o){this.l=o.Ub||null,this.j=o.eb||!1}k(Rr,xo),Rr.prototype.g=function(){return new Mi(this.l,this.j)},Rr.prototype.i=function(o){return function(){return o}}({});function Mi(o,c){ve.call(this),this.D=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}k(Mi,ve),n=Mi.prototype,n.open=function(o,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=c,this.readyState=1,Cr(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let c={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(c.body=o),(this.D||u).fetch(new Request(this.A,c)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Pr(this)),this.readyState=0},n.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Cr(this)),this.g&&(this.readyState=3,Cr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;gh(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function gh(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}n.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.v.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?Pr(this):Cr(this),this.readyState==3&&gh(this)}},n.Ra=function(o){this.g&&(this.response=this.responseText=o,Pr(this))},n.Qa=function(o){this.g&&(this.response=o,Pr(this))},n.ga=function(){this.g&&Pr(this)};function Pr(o){o.readyState=4,o.l=null,o.j=null,o.v=null,Cr(o)}n.setRequestHeader=function(o,c){this.u.append(o,c)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],c=this.h.entries();for(var h=c.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=c.next();return o.join(`\r
`)};function Cr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Mi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function _h(o){let c="";return W(o,function(h,f){c+=f,c+=":",c+=h,c+=`\r
`}),c}function zo(o,c,h){e:{for(f in h){var f=!1;break e}f=!0}f||(h=_h(h),typeof o=="string"?h!=null&&encodeURIComponent(String(h)):ee(o,c,h))}function ce(o){ve.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}k(ce,ve);var Mg=/^https?$/i,Fg=["POST","PUT"];n=ce.prototype,n.Ha=function(o){this.J=o},n.ea=function(o,c,h,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Mo.g(),this.v=this.o?Wl(this.o):Wl(Mo),this.g.onreadystatechange=w(this.Ea,this);try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(S){yh(this,S);return}if(o=h||"",h=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var A in f)h.set(A,f[A]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(let S of f.keys())h.set(S,f.get(S));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(h.keys()).find(S=>S.toLowerCase()=="content-type"),A=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(Fg,c,void 0))||f||A||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[S,N]of h)this.g.setRequestHeader(S,N);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{wh(this),this.u=!0,this.g.send(o),this.u=!1}catch(S){yh(this,S)}};function yh(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.m=5,Ih(o),Fi(o)}function Ih(o){o.A||(o.A=!0,Pe(o,"complete"),Pe(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Pe(this,"complete"),Pe(this,"abort"),Fi(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Fi(this,!0)),ce.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?vh(this):this.bb())},n.bb=function(){vh(this)};function vh(o){if(o.h&&typeof a<"u"&&(!o.v[1]||at(o)!=4||o.Z()!=2)){if(o.u&&at(o)==4)$l(o.Ea,0,o);else if(Pe(o,"readystatechange"),at(o)==4){o.h=!1;try{let N=o.Z();e:switch(N){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var h;if(!(h=c)){var f;if(f=N===0){var A=String(o.D).match(lh)[1]||null;!A&&u.self&&u.self.location&&(A=u.self.location.protocol.slice(0,-1)),f=!Mg.test(A?A.toLowerCase():"")}h=f}if(h)Pe(o,"complete"),Pe(o,"success");else{o.m=6;try{var S=2<at(o)?o.g.statusText:""}catch{S=""}o.l=S+" ["+o.Z()+"]",Ih(o)}}finally{Fi(o)}}}}function Fi(o,c){if(o.g){wh(o);let h=o.g,f=o.v[0]?()=>{}:null;o.g=null,o.v=null,c||Pe(o,"ready");try{h.onreadystatechange=f}catch{}}}function wh(o){o.I&&(u.clearTimeout(o.I),o.I=null)}n.isActive=function(){return!!this.g};function at(o){return o.g?o.g.readyState:0}n.Z=function(){try{return 2<at(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(o){if(this.g){var c=this.g.responseText;return o&&c.indexOf(o)==0&&(c=c.substring(o.length)),gg(c)}};function Eh(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function Ug(o){let c={};o=(o.g&&2<=at(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<o.length;f++){if(q(o[f]))continue;var h=T(o[f]);let A=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();let S=c[A]||[];c[A]=S,S.push(h)}E(c,function(f){return f.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function kr(o,c,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||c}function Th(o){this.Aa=0,this.i=[],this.j=new Er,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=kr("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=kr("baseRetryDelayMs",5e3,o),this.cb=kr("retryDelaySeedMs",1e4,o),this.Wa=kr("forwardChannelMaxRetries",2,o),this.wa=kr("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new ih(o&&o.concurrentRequestLimit),this.Da=new Vg,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Th.prototype,n.la=8,n.G=1,n.connect=function(o,c,h,f){Ce(0),this.W=o,this.H=c||{},h&&f!==void 0&&(this.H.OSID=h,this.H.OAID=f),this.F=this.X,this.I=Nh(this,null,this.W),Bi(this)};function Go(o){if(Ah(o),o.G==3){var c=o.U++,h=ot(o.I);if(ee(h,"SID",o.K),ee(h,"RID",c),ee(h,"TYPE","terminate"),Dr(o,h),c=new St(o,o.j,c),c.L=2,c.v=Li(ot(h)),h=!1,u.navigator&&u.navigator.sendBeacon)try{h=u.navigator.sendBeacon(c.v.toString(),"")}catch{}!h&&u.Image&&(new Image().src=c.v,h=!0),h||(c.g=Oh(c.j,null),c.g.ea(c.v)),c.F=Date.now(),Oi(c)}Dh(o)}function Ui(o){o.g&&(Ko(o),o.g.cancel(),o.g=null)}function Ah(o){Ui(o),o.u&&(u.clearTimeout(o.u),o.u=null),qi(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&u.clearTimeout(o.s),o.s=null)}function Bi(o){if(!sh(o.h)&&!o.s){o.s=!0;var c=o.Ga;pr||Ll(),mr||(pr(),mr=!0),Ao.add(c,o),o.B=0}}function Bg(o,c){return oh(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=c.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=wr(w(o.Ga,o,c),kh(o,o.B)),o.B++,!0)}n.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let A=new St(this,this.j,o),S=this.o;if(this.S&&(S?(S=m(S),v(S,this.S)):S=this.S),this.m!==null||this.O||(A.H=S,S=null),this.P)e:{for(var c=0,h=0;h<this.i.length;h++){t:{var f=this.i[h];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(c+=f,4096<c){c=h;break e}if(c===4096||h===this.i.length-1){c=h+1;break e}}c=1e3}else c=1e3;c=Sh(this,A,c),h=ot(this.I),ee(h,"RID",o),ee(h,"CVER",22),this.D&&ee(h,"X-HTTP-Session-Id",this.D),Dr(this,h),S&&(this.O?c="headers="+encodeURIComponent(String(_h(S)))+"&"+c:this.m&&zo(h,this.m,S)),jo(this.h,A),this.Ua&&ee(h,"TYPE","init"),this.P?(ee(h,"$req",c),ee(h,"SID","null"),A.T=!0,Uo(A,h,null)):Uo(A,h,c),this.G=2}}else this.G==3&&(o?bh(this,o):this.i.length==0||sh(this.h)||bh(this))};function bh(o,c){var h;c?h=c.l:h=o.U++;let f=ot(o.I);ee(f,"SID",o.K),ee(f,"RID",h),ee(f,"AID",o.T),Dr(o,f),o.m&&o.o&&zo(f,o.m,o.o),h=new St(o,o.j,h,o.B+1),o.m===null&&(h.H=o.o),c&&(o.i=c.D.concat(o.i)),c=Sh(o,h,1e3),h.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),jo(o.h,h),Uo(h,f,c)}function Dr(o,c){o.H&&W(o.H,function(h,f){ee(c,f,h)}),o.l&&uh({},function(h,f){ee(c,f,h)})}function Sh(o,c,h){h=Math.min(o.i.length,h);var f=o.l?w(o.l.Na,o.l,o):null;e:{var A=o.i;let S=-1;for(;;){let N=["count="+h];S==-1?0<h?(S=A[0].g,N.push("ofs="+S)):S=0:N.push("ofs="+S);let X=!0;for(let me=0;me<h;me++){let Q=A[me].g,we=A[me].map;if(Q-=S,0>Q)S=Math.max(0,A[me].g-100),X=!1;else try{Lg(we,N,"req"+Q+"_")}catch{f&&f(we)}}if(X){f=N.join("&");break e}}}return o=o.i.splice(0,h),c.D=o,f}function Rh(o){if(!o.g&&!o.u){o.Y=1;var c=o.Fa;pr||Ll(),mr||(pr(),mr=!0),Ao.add(c,o),o.v=0}}function Wo(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=wr(w(o.Fa,o),kh(o,o.v)),o.v++,!0)}n.Fa=function(){if(this.u=null,Ph(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=wr(w(this.ab,this),o)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ce(10),Ui(this),Ph(this))};function Ko(o){o.A!=null&&(u.clearTimeout(o.A),o.A=null)}function Ph(o){o.g=new St(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var c=ot(o.qa);ee(c,"RID","rpc"),ee(c,"SID",o.K),ee(c,"AID",o.T),ee(c,"CI",o.F?"0":"1"),!o.F&&o.ja&&ee(c,"TO",o.ja),ee(c,"TYPE","xmlhttp"),Dr(o,c),o.m&&o.o&&zo(c,o.m,o.o),o.L&&(o.g.I=o.L);var h=o.g;o=o.ia,h.L=1,h.v=Li(ot(c)),h.m=null,h.P=!0,th(h,o)}n.Za=function(){this.C!=null&&(this.C=null,Ui(this),Wo(this),Ce(19))};function qi(o){o.C!=null&&(u.clearTimeout(o.C),o.C=null)}function Ch(o,c){var h=null;if(o.g==c){qi(o),Ko(o),o.g=null;var f=2}else if($o(o.h,c))h=c.D,ah(o.h,c),f=1;else return;if(o.G!=0){if(c.o)if(f==1){h=c.m?c.m.length:0,c=Date.now()-c.F;var A=o.B;f=ki(),Pe(f,new Yl(f,h)),Bi(o)}else Rh(o);else if(A=c.s,A==3||A==0&&0<c.X||!(f==1&&Bg(o,c)||f==2&&Wo(o)))switch(h&&0<h.length&&(c=o.h,c.i=c.i.concat(h)),A){case 1:Xt(o,5);break;case 4:Xt(o,10);break;case 3:Xt(o,6);break;default:Xt(o,2)}}}function kh(o,c){let h=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(h*=2),h*c}function Xt(o,c){if(o.j.info("Error code "+c),c==2){var h=w(o.fb,o),f=o.Xa;let A=!f;f=new Yt(f||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||xi(f,"https"),Li(f),A?Og(f.toString(),h):xg(f.toString(),h)}else Ce(2);o.G=0,o.l&&o.l.sa(c),Dh(o),Ah(o)}n.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Ce(2)):(this.j.info("Failed to ping google.com"),Ce(1))};function Dh(o){if(o.G=0,o.ka=[],o.l){let c=ch(o.h);(c.length!=0||o.i.length!=0)&&(C(o.ka,c),C(o.ka,o.i),o.h.i.length=0,O(o.i),o.i.length=0),o.l.ra()}}function Nh(o,c,h){var f=h instanceof Yt?ot(h):new Yt(h);if(f.g!="")c&&(f.g=c+"."+f.g),Vi(f,f.s);else{var A=u.location;f=A.protocol,c=c?c+"."+A.hostname:A.hostname,A=+A.port;var S=new Yt(null);f&&xi(S,f),c&&(S.g=c),A&&Vi(S,A),h&&(S.l=h),f=S}return h=o.D,c=o.ya,h&&c&&ee(f,h,c),ee(f,"VER",o.la),Dr(o,f),f}function Oh(o,c,h){if(c&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return c=o.Ca&&!o.pa?new ce(new Rr({eb:h})):new ce(o.pa),c.Ha(o.J),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function xh(){}n=xh.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function $i(){}$i.prototype.g=function(o,c){return new Ne(o,c)};function Ne(o,c){ve.call(this),this.g=new Th(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.va&&(o?o["X-WebChannel-Client-Profile"]=c.va:o={"X-WebChannel-Client-Profile":c.va}),this.g.S=o,(o=c&&c.Sb)&&!q(o)&&(this.g.m=o),this.v=c&&c.supportsCrossDomainXhr||!1,this.u=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!q(c)&&(this.g.D=c,o=this.h,o!==null&&c in o&&(o=this.h,c in o&&delete o[c])),this.j=new Rn(this)}k(Ne,ve),Ne.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ne.prototype.close=function(){Go(this.g)},Ne.prototype.o=function(o){var c=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.u&&(h={},h.__data__=Oo(o),o=h);c.i.push(new Tg(c.Ya++,o)),c.G==3&&Bi(c)},Ne.prototype.N=function(){this.g.l=null,delete this.j,Go(this.g),delete this.g,Ne.aa.N.call(this)};function Vh(o){Vo.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){e:{for(let h in c){o=h;break e}o=void 0}(this.i=o)&&(o=this.i,c=c!==null&&o in c?c[o]:void 0),this.data=c}else this.data=o}k(Vh,Vo);function Lh(){Lo.call(this),this.status=1}k(Lh,Lo);function Rn(o){this.g=o}k(Rn,xh),Rn.prototype.ua=function(){Pe(this.g,"a")},Rn.prototype.ta=function(o){Pe(this.g,new Vh(o))},Rn.prototype.sa=function(o){Pe(this.g,new Lh)},Rn.prototype.ra=function(){Pe(this.g,"b")},$i.prototype.createWebChannel=$i.prototype.g,Ne.prototype.send=Ne.prototype.o,Ne.prototype.open=Ne.prototype.m,Ne.prototype.close=Ne.prototype.close,pc=It.createWebChannelTransport=function(){return new $i},fc=It.getStatEventTarget=function(){return ki()},dc=It.Event=Qt,Is=It.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Di.NO_ERROR=0,Di.TIMEOUT=8,Di.HTTP_ERROR=6,Hr=It.ErrorCode=Di,Xl.COMPLETE="complete",hc=It.EventType=Xl,Kl.EventType=Ir,Ir.OPEN="a",Ir.CLOSE="b",Ir.ERROR="c",Ir.MESSAGE="d",ve.prototype.listen=ve.prototype.K,Fn=It.WebChannel=Kl,Jv=It.FetchXmlHttpFactory=Rr,ce.prototype.listenOnce=ce.prototype.L,ce.prototype.getLastError=ce.prototype.Ka,ce.prototype.getLastErrorCode=ce.prototype.Ba,ce.prototype.getStatus=ce.prototype.Z,ce.prototype.getResponseJson=ce.prototype.Oa,ce.prototype.getResponseText=ce.prototype.oa,ce.prototype.send=ce.prototype.ea,ce.prototype.setWithCredentials=ce.prototype.Ha,lc=It.XhrIo=ce}).apply(typeof ys<"u"?ys:typeof self<"u"?self:typeof window<"u"?window:{});var Tf="@firebase/firestore";var pe=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};pe.UNAUTHENTICATED=new pe(null),pe.GOOGLE_CREDENTIALS=new pe("google-credentials-uid"),pe.FIRST_PARTY=new pe("first-party-uid"),pe.MOCK_USER=new pe("mock-user");var rr="10.14.0";var fn=new xt("@firebase/firestore");function Qr(){return fn.logLevel}function V(n,...e){if(fn.logLevel<=G.DEBUG){let t=e.map(Ju);fn.debug(`Firestore (${rr}): ${n}`,...t)}}function vt(n,...e){if(fn.logLevel<=G.ERROR){let t=e.map(Ju);fn.error(`Firestore (${rr}): ${n}`,...t)}}function Gn(n,...e){if(fn.logLevel<=G.WARN){let t=e.map(Ju);fn.warn(`Firestore (${rr}): ${n}`,...t)}}function Ju(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function B(n="Unexpected state"){let e=`FIRESTORE (${rr}) INTERNAL ASSERTION FAILED: `+n;throw vt(e),new Error(e)}function Y(n,e){n||B()}function $(n,e){return n}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},x=class extends Te{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var je=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var As=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Ic=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(pe.UNAUTHENTICATED))}shutdown(){}},vc=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},wc=class{constructor(e){this.t=e,this.currentUser=pe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Y(this.o===void 0);let r=this.i,i=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve(),s=new je;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new je,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let l=s;e.enqueueRetryable(()=>g(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},u=l=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>u(l)),setTimeout(()=>{if(!this.auth){let l=this.t.getImmediate({optional:!0});l?u(l):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new je)}},0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Y(typeof r.accessToken=="string"),new As(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return Y(e===null||typeof e=="string"),new pe(e)}},Ec=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=pe.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Tc=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new Ec(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(pe.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ac=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},bc=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Y(this.o===void 0);let r=s=>{s.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let a=s.token!==this.R;return this.R=s.token,V("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Y(typeof t.token=="string"),this.R=t.token,new Ac(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function Yv(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var bs=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=Yv(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}};function J(n,e){return n<e?-1:n>e?1:0}function Wn(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}var _e=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new x(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new x(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new x(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new x(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?J(this.nanoseconds,e.nanoseconds):J(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var z=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new _e(0,0))}static max(){return new n(new _e(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Ss=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&B(),r===void 0?r=e.length-t:r>e.length-t&&B(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),a=t.get(i);if(s<a)return-1;if(s>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},se=class n extends Ss{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new x(P.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},Xv=/^[_a-zA-Z][_a-zA-Z0-9]*$/,xe=class n extends Ss{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return Xv.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new x(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},a=!1;for(;i<e.length;){let u=e[i];if(u==="\\"){if(i+1===e.length)throw new x(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new x(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(r+=u,i++):(s(),i++)}if(s(),a)throw new x(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var L=class n{constructor(e){this.path=e}static fromPath(e){return new n(se.fromString(e))}static fromName(e){return new n(se.fromString(e).popFirst(5))}static empty(){return new n(se.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&se.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return se.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new se(e.slice()))}};var Sc=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};Sc.UNKNOWN_ID=-1;function Zv(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=z.fromTimestamp(r===1e9?new _e(t+1,0):new _e(t,r));return new pn(i,L.empty(),e)}function ew(n){return new pn(n.readTime,n.key,-1)}var pn=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(z.min(),L.empty(),-1)}static max(){return new n(z.max(),L.empty(),-1)}};function tw(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=L.comparator(n.documentKey,e.documentKey),t!==0?t:J(n.largestBatchId,e.largestBatchId))}var nw="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Rc=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function gi(n){return g(this,null,function*(){if(n.code!==P.FAILED_PRECONDITION||n.message!==nw)throw n;V("LocalStore","Unexpectedly lost primary lease")})}var D=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&B(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,a=!1;e.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&t()},l=>r(l))}),a=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,a=new Array(s),u=0;for(let l=0;l<s;l++){let d=l;t(e[d]).next(p=>{a[d]=p,++u,u===s&&r(a)},p=>i(p))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};function rw(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function _i(n){return n.name==="IndexedDbTransactionError"}var ip=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function io(n){return n==null}function ti(n){return n===0&&1/n==-1/0}function iw(n){return typeof n=="number"&&Number.isInteger(n)&&!ti(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var sw=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Hb=[...sw,"documentOverlays"],ow=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],aw=ow,cw=[...aw,"indexConfiguration","indexState","indexEntries"];var Qb=[...cw,"globals"];function Af(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function vn(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function sp(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var ue=class n{constructor(e,t){this.comparator=e,this.root=t||Xe.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Xe.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Xe.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new $n(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new $n(this.root,e,this.comparator,!1)}getReverseIterator(){return new $n(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new $n(this.root,e,this.comparator,!0)}},$n=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Xe=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw B();let e=this.left.check();if(e!==this.right.check())throw B();return e+(this.isRed()?0:1)}};Xe.EMPTY=null,Xe.RED=!0,Xe.BLACK=!1;Xe.EMPTY=new class{constructor(){this.size=0}get key(){throw B()}get value(){throw B()}get color(){throw B()}get left(){throw B()}get right(){throw B()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Xe(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var be=class n{constructor(e){this.comparator=e,this.data=new ue(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Rs(this.data.getIterator())}getIteratorFrom(e){return new Rs(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Rs=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Me=class n{constructor(e){this.fields=e,e.sort(xe.comparator)}static empty(){return new n([])}unionWith(e){let t=new be(xe.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Wn(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var Ps=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Re=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Ps("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return J(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Re.EMPTY_BYTE_STRING=new Re("");var uw=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function wt(n){if(Y(!!n),typeof n=="string"){let e=0,t=uw.exec(n);if(Y(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:re(n.seconds),nanos:re(n.nanos)}}function re(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function jt(n){return typeof n=="string"?Re.fromBase64String(n):Re.fromUint8Array(n)}function Yu(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Xu(n){let e=n.mapValue.fields.__previous_value__;return Yu(e)?Xu(e):e}function ni(n){let e=wt(n.mapValue.fields.__local_write_time__.timestampValue);return new _e(e.seconds,e.nanos)}var Pc=class{constructor(e,t,r,i,s,a,u,l,d){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=l,this.useFetchStreams=d}},Cs=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var vs={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function mn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Yu(n)?4:ap(n)?9007199254740991:op(n)?10:11:B()}function tt(n,e){if(n===e)return!0;let t=mn(n);if(t!==mn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ni(n).isEqual(ni(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let a=wt(i.timestampValue),u=wt(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return jt(i.bytesValue).isEqual(jt(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return re(i.geoPointValue.latitude)===re(s.geoPointValue.latitude)&&re(i.geoPointValue.longitude)===re(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return re(i.integerValue)===re(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let a=re(i.doubleValue),u=re(s.doubleValue);return a===u?ti(a)===ti(u):isNaN(a)&&isNaN(u)}return!1}(n,e);case 9:return Wn(n.arrayValue.values||[],e.arrayValue.values||[],tt);case 10:case 11:return function(i,s){let a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(Af(a)!==Af(u))return!1;for(let l in a)if(a.hasOwnProperty(l)&&(u[l]===void 0||!tt(a[l],u[l])))return!1;return!0}(n,e);default:return B()}}function ri(n,e){return(n.values||[]).find(t=>tt(t,e))!==void 0}function Kn(n,e){if(n===e)return 0;let t=mn(n),r=mn(e);if(t!==r)return J(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return J(n.booleanValue,e.booleanValue);case 2:return function(s,a){let u=re(s.integerValue||s.doubleValue),l=re(a.integerValue||a.doubleValue);return u<l?-1:u>l?1:u===l?0:isNaN(u)?isNaN(l)?0:-1:1}(n,e);case 3:return bf(n.timestampValue,e.timestampValue);case 4:return bf(ni(n),ni(e));case 5:return J(n.stringValue,e.stringValue);case 6:return function(s,a){let u=jt(s),l=jt(a);return u.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(s,a){let u=s.split("/"),l=a.split("/");for(let d=0;d<u.length&&d<l.length;d++){let p=J(u[d],l[d]);if(p!==0)return p}return J(u.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,a){let u=J(re(s.latitude),re(a.latitude));return u!==0?u:J(re(s.longitude),re(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Sf(n.arrayValue,e.arrayValue);case 10:return function(s,a){var u,l,d,p;let I=s.fields||{},w=a.fields||{},R=(u=I.value)===null||u===void 0?void 0:u.arrayValue,k=(l=w.value)===null||l===void 0?void 0:l.arrayValue,O=J(((d=R?.values)===null||d===void 0?void 0:d.length)||0,((p=k?.values)===null||p===void 0?void 0:p.length)||0);return O!==0?O:Sf(R,k)}(n.mapValue,e.mapValue);case 11:return function(s,a){if(s===vs.mapValue&&a===vs.mapValue)return 0;if(s===vs.mapValue)return 1;if(a===vs.mapValue)return-1;let u=s.fields||{},l=Object.keys(u),d=a.fields||{},p=Object.keys(d);l.sort(),p.sort();for(let I=0;I<l.length&&I<p.length;++I){let w=J(l[I],p[I]);if(w!==0)return w;let R=Kn(u[l[I]],d[p[I]]);if(R!==0)return R}return J(l.length,p.length)}(n.mapValue,e.mapValue);default:throw B()}}function bf(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return J(n,e);let t=wt(n),r=wt(e),i=J(t.seconds,r.seconds);return i!==0?i:J(t.nanos,r.nanos)}function Sf(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Kn(t[i],r[i]);if(s)return s}return J(t.length,r.length)}function Hn(n){return Cc(n)}function Cc(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=wt(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return jt(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return L.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=Cc(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let a of r)s?s=!1:i+=",",i+=`${a}:${Cc(t.fields[a])}`;return i+"}"}(n.mapValue):B()}function Rf(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function kc(n){return!!n&&"integerValue"in n}function Zu(n){return!!n&&"arrayValue"in n}function Pf(n){return!!n&&"nullValue"in n}function Cf(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Es(n){return!!n&&"mapValue"in n}function op(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Yr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return vn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Yr(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Yr(n.arrayValue.values[t]);return e}return Object.assign({},n)}function ap(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var Oe=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Es(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Yr(t)}setAll(e){let t=xe.emptyPath(),r={},i=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=u.popLast()}a?r[u.lastSegment()]=Yr(a):i.push(u.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Es(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return tt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Es(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){vn(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Yr(this.value))}};function cp(n){let e=[];return vn(n.fields,(t,r)=>{let i=new xe([t]);if(Es(r)){let s=cp(r.mapValue).fields;if(s.length===0)e.push(i);else for(let a of s)e.push(i.child(a))}else e.push(i)}),new Me(e)}var ze=class n{constructor(e,t,r,i,s,a,u){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(e){return new n(e,0,z.min(),z.min(),z.min(),Oe.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,z.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,z.min(),z.min(),Oe.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,z.min(),z.min(),Oe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(z.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Oe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Oe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=z.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Qn=class{constructor(e,t){this.position=e,this.inclusive=t}};function kf(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],a=n.position[i];if(s.field.isKeyField()?r=L.comparator(L.fromName(a.referenceValue),t.key):r=Kn(a,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function Df(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!tt(n.position[t],e.position[t]))return!1;return!0}var gn=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function lw(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var ks=class{},de=class n extends ks{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Nc(e,t,r):t==="array-contains"?new Vc(e,r):t==="in"?new Lc(e,r):t==="not-in"?new Mc(e,r):t==="array-contains-any"?new Fc(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Oc(e,r):new xc(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Kn(t,this.value)):t!==null&&mn(this.value)===mn(t)&&this.matchesComparison(Kn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return B()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Ge=class n extends ks{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return up(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function up(n){return n.op==="and"}function lp(n){return hw(n)&&up(n)}function hw(n){for(let e of n.filters)if(e instanceof Ge)return!1;return!0}function Dc(n){if(n instanceof de)return n.field.canonicalString()+n.op.toString()+Hn(n.value);if(lp(n))return n.filters.map(e=>Dc(e)).join(",");{let e=n.filters.map(t=>Dc(t)).join(",");return`${n.op}(${e})`}}function hp(n,e){return n instanceof de?function(r,i){return i instanceof de&&r.op===i.op&&r.field.isEqual(i.field)&&tt(r.value,i.value)}(n,e):n instanceof Ge?function(r,i){return i instanceof Ge&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,a,u)=>s&&hp(a,i.filters[u]),!0):!1}(n,e):void B()}function dp(n){return n instanceof de?function(t){return`${t.field.canonicalString()} ${t.op} ${Hn(t.value)}`}(n):n instanceof Ge?function(t){return t.op.toString()+" {"+t.getFilters().map(dp).join(" ,")+"}"}(n):"Filter"}var Nc=class extends de{constructor(e,t,r){super(e,t,r),this.key=L.fromName(r.referenceValue)}matches(e){let t=L.comparator(e.key,this.key);return this.matchesComparison(t)}},Oc=class extends de{constructor(e,t){super(e,"in",t),this.keys=fp("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},xc=class extends de{constructor(e,t){super(e,"not-in",t),this.keys=fp("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function fp(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>L.fromName(r.referenceValue))}var Vc=class extends de{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Zu(t)&&ri(t.arrayValue,this.value)}},Lc=class extends de{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&ri(this.value.arrayValue,t)}},Mc=class extends de{constructor(e,t){super(e,"not-in",t)}matches(e){if(ri(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!ri(this.value.arrayValue,t)}},Fc=class extends de{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Zu(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>ri(this.value.arrayValue,r))}};var Uc=class{constructor(e,t=null,r=[],i=[],s=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.ue=null}};function Nf(n,e=null,t=[],r=[],i=null,s=null,a=null){return new Uc(n,e,t,r,i,s,a)}function el(n){let e=$(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Dc(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),io(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Hn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Hn(r)).join(",")),e.ue=t}return e.ue}function tl(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!lw(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!hp(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Df(n.startAt,e.startAt)&&Df(n.endAt,e.endAt)}function Bc(n){return L.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var zt=class{constructor(e,t=null,r=[],i=[],s=null,a="F",u=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function dw(n,e,t,r,i,s,a,u){return new zt(n,e,t,r,i,s,a,u)}function so(n){return new zt(n)}function Of(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function pp(n){return n.collectionGroup!==null}function Xr(n){let e=$(n);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new be(xe.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(d=>{d.isInequality()&&(u=u.add(d.field))})}),u})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new gn(s,r))}),t.has(xe.keyField().canonicalString())||e.ce.push(new gn(xe.keyField(),r))}return e.ce}function Ze(n){let e=$(n);return e.le||(e.le=fw(e,Xr(n))),e.le}function fw(n,e){if(n.limitType==="F")return Nf(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new gn(i.field,s)});let t=n.endAt?new Qn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Qn(n.startAt.position,n.startAt.inclusive):null;return Nf(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function qc(n,e){let t=n.filters.concat([e]);return new zt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function $c(n,e,t){return new zt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function oo(n,e){return tl(Ze(n),Ze(e))&&n.limitType===e.limitType}function mp(n){return`${el(Ze(n))}|lt:${n.limitType}`}function Un(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>dp(i)).join(", ")}]`),io(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Hn(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Hn(i)).join(",")),`Target(${r})`}(Ze(n))}; limitType=${n.limitType})`}function ao(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):L.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of Xr(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(a,u,l){let d=kf(a,u,l);return a.inclusive?d<=0:d<0}(r.startAt,Xr(r),i)||r.endAt&&!function(a,u,l){let d=kf(a,u,l);return a.inclusive?d>=0:d>0}(r.endAt,Xr(r),i))}(n,e)}function pw(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function gp(n){return(e,t)=>{let r=!1;for(let i of Xr(n)){let s=mw(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function mw(n,e,t){let r=n.field.isKeyField()?L.comparator(e.key,t.key):function(s,a,u){let l=a.data.field(s),d=u.data.field(s);return l!==null&&d!==null?Kn(l,d):B()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return B()}}var Gt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){vn(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return sp(this.inner)}size(){return this.innerSize}};var gw=new ue(L.comparator);function Et(){return gw}var _p=new ue(L.comparator);function Jr(...n){let e=_p;for(let t of n)e=e.insert(t.key,t);return e}function yp(n){let e=_p;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function ln(){return Zr()}function Ip(){return Zr()}function Zr(){return new Gt(n=>n.toString(),(n,e)=>n.isEqual(e))}var _w=new ue(L.comparator),yw=new be(L.comparator);function K(...n){let e=yw;for(let t of n)e=e.add(t);return e}var Iw=new be(J);function vw(){return Iw}function nl(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ti(e)?"-0":e}}function vp(n){return{integerValue:""+n}}function ww(n,e){return iw(e)?vp(e):nl(n,e)}var Jn=class{constructor(){this._=void 0}};function Ew(n,e,t){return n instanceof Yn?function(i,s){let a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Yu(s)&&(s=Xu(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(t,e):n instanceof _n?Ep(n,e):n instanceof yn?Tp(n,e):function(i,s){let a=wp(i,s),u=xf(a)+xf(i.Pe);return kc(a)&&kc(i.Pe)?vp(u):nl(i.serializer,u)}(n,e)}function Tw(n,e,t){return n instanceof _n?Ep(n,e):n instanceof yn?Tp(n,e):t}function wp(n,e){return n instanceof Xn?function(r){return kc(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var Yn=class extends Jn{},_n=class extends Jn{constructor(e){super(),this.elements=e}};function Ep(n,e){let t=Ap(e);for(let r of n.elements)t.some(i=>tt(i,r))||t.push(r);return{arrayValue:{values:t}}}var yn=class extends Jn{constructor(e){super(),this.elements=e}};function Tp(n,e){let t=Ap(e);for(let r of n.elements)t=t.filter(i=>!tt(i,r));return{arrayValue:{values:t}}}var Xn=class extends Jn{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function xf(n){return re(n.integerValue||n.doubleValue)}function Ap(n){return Zu(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Aw(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof _n&&i instanceof _n||r instanceof yn&&i instanceof yn?Wn(r.elements,i.elements,tt):r instanceof Xn&&i instanceof Xn?tt(r.Pe,i.Pe):r instanceof Yn&&i instanceof Yn}(n.transform,e.transform)}var jc=class{constructor(e,t){this.version=e,this.transformResults=t}},qt=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Ts(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Zn=class{};function bp(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Ds(n.key,qt.none()):new In(n.key,n.data,qt.none());{let t=n.data,r=Oe.empty(),i=new be(xe.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?r.delete(s):r.set(s,a),i=i.add(s)}return new nt(n.key,r,new Me(i.toArray()),qt.none())}}function bw(n,e,t){n instanceof In?function(i,s,a){let u=i.value.clone(),l=Lf(i.fieldTransforms,s,a.transformResults);u.setAll(l),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(n,e,t):n instanceof nt?function(i,s,a){if(!Ts(i.precondition,s))return void s.convertToUnknownDocument(a.version);let u=Lf(i.fieldTransforms,s,a.transformResults),l=s.data;l.setAll(Sp(i)),l.setAll(u),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(n,e,t):function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function ei(n,e,t,r){return n instanceof In?function(s,a,u,l){if(!Ts(s.precondition,a))return u;let d=s.value.clone(),p=Mf(s.fieldTransforms,l,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(n,e,t,r):n instanceof nt?function(s,a,u,l){if(!Ts(s.precondition,a))return u;let d=Mf(s.fieldTransforms,l,a),p=a.data;return p.setAll(Sp(s)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),u===null?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(I=>I.field))}(n,e,t,r):function(s,a,u){return Ts(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(n,e,t)}function Sw(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=wp(r.transform,i||null);s!=null&&(t===null&&(t=Oe.empty()),t.set(r.field,s))}return t||null}function Vf(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Wn(r,i,(s,a)=>Aw(s,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var In=class extends Zn{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},nt=class extends Zn{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function Sp(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function Lf(n,e,t){let r=new Map;Y(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],a=s.transform,u=e.data.field(s.field);r.set(s.field,Tw(a,u,t[i]))}return r}function Mf(n,e,t){let r=new Map;for(let i of n){let s=i.transform,a=t.data.field(i.field);r.set(i.field,Ew(s,a,e))}return r}var Ds=class extends Zn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},zc=class extends Zn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Gc=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&bw(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=ei(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=ei(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=Ip();return this.mutations.forEach(i=>{let s=e.get(i.key),a=s.overlayedDocument,u=this.applyToLocalView(a,s.mutatedFields);u=t.has(i.key)?null:u;let l=bp(a,u);l!==null&&r.set(i.key,l),a.isValidDocument()||a.convertToNoDocument(z.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),K())}isEqual(e){return this.batchId===e.batchId&&Wn(this.mutations,e.mutations,(t,r)=>Vf(t,r))&&Wn(this.baseMutations,e.baseMutations,(t,r)=>Vf(t,r))}},Wc=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){Y(e.mutations.length===r.length);let i=function(){return _w}(),s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,r[a].version);return new n(e,t,r,i)}};var Kc=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Hc=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var le,H;function Rw(n){switch(n){default:return B();case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0}}function Rp(n){if(n===void 0)return vt("GRPC error has no .code"),P.UNKNOWN;switch(n){case le.OK:return P.OK;case le.CANCELLED:return P.CANCELLED;case le.UNKNOWN:return P.UNKNOWN;case le.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case le.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case le.INTERNAL:return P.INTERNAL;case le.UNAVAILABLE:return P.UNAVAILABLE;case le.UNAUTHENTICATED:return P.UNAUTHENTICATED;case le.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case le.NOT_FOUND:return P.NOT_FOUND;case le.ALREADY_EXISTS:return P.ALREADY_EXISTS;case le.PERMISSION_DENIED:return P.PERMISSION_DENIED;case le.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case le.ABORTED:return P.ABORTED;case le.OUT_OF_RANGE:return P.OUT_OF_RANGE;case le.UNIMPLEMENTED:return P.UNIMPLEMENTED;case le.DATA_LOSS:return P.DATA_LOSS;default:return B()}}(H=le||(le={}))[H.OK=0]="OK",H[H.CANCELLED=1]="CANCELLED",H[H.UNKNOWN=2]="UNKNOWN",H[H.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",H[H.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",H[H.NOT_FOUND=5]="NOT_FOUND",H[H.ALREADY_EXISTS=6]="ALREADY_EXISTS",H[H.PERMISSION_DENIED=7]="PERMISSION_DENIED",H[H.UNAUTHENTICATED=16]="UNAUTHENTICATED",H[H.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",H[H.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",H[H.ABORTED=10]="ABORTED",H[H.OUT_OF_RANGE=11]="OUT_OF_RANGE",H[H.UNIMPLEMENTED=12]="UNIMPLEMENTED",H[H.INTERNAL=13]="INTERNAL",H[H.UNAVAILABLE=14]="UNAVAILABLE",H[H.DATA_LOSS=15]="DATA_LOSS";var Ff=null;function Pw(){return new TextEncoder}var Cw=new Bt([4294967295,4294967295],0);function Uf(n){let e=Pw().encode(n),t=new uc;return t.update(e),new Uint8Array(t.digest())}function Bf(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Bt([t,r],0),new Bt([i,s],0)]}var Qc=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new hn(`Invalid padding: ${t}`);if(r<0)throw new hn(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new hn(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new hn(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Bt.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(Bt.fromNumber(r)));return i.compare(Cw)===1&&(i=new Bt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=Uf(e),[r,i]=Bf(t);for(let s=0;s<this.hashCount;s++){let a=this.Ee(r,i,s);if(!this.de(a))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new n(s,i,t);return r.forEach(u=>a.insert(u)),a}insert(e){if(this.Ie===0)return;let t=Uf(e),[r,i]=Bf(t);for(let s=0;s<this.hashCount;s++){let a=this.Ee(r,i,s);this.Ae(a)}}Ae(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},hn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Ns=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,ii.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(z.min(),i,new ue(J),Et(),K())}},ii=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,K(),K(),K())}};var jn=class{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}},Os=class{constructor(e,t){this.targetId=e,this.me=t}},xs=class{constructor(e,t,r=Re.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Vs=class{constructor(){this.fe=0,this.ge=$f(),this.pe=Re.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=K(),t=K(),r=K();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:B()}}),new ii(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=$f()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Y(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Jc=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=Et(),this.qe=qf(),this.Qe=new ue(J)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:B()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,r=e.me.count,i=this.Je(t);if(i){let s=i.target;if(Bc(s))if(r===0){let a=new L(s.path);this.Ue(t,a,ze.newNoDocument(a,z.min()))}else Y(r===1);else{let a=this.Ye(t);if(a!==r){let u=this.Ze(e),l=u?this.Xe(u,e,a):1;if(l!==0){this.je(t);let d=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,d)}Ff?.et(function(p,I,w,R,k){var O,C,U,q,M,j;let ae={localCacheCount:p,existenceFilterCount:I.count,databaseId:w.database,projectId:w.projectId},W=I.unchangedNames;return W&&(ae.bloomFilter={applied:k===0,hashCount:(O=W?.hashCount)!==null&&O!==void 0?O:0,bitmapLength:(q=(U=(C=W?.bits)===null||C===void 0?void 0:C.bitmap)===null||U===void 0?void 0:U.length)!==null&&q!==void 0?q:0,padding:(j=(M=W?.bits)===null||M===void 0?void 0:M.padding)!==null&&j!==void 0?j:0,mightContain:E=>{var m;return(m=R?.mightContain(E))!==null&&m!==void 0&&m}}),ae}(a,e.me,this.Le.tt(),u,l))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,a,u;try{a=jt(r).toUint8Array()}catch(l){if(l instanceof Ps)return Gn("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{u=new Qc(a,i,s)}catch(l){return Gn(l instanceof hn?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return u.Ie===0?null:u}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){let r=this.Le.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let a=this.Le.tt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(u)||(this.Ue(t,s,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((s,a)=>{let u=this.Je(a);if(u){if(s.current&&Bc(u.target)){let l=new L(u.target.path);this.ke.get(l)!==null||this.it(a,l)||this.Ue(a,l,ze.newNoDocument(l,e))}s.be&&(t.set(a,s.ve()),s.Ce())}});let r=K();this.qe.forEach((s,a)=>{let u=!0;a.forEachWhile(l=>{let d=this.Je(l);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(r=r.add(s))}),this.ke.forEach((s,a)=>a.setReadTime(e));let i=new Ns(e,t,this.Qe,this.ke,r);return this.ke=Et(),this.qe=qf(),this.Qe=new ue(J),i}$e(e,t){if(!this.ze(e))return;let r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Vs,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new be(J),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||V("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Vs),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function qf(){return new ue(L.comparator)}function $f(){return new ue(L.comparator)}var kw={asc:"ASCENDING",desc:"DESCENDING"},Dw={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Nw={and:"AND",or:"OR"},Yc=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Xc(n,e){return n.useProto3Json||io(e)?e:{value:e}}function Ls(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Pp(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Ow(n,e){return Ls(n,e.toTimestamp())}function et(n){return Y(!!n),z.fromTimestamp(function(t){let r=wt(t);return new _e(r.seconds,r.nanos)}(n))}function rl(n,e){return Zc(n,e).canonicalString()}function Zc(n,e){let t=function(i){return new se(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function Cp(n){let e=se.fromString(n);return Y(xp(e)),e}function eu(n,e){return rl(n.databaseId,e.path)}function mc(n,e){let t=Cp(e);if(t.get(1)!==n.databaseId.projectId)throw new x(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new x(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new L(Dp(t))}function kp(n,e){return rl(n.databaseId,e)}function xw(n){let e=Cp(n);return e.length===4?se.emptyPath():Dp(e)}function tu(n){return new se(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Dp(n){return Y(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function jf(n,e,t){return{name:eu(n,e),fields:t.value.mapValue.fields}}function Vw(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:B()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(d,p){return d.useProto3Json?(Y(p===void 0||typeof p=="string"),Re.fromBase64String(p||"")):(Y(p===void 0||p instanceof Buffer||p instanceof Uint8Array),Re.fromUint8Array(p||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&function(d){let p=d.code===void 0?P.UNKNOWN:Rp(d.code);return new x(p,d.message||"")}(a);t=new xs(r,i,s,u||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=mc(n,r.document.name),s=et(r.document.updateTime),a=r.document.createTime?et(r.document.createTime):z.min(),u=new Oe({mapValue:{fields:r.document.fields}}),l=ze.newFoundDocument(i,s,a,u),d=r.targetIds||[],p=r.removedTargetIds||[];t=new jn(d,p,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=mc(n,r.document),s=r.readTime?et(r.readTime):z.min(),a=ze.newNoDocument(i,s),u=r.removedTargetIds||[];t=new jn([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=mc(n,r.document),s=r.removedTargetIds||[];t=new jn([],s,i,null)}else{if(!("filter"in e))return B();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,a=new Hc(i,s),u=r.targetId;t=new Os(u,a)}}return t}function Lw(n,e){let t;if(e instanceof In)t={update:jf(n,e.key,e.value)};else if(e instanceof Ds)t={delete:eu(n,e.key)};else if(e instanceof nt)t={update:jf(n,e.key,e.data),updateMask:Gw(e.fieldMask)};else{if(!(e instanceof zc))return B();t={verify:eu(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,a){let u=a.transform;if(u instanceof Yn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof _n)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof yn)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Xn)return{fieldPath:a.field.canonicalString(),increment:u.Pe};throw B()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:Ow(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:B()}(n,e.precondition)),t}function Mw(n,e){return n&&n.length>0?(Y(e!==void 0),n.map(t=>function(i,s){let a=i.updateTime?et(i.updateTime):et(s);return a.isEqual(z.min())&&(a=et(s)),new jc(a,i.transformResults||[])}(t,e))):[]}function Fw(n,e){return{documents:[kp(n,e.path)]}}function Uw(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=kp(n,i);let s=function(d){if(d.length!==0)return Op(Ge.create(d,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let a=function(d){if(d.length!==0)return d.map(p=>function(w){return{field:Bn(w.field),direction:$w(w.dir)}}(p))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);let u=Xc(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{_t:t,parent:i}}function Bw(n){let e=xw(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){Y(r===1);let p=t.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let s=[];t.where&&(s=function(I){let w=Np(I);return w instanceof Ge&&lp(w)?w.getFilters():[w]}(t.where));let a=[];t.orderBy&&(a=function(I){return I.map(w=>function(k){return new gn(qn(k.field),function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(k.direction))}(w))}(t.orderBy));let u=null;t.limit&&(u=function(I){let w;return w=typeof I=="object"?I.value:I,io(w)?null:w}(t.limit));let l=null;t.startAt&&(l=function(I){let w=!!I.before,R=I.values||[];return new Qn(R,w)}(t.startAt));let d=null;return t.endAt&&(d=function(I){let w=!I.before,R=I.values||[];return new Qn(R,w)}(t.endAt)),dw(e,i,a,s,u,"F",l,d)}function qw(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return B()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Np(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=qn(t.unaryFilter.field);return de.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=qn(t.unaryFilter.field);return de.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=qn(t.unaryFilter.field);return de.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=qn(t.unaryFilter.field);return de.create(a,"!=",{nullValue:"NULL_VALUE"});default:return B()}}(n):n.fieldFilter!==void 0?function(t){return de.create(qn(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return B()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Ge.create(t.compositeFilter.filters.map(r=>Np(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return B()}}(t.compositeFilter.op))}(n):B()}function $w(n){return kw[n]}function jw(n){return Dw[n]}function zw(n){return Nw[n]}function Bn(n){return{fieldPath:n.canonicalString()}}function qn(n){return xe.fromServerFormat(n.fieldPath)}function Op(n){return n instanceof de?function(t){if(t.op==="=="){if(Cf(t.value))return{unaryFilter:{field:Bn(t.field),op:"IS_NAN"}};if(Pf(t.value))return{unaryFilter:{field:Bn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Cf(t.value))return{unaryFilter:{field:Bn(t.field),op:"IS_NOT_NAN"}};if(Pf(t.value))return{unaryFilter:{field:Bn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Bn(t.field),op:jw(t.op),value:t.value}}}(n):n instanceof Ge?function(t){let r=t.getFilters().map(i=>Op(i));return r.length===1?r[0]:{compositeFilter:{op:zw(t.op),filters:r}}}(n):B()}function Gw(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function xp(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var si=class n{constructor(e,t,r,i,s=z.min(),a=z.min(),u=Re.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var nu=class{constructor(e){this.ct=e}};function Ww(n){let e=Bw({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?$c(e,e.limit,"L"):e}var Ms=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(re(e.integerValue));else if("doubleValue"in e){let r=re(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),ti(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=wt(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(jt(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?ap(e)?this.dt(t,Number.MAX_SAFE_INTEGER):op(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):B()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let r=e.fields||{};this.dt(t,55);for(let i of Object.keys(r))this.Vt(i,t),this.Tt(r[i],t)}wt(e,t){var r,i;let s=e.fields||{};this.dt(t,53);let a="value",u=((i=(r=s[a].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.dt(t,15),t.At(re(u)),this.Vt(a,t),this.Tt(s[a],t)}bt(e,t){let r=e.values||[];this.dt(t,50);for(let i of r)this.Tt(i,t)}yt(e,t){this.dt(t,37),L.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};Ms.vt=new Ms;var ru=class{constructor(){this.un=new iu}addToCollectionParentIndex(e,t){return this.un.add(t),D.resolve()}getCollectionParents(e,t){return D.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return D.resolve()}deleteFieldIndex(e,t){return D.resolve()}deleteAllFieldIndexes(e){return D.resolve()}createTargetIndexes(e,t){return D.resolve()}getDocumentsMatchingTarget(e,t){return D.resolve(null)}getIndexType(e,t){return D.resolve(0)}getFieldIndexes(e,t){return D.resolve([])}getNextCollectionGroupToUpdate(e){return D.resolve(null)}getMinOffset(e,t){return D.resolve(pn.min())}getMinOffsetFromCollectionGroup(e,t){return D.resolve(pn.min())}updateCollectionGroup(e,t,r){return D.resolve()}updateIndexEntries(e,t){return D.resolve()}},iu=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new be(se.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new be(se.comparator)).toArray()}};var Yb=new Uint8Array(0);var Ye=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};Ye.DEFAULT_COLLECTION_PERCENTILE=10,Ye.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ye.DEFAULT=new Ye(41943040,Ye.DEFAULT_COLLECTION_PERCENTILE,Ye.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ye.DISABLED=new Ye(-1,0,0);var oi=class n{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new n(0)}static kn(){return new n(-1)}};var su=class{constructor(){this.changes=new Gt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ze.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?D.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var ou=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var au=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&ei(r.mutation,i,Me.empty(),_e.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,K()).next(()=>r))}getLocalViewOfDocuments(e,t,r=K()){let i=ln();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let a=Jr();return s.forEach((u,l)=>{a=a.insert(u,l.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let r=ln();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,K()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,r,i){let s=Et(),a=Zr(),u=function(){return Zr()}();return t.forEach((l,d)=>{let p=r.get(d.key);i.has(d.key)&&(p===void 0||p.mutation instanceof nt)?s=s.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),ei(p.mutation,d,p.mutation.getFieldMask(),_e.now())):a.set(d.key,Me.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((d,p)=>a.set(d,p)),t.forEach((d,p)=>{var I;return u.set(d,new ou(p,(I=a.get(d))!==null&&I!==void 0?I:null))}),u))}recalculateAndSaveOverlays(e,t){let r=Zr(),i=new ue((a,u)=>a-u),s=K();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let u of a)u.keys().forEach(l=>{let d=t.get(l);if(d===null)return;let p=r.get(l)||Me.empty();p=u.applyToLocalView(d,p),r.set(l,p);let I=(i.get(u.batchId)||K()).add(l);i=i.insert(u.batchId,I)})}).next(()=>{let a=[],u=i.getReverseIterator();for(;u.hasNext();){let l=u.getNext(),d=l.key,p=l.value,I=Ip();p.forEach(w=>{if(!s.has(w)){let R=bp(t.get(w),r.get(w));R!==null&&I.set(w,R),s=s.add(w)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,I))}return D.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(a){return L.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):pp(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):D.resolve(ln()),u=-1,l=s;return a.next(d=>D.forEach(d,(p,I)=>(u<I.largestBatchId&&(u=I.largestBatchId),s.get(p)?D.resolve():this.remoteDocumentCache.getEntry(e,p).next(w=>{l=l.insert(p,w)}))).next(()=>this.populateOverlays(e,d,s)).next(()=>this.computeViews(e,l,d,K())).next(p=>({batchId:u,changes:yp(p)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next(r=>{let i=Jr();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,a=Jr();return this.indexManager.getCollectionParents(e,s).next(u=>D.forEach(u,l=>{let d=function(I,w){return new zt(w,null,I.explicitOrderBy.slice(),I.filters.slice(),I.limit,I.limitType,I.startAt,I.endAt)}(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,d,r,i).next(p=>{p.forEach((I,w)=>{a=a.insert(I,w)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(a=>{s.forEach((l,d)=>{let p=d.getKey();a.get(p)===null&&(a=a.insert(p,ze.newInvalidDocument(p)))});let u=Jr();return a.forEach((l,d)=>{let p=s.get(l);p!==void 0&&ei(p.mutation,d,Me.empty(),_e.now()),ao(t,d)&&(u=u.insert(l,d))}),u})}};var cu=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return D.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:et(i.createTime)}}(t)),D.resolve()}getNamedQuery(e,t){return D.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(i){return{name:i.name,query:Ww(i.bundledQuery),readTime:et(i.readTime)}}(t)),D.resolve()}};var uu=class{constructor(){this.overlays=new ue(L.comparator),this.Ir=new Map}getOverlay(e,t){return D.resolve(this.overlays.get(t))}getOverlays(e,t){let r=ln();return D.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),D.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.Ir.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(r)),D.resolve()}getOverlaysForCollection(e,t,r){let i=ln(),s=t.length+1,a=new L(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let l=u.getNext().value,d=l.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===s&&l.largestBatchId>r&&i.set(l.getKey(),l)}return D.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new ue((d,p)=>d-p),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let p=s.get(d.largestBatchId);p===null&&(p=ln(),s=s.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}let u=ln(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,p)=>u.set(d,p)),!(u.size()>=i)););return D.resolve(u)}ht(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let a=this.Ir.get(i.largestBatchId).delete(r.key);this.Ir.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Kc(t,r));let s=this.Ir.get(t);s===void 0&&(s=K(),this.Ir.set(t,s)),this.Ir.set(t,s.add(r.key))}};var lu=class{constructor(){this.sessionToken=Re.EMPTY_BYTE_STRING}getSessionToken(e){return D.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,D.resolve()}};var ai=class{constructor(){this.Tr=new be(he.Er),this.dr=new be(he.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let r=new he(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new he(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){let t=new L(new se([])),r=new he(t,e),i=new he(t,e+1),s=[];return this.dr.forEachInRange([r,i],a=>{this.Vr(a),s.push(a.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new L(new se([])),r=new he(t,e),i=new he(t,e+1),s=K();return this.dr.forEachInRange([r,i],a=>{s=s.add(a.key)}),s}containsKey(e){let t=new he(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},he=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return L.comparator(e.key,t.key)||J(e.wr,t.wr)}static Ar(e,t){return J(e.wr,t.wr)||L.comparator(e.key,t.key)}};var hu=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new be(he.Er)}checkEmpty(e){return D.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new Gc(s,t,r,i);this.mutationQueue.push(a);for(let u of i)this.br=this.br.add(new he(u.key,s)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return D.resolve(a)}lookupMutationBatch(e,t){return D.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.vr(r),s=i<0?0:i;return D.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return D.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return D.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new he(t,0),i=new he(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([r,i],a=>{let u=this.Dr(a.wr);s.push(u)}),D.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new be(J);return t.forEach(i=>{let s=new he(i,0),a=new he(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,a],u=>{r=r.add(u.wr)})}),D.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;L.isDocumentKey(s)||(s=s.child(""));let a=new he(new L(s),0),u=new be(J);return this.br.forEachWhile(l=>{let d=l.key.path;return!!r.isPrefixOf(d)&&(d.length===i&&(u=u.add(l.wr)),!0)},a),D.resolve(this.Cr(u))}Cr(e){let t=[];return e.forEach(r=>{let i=this.Dr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){Y(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return D.forEach(t.mutations,i=>{let s=new he(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){let r=new he(t,0),i=this.br.firstAfterOrEqual(r);return D.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,D.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var du=class{constructor(e){this.Mr=e,this.docs=function(){return new ue(L.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,a=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return D.resolve(r?r.document.mutableCopy():ze.newInvalidDocument(t))}getEntries(e,t){let r=Et();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():ze.newInvalidDocument(i))}),D.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Et(),a=t.path,u=new L(a.child("")),l=this.docs.getIteratorFrom(u);for(;l.hasNext();){let{key:d,value:{document:p}}=l.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||tw(ew(p),r)<=0||(i.has(p.key)||ao(t,p))&&(s=s.insert(p.key,p.mutableCopy()))}return D.resolve(s)}getAllFromCollectionGroup(e,t,r,i){B()}Or(e,t){return D.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new fu(this)}getSize(e){return D.resolve(this.size)}},fu=class extends su{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(r)}),D.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var pu=class{constructor(e){this.persistence=e,this.Nr=new Gt(t=>el(t),tl),this.lastRemoteSnapshotVersion=z.min(),this.highestTargetId=0,this.Lr=0,this.Br=new ai,this.targetCount=0,this.kr=oi.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,i)=>t(i)),D.resolve()}getLastRemoteSnapshotVersion(e){return D.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return D.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),D.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),D.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new oi(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,D.resolve()}updateTargetData(e,t){return this.Kn(t),D.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,D.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.Nr.forEach((a,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.Nr.delete(a),s.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),D.waitFor(s).next(()=>i)}getTargetCount(e){return D.resolve(this.targetCount)}getTargetData(e,t){let r=this.Nr.get(t)||null;return D.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),D.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),D.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),D.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Br.yr(t);return D.resolve(r)}containsKey(e,t){return D.resolve(this.Br.containsKey(t))}};var mu=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new ip(0),this.Kr=!1,this.Kr=!0,this.$r=new lu,this.referenceDelegate=e(this),this.Ur=new pu(this),this.indexManager=new ru,this.remoteDocumentCache=function(i){return new du(i)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new nu(t),this.Gr=new cu(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new uu,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new hu(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){V("MemoryPersistence","Starting transaction:",e);let i=new gu(this.Qr.next());return this.referenceDelegate.zr(),r(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(e,t){return D.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}},gu=class extends Rc{constructor(e){super(),this.currentSequenceNumber=e}},_u=class n{constructor(e){this.persistence=e,this.Jr=new ai,this.Yr=null}static Zr(e){return new n(e)}get Xr(){if(this.Yr)return this.Yr;throw B()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),D.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),D.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),D.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(i=>this.Xr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return D.forEach(this.Xr,r=>{let i=L.fromPath(r);return this.ei(e,i).next(s=>{s||t.removeEntry(i,z.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return D.or([()=>D.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var yu=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=i}static Wi(e,t){let r=K(),i=K();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var Iu=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var vu=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return ed()?8:rw(fe())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.Yi(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.Zi(e,t,i,r).next(a=>{s.result=a})}).next(()=>{if(s.result)return;let a=new Iu;return this.Xi(e,t,a).next(u=>{if(s.result=u,this.zi)return this.es(e,t,a,u.size)})}).next(()=>s.result)}es(e,t,r,i){return r.documentReadCount<this.ji?(Qr()<=G.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",Un(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),D.resolve()):(Qr()<=G.DEBUG&&V("QueryEngine","Query:",Un(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Hi*i?(Qr()<=G.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",Un(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ze(t))):D.resolve())}Yi(e,t){if(Of(t))return D.resolve(null);let r=Ze(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=$c(t,null,"F"),r=Ze(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let a=K(...s);return this.Ji.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,r).next(l=>{let d=this.ts(t,u);return this.ns(t,d,a,l.readTime)?this.Yi(e,$c(t,null,"F")):this.rs(e,d,t,l)}))})))}Zi(e,t,r,i){return Of(t)||i.isEqual(z.min())?D.resolve(null):this.Ji.getDocuments(e,r).next(s=>{let a=this.ts(t,s);return this.ns(t,a,r,i)?D.resolve(null):(Qr()<=G.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Un(t)),this.rs(e,a,t,Zv(i,-1)).next(u=>u))})}ts(e,t){let r=new be(gp(e));return t.forEach((i,s)=>{ao(e,s)&&(r=r.add(s))}),r}ns(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(e,t,r){return Qr()<=G.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",Un(t)),this.Ji.getDocumentsMatchingQuery(e,t,pn.min(),r)}rs(e,t,r,i){return this.Ji.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}};var wu=class{constructor(e,t,r,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new ue(J),this._s=new Gt(s=>el(s),tl),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new au(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function Kw(n,e,t,r){return new wu(n,e,t,r)}function Vp(n,e){return g(this,null,function*(){let t=$(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let a=[],u=[],l=K();for(let d of i){a.push(d.batchId);for(let p of d.mutations)l=l.add(p.key)}for(let d of s){u.push(d.batchId);for(let p of d.mutations)l=l.add(p.key)}return t.localDocuments.getDocuments(r,l).next(d=>({hs:d,removedBatchIds:a,addedBatchIds:u}))})})})}function Hw(n,e){let t=$(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(u,l,d,p){let I=d.batch,w=I.keys(),R=D.resolve();return w.forEach(k=>{R=R.next(()=>p.getEntry(l,k)).next(O=>{let C=d.docVersions.get(k);Y(C!==null),O.version.compareTo(C)<0&&(I.applyToRemoteDocument(O,d),O.isValidDocument()&&(O.setReadTime(d.commitVersion),p.addEntry(O)))})}),R.next(()=>u.mutationQueue.removeMutationBatch(l,I))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(u){let l=K();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(l=l.add(u.batch.mutations[d].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function Lp(n){let e=$(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function Qw(n,e){let t=$(n),r=e.snapshotVersion,i=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let a=t.cs.newChangeBuffer({trackRemovals:!0});i=t.os;let u=[];e.targetChanges.forEach((p,I)=>{let w=i.get(I);if(!w)return;u.push(t.Ur.removeMatchingKeys(s,p.removedDocuments,I).next(()=>t.Ur.addMatchingKeys(s,p.addedDocuments,I)));let R=w.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(I)!==null?R=R.withResumeToken(Re.EMPTY_BYTE_STRING,z.min()).withLastLimboFreeSnapshotVersion(z.min()):p.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(p.resumeToken,r)),i=i.insert(I,R),function(O,C,U){return O.resumeToken.approximateByteSize()===0||C.snapshotVersion.toMicroseconds()-O.snapshotVersion.toMicroseconds()>=3e8?!0:U.addedDocuments.size+U.modifiedDocuments.size+U.removedDocuments.size>0}(w,R,p)&&u.push(t.Ur.updateTargetData(s,R))});let l=Et(),d=K();if(e.documentUpdates.forEach(p=>{e.resolvedLimboDocuments.has(p)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(s,p))}),u.push(Jw(s,a,e.documentUpdates).next(p=>{l=p.Ps,d=p.Is})),!r.isEqual(z.min())){let p=t.Ur.getLastRemoteSnapshotVersion(s).next(I=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,r));u.push(p)}return D.waitFor(u).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,d)).next(()=>l)}).then(s=>(t.os=i,s))}function Jw(n,e,t){let r=K(),i=K();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let a=Et();return t.forEach((u,l)=>{let d=s.get(u);l.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(u)),l.isNoDocument()&&l.version.isEqual(z.min())?(e.removeEntry(u,l.readTime),a=a.insert(u,l)):!d.isValidDocument()||l.version.compareTo(d.version)>0||l.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(l),a=a.insert(u,l)):V("LocalStore","Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",l.version)}),{Ps:a,Is:i}})}function Yw(n,e){let t=$(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Xw(n,e){let t=$(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Ur.getTargetData(r,e).next(s=>s?(i=s,D.resolve(i)):t.Ur.allocateTargetId(r).next(a=>(i=new si(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.os.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}function Eu(n,e,t){return g(this,null,function*(){let r=$(n),i=r.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!_i(a))throw a;V("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}r.os=r.os.remove(e),r._s.delete(i.target)})}function zf(n,e,t){let r=$(n),i=z.min(),s=K();return r.persistence.runTransaction("Execute query","readwrite",a=>function(l,d,p){let I=$(l),w=I._s.get(p);return w!==void 0?D.resolve(I.os.get(w)):I.Ur.getTargetData(d,p)}(r,a,Ze(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(a,u.targetId).next(l=>{s=l})}).next(()=>r.ss.getDocumentsMatchingQuery(a,e,t?i:z.min(),t?s:K())).next(u=>(Zw(r,pw(e),u),{documents:u,Ts:s})))}function Zw(n,e,t){let r=n.us.get(e)||z.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.us.set(e,r)}var Fs=class{constructor(){this.activeTargetIds=vw()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var Tu=class{constructor(){this.so=new Fs,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Fs,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Au=class{_o(e){}shutdown(){}};var Us=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){V("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){V("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var ws=null;function gc(){return ws===null?ws=function(){return 268435456+Math.round(2147483648*Math.random())}():ws++,"0x"+ws.toString(16)}var eE={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var bu=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var Ae="WebChannelConnection",Su=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${i}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(t,r,i,s,a){let u=gc(),l=this.xo(t,r.toUriEncodedString());V("RestConnection",`Sending RPC '${t}' ${u}:`,l,i);let d={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(d,s,a),this.No(t,l,d,i).then(p=>(V("RestConnection",`Received RPC '${t}' ${u}: `,p),p),p=>{throw Gn("RestConnection",`RPC '${t}' ${u} failed with error: `,p,"url: ",l,"request:",i),p})}Lo(t,r,i,s,a,u){return this.Mo(t,r,i,s,a)}Oo(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+rr}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,a)=>t[a]=s),i&&i.headers.forEach((s,a)=>t[a]=s)}xo(t,r){let i=eE[t];return`${this.Do}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,i){let s=gc();return new Promise((a,u)=>{let l=new lc;l.setWithCredentials(!0),l.listenOnce(hc.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case Hr.NO_ERROR:let p=l.getResponseJson();V(Ae,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(p)),a(p);break;case Hr.TIMEOUT:V(Ae,`RPC '${e}' ${s} timed out`),u(new x(P.DEADLINE_EXCEEDED,"Request time out"));break;case Hr.HTTP_ERROR:let I=l.getStatus();if(V(Ae,`RPC '${e}' ${s} failed with status:`,I,"response text:",l.getResponseText()),I>0){let w=l.getResponseJson();Array.isArray(w)&&(w=w[0]);let R=w?.error;if(R&&R.status&&R.message){let k=function(C){let U=C.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(U)>=0?U:P.UNKNOWN}(R.status);u(new x(k,R.message))}else u(new x(P.UNKNOWN,"Server responded with status "+l.getStatus()))}else u(new x(P.UNAVAILABLE,"Connection failed."));break;default:B()}}finally{V(Ae,`RPC '${e}' ${s} completed.`)}});let d=JSON.stringify(i);V(Ae,`RPC '${e}' ${s} sending request:`,i),l.send(t,"POST",d,r,15)})}Bo(e,t,r){let i=gc(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=pc(),u=fc(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(l.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;let p=s.join("");V(Ae,`Creating RPC '${e}' stream ${i}: ${p}`,l);let I=a.createWebChannel(p,l),w=!1,R=!1,k=new bu({Io:C=>{R?V(Ae,`Not sending because RPC '${e}' stream ${i} is closed:`,C):(w||(V(Ae,`Opening RPC '${e}' stream ${i} transport.`),I.open(),w=!0),V(Ae,`RPC '${e}' stream ${i} sending:`,C),I.send(C))},To:()=>I.close()}),O=(C,U,q)=>{C.listen(U,M=>{try{q(M)}catch(j){setTimeout(()=>{throw j},0)}})};return O(I,Fn.EventType.OPEN,()=>{R||(V(Ae,`RPC '${e}' stream ${i} transport opened.`),k.yo())}),O(I,Fn.EventType.CLOSE,()=>{R||(R=!0,V(Ae,`RPC '${e}' stream ${i} transport closed`),k.So())}),O(I,Fn.EventType.ERROR,C=>{R||(R=!0,Gn(Ae,`RPC '${e}' stream ${i} transport errored:`,C),k.So(new x(P.UNAVAILABLE,"The operation could not be completed")))}),O(I,Fn.EventType.MESSAGE,C=>{var U;if(!R){let q=C.data[0];Y(!!q);let M=q,j=M.error||((U=M[0])===null||U===void 0?void 0:U.error);if(j){V(Ae,`RPC '${e}' stream ${i} received error:`,j);let ae=j.status,W=function(_){let v=le[_];if(v!==void 0)return Rp(v)}(ae),E=j.message;W===void 0&&(W=P.INTERNAL,E="Unknown error status: "+ae+" with message "+j.message),R=!0,k.So(new x(W,E)),I.close()}else V(Ae,`RPC '${e}' stream ${i} received:`,q),k.bo(q)}}),O(u,dc.STAT_EVENT,C=>{C.stat===Is.PROXY?V(Ae,`RPC '${e}' stream ${i} detected buffering proxy`):C.stat===Is.NOPROXY&&V(Ae,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{k.wo()},0),k}};function _c(){return typeof document<"u"?document:null}function co(n){return new Yc(n,!0)}var Bs=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-r);i>0&&V("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var qs=class{constructor(e,t,r,i,s,a,u,l){this.ui=e,this.Ho=r,this.Jo=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Bs(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return g(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return g(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return g(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(vt(t.toString()),vt("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Yo===t&&this.P_(r,i)},r=>{e(()=>{let i=new x(P.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(i)})})}P_(e,t){let r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{r(()=>this.I_(i))}),this.stream.onMessage(i=>{r(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(()=>g(this,null,function*(){this.state=0,this.start()}))}I_(e){return V("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(V("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Ru=class extends qs{constructor(e,t,r,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=Vw(this.serializer,e),r=function(s){if(!("targetChange"in s))return z.min();let a=s.targetChange;return a.targetIds&&a.targetIds.length?z.min():a.readTime?et(a.readTime):z.min()}(e);return this.listener.d_(t,r)}A_(e){let t={};t.database=tu(this.serializer),t.addTarget=function(s,a){let u,l=a.target;if(u=Bc(l)?{documents:Fw(s,l)}:{query:Uw(s,l)._t},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=Pp(s,a.resumeToken);let d=Xc(s,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(z.min())>0){u.readTime=Ls(s,a.snapshotVersion.toTimestamp());let d=Xc(s,a.expectedCount);d!==null&&(u.expectedCount=d)}return u}(this.serializer,e);let r=qw(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){let t={};t.database=tu(this.serializer),t.removeTarget=e,this.a_(t)}},Pu=class extends qs{constructor(e,t,r,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Y(!!e.streamToken),this.lastStreamToken=e.streamToken,Y(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Y(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=Mw(e.writeResults,e.commitTime),r=et(e.commitTime);return this.listener.g_(r,t)}p_(){let e={};e.database=tu(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Lw(this.serializer,r))};this.a_(t)}};var Cu=class extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new x(P.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Mo(e,Zc(t,r),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new x(P.UNKNOWN,s.toString())})}Lo(e,t,r,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Lo(e,Zc(t,r),i,a,u,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new x(P.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},ku=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(vt(t),this.D_=!1):V("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var Du=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(a=>{r.enqueueAndForget(()=>g(this,null,function*(){wn(this)&&(V("RemoteStore","Restarting streams for network reachability change."),yield function(l){return g(this,null,function*(){let d=$(l);d.L_.add(4),yield yi(d),d.q_.set("Unknown"),d.L_.delete(4),yield uo(d)})}(this))}))}),this.q_=new ku(r,i)}};function uo(n){return g(this,null,function*(){if(wn(n))for(let e of n.B_)yield e(!0)})}function yi(n){return g(this,null,function*(){for(let e of n.B_)yield e(!1)})}function Mp(n,e){let t=$(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),al(t)?ol(t):ir(t).r_()&&sl(t,e))}function il(n,e){let t=$(n),r=ir(t);t.N_.delete(e),r.r_()&&Fp(t,e),t.N_.size===0&&(r.r_()?r.o_():wn(t)&&t.q_.set("Unknown"))}function sl(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(z.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ir(n).A_(e)}function Fp(n,e){n.Q_.xe(e),ir(n).R_(e)}function ol(n){n.Q_=new Jc({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),ir(n).start(),n.q_.v_()}function al(n){return wn(n)&&!ir(n).n_()&&n.N_.size>0}function wn(n){return $(n).L_.size===0}function Up(n){n.Q_=void 0}function tE(n){return g(this,null,function*(){n.q_.set("Online")})}function nE(n){return g(this,null,function*(){n.N_.forEach((e,t)=>{sl(n,e)})})}function rE(n,e){return g(this,null,function*(){Up(n),al(n)?(n.q_.M_(e),ol(n)):n.q_.set("Unknown")})}function iE(n,e,t){return g(this,null,function*(){if(n.q_.set("Online"),e instanceof xs&&e.state===2&&e.cause)try{yield function(i,s){return g(this,null,function*(){let a=s.cause;for(let u of s.targetIds)i.N_.has(u)&&(yield i.remoteSyncer.rejectListen(u,a),i.N_.delete(u),i.Q_.removeTarget(u))})}(n,e)}catch(r){V("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield $s(n,r)}else if(e instanceof jn?n.Q_.Ke(e):e instanceof Os?n.Q_.He(e):n.Q_.We(e),!t.isEqual(z.min()))try{let r=yield Lp(n.localStore);t.compareTo(r)>=0&&(yield function(s,a){let u=s.Q_.rt(a);return u.targetChanges.forEach((l,d)=>{if(l.resumeToken.approximateByteSize()>0){let p=s.N_.get(d);p&&s.N_.set(d,p.withResumeToken(l.resumeToken,a))}}),u.targetMismatches.forEach((l,d)=>{let p=s.N_.get(l);if(!p)return;s.N_.set(l,p.withResumeToken(Re.EMPTY_BYTE_STRING,p.snapshotVersion)),Fp(s,l);let I=new si(p.target,l,d,p.sequenceNumber);sl(s,I)}),s.remoteSyncer.applyRemoteEvent(u)}(n,t))}catch(r){V("RemoteStore","Failed to raise snapshot:",r),yield $s(n,r)}})}function $s(n,e,t){return g(this,null,function*(){if(!_i(e))throw e;n.L_.add(1),yield yi(n),n.q_.set("Offline"),t||(t=()=>Lp(n.localStore)),n.asyncQueue.enqueueRetryable(()=>g(this,null,function*(){V("RemoteStore","Retrying IndexedDB access"),yield t(),n.L_.delete(1),yield uo(n)}))})}function Bp(n,e){return e().catch(t=>$s(n,t,e))}function lo(n){return g(this,null,function*(){let e=$(n),t=Wt(e),r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;sE(e);)try{let i=yield Yw(e.localStore,r);if(i===null){e.O_.length===0&&t.o_();break}r=i.batchId,oE(e,i)}catch(i){yield $s(e,i)}qp(e)&&$p(e)})}function sE(n){return wn(n)&&n.O_.length<10}function oE(n,e){n.O_.push(e);let t=Wt(n);t.r_()&&t.V_&&t.m_(e.mutations)}function qp(n){return wn(n)&&!Wt(n).n_()&&n.O_.length>0}function $p(n){Wt(n).start()}function aE(n){return g(this,null,function*(){Wt(n).p_()})}function cE(n){return g(this,null,function*(){let e=Wt(n);for(let t of n.O_)e.m_(t.mutations)})}function uE(n,e,t){return g(this,null,function*(){let r=n.O_.shift(),i=Wc.from(r,e,t);yield Bp(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield lo(n)})}function lE(n,e){return g(this,null,function*(){e&&Wt(n).V_&&(yield function(r,i){return g(this,null,function*(){if(function(a){return Rw(a)&&a!==P.ABORTED}(i.code)){let s=r.O_.shift();Wt(r).s_(),yield Bp(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield lo(r)}})}(n,e)),qp(n)&&$p(n)})}function Gf(n,e){return g(this,null,function*(){let t=$(n);t.asyncQueue.verifyOperationInProgress(),V("RemoteStore","RemoteStore received new credentials");let r=wn(t);t.L_.add(3),yield yi(t),r&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield uo(t)})}function hE(n,e){return g(this,null,function*(){let t=$(n);e?(t.L_.delete(2),yield uo(t)):e||(t.L_.add(2),yield yi(t),t.q_.set("Unknown"))})}function ir(n){return n.K_||(n.K_=function(t,r,i){let s=$(t);return s.w_(),new Ru(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:tE.bind(null,n),Ro:nE.bind(null,n),mo:rE.bind(null,n),d_:iE.bind(null,n)}),n.B_.push(e=>g(this,null,function*(){e?(n.K_.s_(),al(n)?ol(n):n.q_.set("Unknown")):(yield n.K_.stop(),Up(n))}))),n.K_}function Wt(n){return n.U_||(n.U_=function(t,r,i){let s=$(t);return s.w_(),new Pu(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:aE.bind(null,n),mo:lE.bind(null,n),f_:cE.bind(null,n),g_:uE.bind(null,n)}),n.B_.push(e=>g(this,null,function*(){e?(n.U_.s_(),yield lo(n)):(yield n.U_.stop(),n.O_.length>0&&(V("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))}))),n.U_}var Nu=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new je,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let a=Date.now()+r,u=new n(e,t,a,i,s);return u.start(r),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function cl(n,e){if(vt("AsyncQueue",`${e}: ${n}`),_i(n))return new x(P.UNAVAILABLE,`${e}: ${n}`);throw n}var js=class n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||L.comparator(t.key,r.key):(t,r)=>L.comparator(t.key,r.key),this.keyedMap=Jr(),this.sortedSet=new ue(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var zs=class{constructor(){this.W_=new ue(L.comparator)}track(e){let t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):B():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}},er=class n{constructor(e,t,r,i,s,a,u,l,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=l,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,i,s){let a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new n(e,t,js.emptySet(t),a,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&oo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var Ou=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},xu=class{constructor(){this.queries=Wf(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){let i=$(t),s=i.queries;i.queries=Wf(),s.forEach((a,u)=>{for(let l of u.j_)l.onError(r)})})(this,new x(P.ABORTED,"Firestore shutting down"))}};function Wf(){return new Gt(n=>mp(n),oo)}function ul(n,e){return g(this,null,function*(){let t=$(n),r=3,i=e.query,s=t.queries.get(i);s?!s.H_()&&e.J_()&&(r=2):(s=new Ou,r=e.J_()?0:1);try{switch(r){case 0:s.z_=yield t.onListen(i,!0);break;case 1:s.z_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){let u=cl(a,`Initialization of query '${Un(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&hl(t)})}function ll(n,e){return g(this,null,function*(){let t=$(n),r=e.query,i=3,s=t.queries.get(r);if(s){let a=s.j_.indexOf(e);a>=0&&(s.j_.splice(a,1),s.j_.length===0?i=e.J_()?0:1:!s.H_()&&e.J_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function dE(n,e){let t=$(n),r=!1;for(let i of e){let s=i.query,a=t.queries.get(s);if(a){for(let u of a.j_)u.X_(i)&&(r=!0);a.z_=i}}r&&hl(t)}function fE(n,e,t){let r=$(n),i=r.queries.get(e);if(i)for(let s of i.j_)s.onError(t);r.queries.delete(e)}function hl(n){n.Y_.forEach(e=>{e.next()})}var Vu,Kf;(Kf=Vu||(Vu={})).ea="default",Kf.Cache="cache";var ci=class{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new er(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=er.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Vu.Cache}};var Gs=class{constructor(e){this.key=e}},Ws=class{constructor(e){this.key=e}},Lu=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=K(),this.mutatedKeys=K(),this.Aa=gp(e),this.Ra=new js(this.Aa)}get Va(){return this.Ta}ma(e,t){let r=t?t.fa:new zs,i=t?t.Ra:this.Ra,s=t?t.mutatedKeys:this.mutatedKeys,a=i,u=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((p,I)=>{let w=i.get(p),R=ao(this.query,I)?I:null,k=!!w&&this.mutatedKeys.has(w.key),O=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations),C=!1;w&&R?w.data.isEqual(R.data)?k!==O&&(r.track({type:3,doc:R}),C=!0):this.ga(w,R)||(r.track({type:2,doc:R}),C=!0,(l&&this.Aa(R,l)>0||d&&this.Aa(R,d)<0)&&(u=!0)):!w&&R?(r.track({type:0,doc:R}),C=!0):w&&!R&&(r.track({type:1,doc:w}),C=!0,(l||d)&&(u=!0)),C&&(R?(a=a.add(R),s=O?s.add(p):s.delete(p)):(a=a.delete(p),s=s.delete(p)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),s=s.delete(p.key),r.track({type:1,doc:p})}return{Ra:a,fa:r,ns:u,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let a=e.fa.G_();a.sort((p,I)=>function(R,k){let O=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return B()}};return O(R)-O(k)}(p.type,I.type)||this.Aa(p.doc,I.doc)),this.pa(r),i=i!=null&&i;let u=t&&!i?this.ya():[],l=this.da.size===0&&this.current&&!i?1:0,d=l!==this.Ea;return this.Ea=l,a.length!==0||d?{snapshot:new er(this.query,e.Ra,s,a,e.mutatedKeys,l===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:u}:{wa:u}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new zs,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=K(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});let t=[];return e.forEach(r=>{this.da.has(r)||t.push(new Ws(r))}),this.da.forEach(r=>{e.has(r)||t.push(new Gs(r))}),t}ba(e){this.Ta=e.Ts,this.da=K();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return er.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},Mu=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Fu=class{constructor(e){this.key=e,this.va=!1}},Uu=class{constructor(e,t,r,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new Gt(u=>mp(u),oo),this.Ma=new Map,this.xa=new Set,this.Oa=new ue(L.comparator),this.Na=new Map,this.La=new ai,this.Ba={},this.ka=new Map,this.qa=oi.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function pE(n,e,t=!0){return g(this,null,function*(){let r=Hp(n),i,s=r.Fa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield jp(r,e,t,!0),i})}function mE(n,e){return g(this,null,function*(){let t=Hp(n);yield jp(t,e,!0,!1)})}function jp(n,e,t,r){return g(this,null,function*(){let i=yield Xw(n.localStore,Ze(e)),s=i.targetId,a=n.sharedClientState.addLocalQueryTarget(s,t),u;return r&&(u=yield gE(n,e,s,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&Mp(n.remoteStore,i),u})}function gE(n,e,t,r,i){return g(this,null,function*(){n.Ka=(I,w,R)=>function(O,C,U,q){return g(this,null,function*(){let M=C.view.ma(U);M.ns&&(M=yield zf(O.localStore,C.query,!1).then(({documents:E})=>C.view.ma(E,M)));let j=q&&q.targetChanges.get(C.targetId),ae=q&&q.targetMismatches.get(C.targetId)!=null,W=C.view.applyChanges(M,O.isPrimaryClient,j,ae);return Qf(O,C.targetId,W.wa),W.snapshot})}(n,I,w,R);let s=yield zf(n.localStore,e,!0),a=new Lu(e,s.Ts),u=a.ma(s.documents),l=ii.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),d=a.applyChanges(u,n.isPrimaryClient,l);Qf(n,t,d.wa);let p=new Mu(e,t,a);return n.Fa.set(e,p),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),d.snapshot})}function _E(n,e,t){return g(this,null,function*(){let r=$(n),i=r.Fa.get(e),s=r.Ma.get(i.targetId);if(s.length>1)return r.Ma.set(i.targetId,s.filter(a=>!oo(a,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Eu(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&il(r.remoteStore,i.targetId),Bu(r,i.targetId)}).catch(gi))):(Bu(r,i.targetId),yield Eu(r.localStore,i.targetId,!0))})}function yE(n,e){return g(this,null,function*(){let t=$(n),r=t.Fa.get(e),i=t.Ma.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),il(t.remoteStore,r.targetId))})}function IE(n,e,t){return g(this,null,function*(){let r=SE(n);try{let i=yield function(a,u){let l=$(a),d=_e.now(),p=u.reduce((R,k)=>R.add(k.key),K()),I,w;return l.persistence.runTransaction("Locally write mutations","readwrite",R=>{let k=Et(),O=K();return l.cs.getEntries(R,p).next(C=>{k=C,k.forEach((U,q)=>{q.isValidDocument()||(O=O.add(U))})}).next(()=>l.localDocuments.getOverlayedDocuments(R,k)).next(C=>{I=C;let U=[];for(let q of u){let M=Sw(q,I.get(q.key).overlayedDocument);M!=null&&U.push(new nt(q.key,M,cp(M.value.mapValue),qt.exists(!0)))}return l.mutationQueue.addMutationBatch(R,d,U,u)}).next(C=>{w=C;let U=C.applyToLocalDocumentSet(I,O);return l.documentOverlayCache.saveOverlays(R,C.batchId,U)})}).then(()=>({batchId:w.batchId,changes:yp(I)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(a,u,l){let d=a.Ba[a.currentUser.toKey()];d||(d=new ue(J)),d=d.insert(u,l),a.Ba[a.currentUser.toKey()]=d}(r,i.batchId,t),yield Ii(r,i.changes),yield lo(r.remoteStore)}catch(i){let s=cl(i,"Failed to persist write");t.reject(s)}})}function zp(n,e){return g(this,null,function*(){let t=$(n);try{let r=yield Qw(t.localStore,e);e.targetChanges.forEach((i,s)=>{let a=t.Na.get(s);a&&(Y(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.va=!0:i.modifiedDocuments.size>0?Y(a.va):i.removedDocuments.size>0&&(Y(a.va),a.va=!1))}),yield Ii(t,r,e)}catch(r){yield gi(r)}})}function Hf(n,e,t){let r=$(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Fa.forEach((s,a)=>{let u=a.view.Z_(e);u.snapshot&&i.push(u.snapshot)}),function(a,u){let l=$(a);l.onlineState=u;let d=!1;l.queries.forEach((p,I)=>{for(let w of I.j_)w.Z_(u)&&(d=!0)}),d&&hl(l)}(r.eventManager,e),i.length&&r.Ca.d_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function vE(n,e,t){return g(this,null,function*(){let r=$(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Na.get(e),s=i&&i.key;if(s){let a=new ue(L.comparator);a=a.insert(s,ze.newNoDocument(s,z.min()));let u=K().add(s),l=new Ns(z.min(),new Map,new ue(J),a,u);yield zp(r,l),r.Oa=r.Oa.remove(s),r.Na.delete(e),dl(r)}else yield Eu(r.localStore,e,!1).then(()=>Bu(r,e,t)).catch(gi)})}function wE(n,e){return g(this,null,function*(){let t=$(n),r=e.batch.batchId;try{let i=yield Hw(t.localStore,e);Wp(t,r,null),Gp(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Ii(t,i)}catch(i){yield gi(i)}})}function EE(n,e,t){return g(this,null,function*(){let r=$(n);try{let i=yield function(a,u){let l=$(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let p;return l.mutationQueue.lookupMutationBatch(d,u).next(I=>(Y(I!==null),p=I.keys(),l.mutationQueue.removeMutationBatch(d,I))).next(()=>l.mutationQueue.performConsistencyCheck(d)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(d,p,u)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p)).next(()=>l.localDocuments.getDocuments(d,p))})}(r.localStore,e);Wp(r,e,t),Gp(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Ii(r,i)}catch(i){yield gi(i)}})}function Gp(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function Wp(n,e,t){let r=$(n),i=r.Ba[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Ba[r.currentUser.toKey()]=i}}function Bu(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||Kp(n,r)})}function Kp(n,e){n.xa.delete(e.path.canonicalString());let t=n.Oa.get(e);t!==null&&(il(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),dl(n))}function Qf(n,e,t){for(let r of t)r instanceof Gs?(n.La.addReference(r.key,e),TE(n,r)):r instanceof Ws?(V("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||Kp(n,r.key)):B()}function TE(n,e){let t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(V("SyncEngine","New document in limbo: "+t),n.xa.add(r),dl(n))}function dl(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){let e=n.xa.values().next().value;n.xa.delete(e);let t=new L(se.fromString(e)),r=n.qa.next();n.Na.set(r,new Fu(t)),n.Oa=n.Oa.insert(t,r),Mp(n.remoteStore,new si(Ze(so(t.path)),r,"TargetPurposeLimboResolution",ip.oe))}}function Ii(n,e,t){return g(this,null,function*(){let r=$(n),i=[],s=[],a=[];r.Fa.isEmpty()||(r.Fa.forEach((u,l)=>{a.push(r.Ka(l,e,t).then(d=>{var p;if((d||t)&&r.isPrimaryClient){let I=d?!d.fromCache:(p=t?.targetChanges.get(l.targetId))===null||p===void 0?void 0:p.current;r.sharedClientState.updateQueryState(l.targetId,I?"current":"not-current")}if(d){i.push(d);let I=yu.Wi(l.targetId,d);s.push(I)}}))}),yield Promise.all(a),r.Ca.d_(i),yield function(l,d){return g(this,null,function*(){let p=$(l);try{yield p.persistence.runTransaction("notifyLocalViewChanges","readwrite",I=>D.forEach(d,w=>D.forEach(w.$i,R=>p.persistence.referenceDelegate.addReference(I,w.targetId,R)).next(()=>D.forEach(w.Ui,R=>p.persistence.referenceDelegate.removeReference(I,w.targetId,R)))))}catch(I){if(!_i(I))throw I;V("LocalStore","Failed to update sequence numbers: "+I)}for(let I of d){let w=I.targetId;if(!I.fromCache){let R=p.os.get(w),k=R.snapshotVersion,O=R.withLastLimboFreeSnapshotVersion(k);p.os=p.os.insert(w,O)}}})}(r.localStore,s))})}function AE(n,e){return g(this,null,function*(){let t=$(n);if(!t.currentUser.isEqual(e)){V("SyncEngine","User change. New user:",e.toKey());let r=yield Vp(t.localStore,e);t.currentUser=e,function(s,a){s.ka.forEach(u=>{u.forEach(l=>{l.reject(new x(P.CANCELLED,a))})}),s.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Ii(t,r.hs)}})}function bE(n,e){let t=$(n),r=t.Na.get(e);if(r&&r.va)return K().add(r.key);{let i=K(),s=t.Ma.get(e);if(!s)return i;for(let a of s){let u=t.Fa.get(a);i=i.unionWith(u.view.Va)}return i}}function Hp(n){let e=$(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=zp.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=bE.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=vE.bind(null,e),e.Ca.d_=dE.bind(null,e.eventManager),e.Ca.$a=fE.bind(null,e.eventManager),e}function SE(n){let e=$(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=wE.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=EE.bind(null,e),e}var Jf=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return g(this,null,function*(){this.serializer=co(t.databaseInfo.databaseId),this.sharedClientState=this.Wa(t),this.persistence=this.Ga(t),yield this.persistence.start(),this.localStore=this.za(t),this.gcScheduler=this.ja(t,this.localStore),this.indexBackfillerScheduler=this.Ha(t,this.localStore)})}ja(t,r){return null}Ha(t,r){return null}za(t){return Kw(this.persistence,new vu,t.initialUser,this.serializer)}Ga(t){return new mu(_u.Zr,this.serializer)}Wa(t){return new Tu}terminate(){return g(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})();var RE=(()=>{class n{initialize(t,r){return g(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>Hf(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=AE.bind(null,this.syncEngine),yield hE(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new xu}()}createDatastore(t){let r=co(t.databaseInfo.databaseId),i=function(a){return new Su(a)}(t.databaseInfo);return function(a,u,l,d){return new Cu(a,u,l,d)}(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return function(i,s,a,u,l){return new Du(i,s,a,u,l)}(this.localStore,this.datastore,t.asyncQueue,r=>Hf(this.syncEngine,r,0),function(){return Us.D()?new Us:new Au}())}createSyncEngine(t,r){return function(s,a,u,l,d,p,I){let w=new Uu(s,a,u,l,d,p);return I&&(w.Qa=!0),w}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return g(this,null,function*(){var t,r;yield function(s){return g(this,null,function*(){let a=$(s);V("RemoteStore","RemoteStore shutting down."),a.L_.add(5),yield yi(a),a.k_.shutdown(),a.q_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}return n.provider={build:()=>new n},n})();var ui=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):vt("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var qu=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=pe.UNAUTHENTICATED,this.clientId=bs.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,a=>g(this,null,function*(){V("FirestoreClient","Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,a=>(V("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new je;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>g(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=cl(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function yc(n,e){return g(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),V("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>g(this,null,function*(){r.isEqual(i)||(yield Vp(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function Yf(n,e){return g(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield PE(n);V("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Gf(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Gf(e.remoteStore,i)),n._onlineComponents=e})}function PE(n){return g(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){V("FirestoreClient","Using user provided OfflineComponentProvider");try{yield yc(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(i){return i.name==="FirebaseError"?i.code===P.FAILED_PRECONDITION||i.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;Gn("Error using user provided cache. Falling back to memory cache: "+t),yield yc(n,new Jf)}}else V("FirestoreClient","Using default OfflineComponentProvider"),yield yc(n,new Jf);return n._offlineComponents})}function Qp(n){return g(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(V("FirestoreClient","Using user provided OnlineComponentProvider"),yield Yf(n,n._uninitializedComponentsProvider._online)):(V("FirestoreClient","Using default OnlineComponentProvider"),yield Yf(n,new RE))),n._onlineComponents})}function CE(n){return Qp(n).then(e=>e.syncEngine)}function Ks(n){return g(this,null,function*(){let e=yield Qp(n),t=e.eventManager;return t.onListen=pE.bind(null,e.syncEngine),t.onUnlisten=_E.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=mE.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=yE.bind(null,e.syncEngine),t})}function kE(n,e,t={}){let r=new je;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(s,a,u,l,d){let p=new ui({next:w=>{p.Za(),a.enqueueAndForget(()=>ll(s,I));let R=w.docs.has(u);!R&&w.fromCache?d.reject(new x(P.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&w.fromCache&&l&&l.source==="server"?d.reject(new x(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(w)},error:w=>d.reject(w)}),I=new ci(so(u.path),p,{includeMetadataChanges:!0,_a:!0});return ul(s,I)}(yield Ks(n),n.asyncQueue,e,t,r)})),r.promise}function DE(n,e,t={}){let r=new je;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(s,a,u,l,d){let p=new ui({next:w=>{p.Za(),a.enqueueAndForget(()=>ll(s,I)),w.fromCache&&l.source==="server"?d.reject(new x(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(w)},error:w=>d.reject(w)}),I=new ci(u,p,{includeMetadataChanges:!0,_a:!0});return ul(s,I)}(yield Ks(n),n.asyncQueue,e,t,r)})),r.promise}function Jp(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var Xf=new Map;function Yp(n,e,t){if(!t)throw new x(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function NE(n,e,t,r){if(e===!0&&r===!0)throw new x(P.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Zf(n){if(!L.isDocumentKey(n))throw new x(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function ep(n){if(L.isDocumentKey(n))throw new x(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function ho(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":B()}function Fe(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new x(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=ho(n);throw new x(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}var Hs=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new x(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new x(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}NE("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Jp((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new x(P.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},tr=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Hs({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new x(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new x(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Hs(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Ic;switch(r.type){case"firstParty":return new Tc(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new x(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return g(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=Xf.get(t);r&&(V("ComponentProvider","Removing Datastore"),Xf.delete(t),r.terminate())}(this),Promise.resolve()}};function Xp(n,e,t,r={}){var i;let s=(n=Fe(n,tr))._getSettings(),a=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==a&&Gn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),r.mockUserToken){let u,l;if(typeof r.mockUserToken=="string")u=r.mockUserToken,l=pe.MOCK_USER;else{u=Ki(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let d=r.mockUserToken.sub||r.mockUserToken.user_id;if(!d)throw new x(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new pe(d)}n._authCredentials=new vc(new As(u,l))}}var Kt=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},Se=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new $t(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},$t=class n extends Kt{constructor(e,t,r){super(e,t,so(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Se(this.firestore,null,new L(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function Zp(n,e,...t){if(n=te(n),Yp("collection","path",e),n instanceof tr){let r=se.fromString(e,...t);return ep(r),new $t(n,null,r)}{if(!(n instanceof Se||n instanceof $t))throw new x(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(se.fromString(e,...t));return ep(r),new $t(n.firestore,null,r)}}function em(n,e,...t){if(n=te(n),arguments.length===1&&(e=bs.newId()),Yp("doc","path",e),n instanceof tr){let r=se.fromString(e,...t);return Zf(r),new Se(n,null,new L(r))}{if(!(n instanceof Se||n instanceof $t))throw new x(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(se.fromString(e,...t));return Zf(r),new Se(n.firestore,n instanceof $t?n.converter:null,new L(r))}}var Qs=class{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Bs(this,"async_queue_retry"),this.Vu=()=>{let r=_c();r&&V("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;let t=_c();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;let t=_c();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});let t=new je;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}pu(){return g(this,null,function*(){if(this.Pu.length!==0){try{yield this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!_i(e))throw e;V("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}})}gu(e){let t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;let i=function(a){let u=a.message||"";return a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),u}(r);throw vt("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);let i=Nu.createAndSchedule(this,e,t,r,s=>this.yu(s));return this.Tu.push(i),i}fu(){this.Eu&&B()}verifyOperationInProgress(){}wu(){return g(this,null,function*(){let e;do e=this.mu,yield e;while(e!==this.mu)})}Su(e){for(let t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){let t=this.Tu.indexOf(e);this.Tu.splice(t,1)}};function tp(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var Tt=class extends tr{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Qs,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return g(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Qs(e),this._firestoreClient=void 0,yield e}})}};function tm(n,e){let t=typeof n=="object"?n:ht(),r=typeof n=="string"?n:e||"(default)",i=lt(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=Wi("firestore");s&&Xp(i,...s)}return i}function fo(n){if(n._terminated)throw new x(P.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||OE(n),n._firestoreClient}function OE(n){var e,t,r;let i=n._freezeSettings(),s=function(u,l,d,p){return new Pc(u,l,d,p.host,p.ssl,p.experimentalForceLongPolling,p.experimentalAutoDetectLongPolling,Jp(p.experimentalLongPollingOptions),p.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new qu(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&function(u){let l=u?._online.build();return{_offline:u?._offline.build(l),_online:l}}(n._componentsProvider))}var li=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Re.fromBase64String(e))}catch(t){throw new x(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Re.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var nr=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new x(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new xe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var hi=class{constructor(e){this._methodName=e}};var di=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new x(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new x(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return J(this._lat,e._lat)||J(this._long,e._long)}};var fi=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}};var xE=/^__.*__$/,$u=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new nt(e,this.data,this.fieldMask,t,this.fieldTransforms):new In(e,this.data,t,this.fieldTransforms)}},Js=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new nt(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function nm(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw B()}}var ju=class n{constructor(e,t,r,i,s,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Fu({path:r,xu:!1});return i.Ou(e),i}Nu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Fu({path:r,xu:!1});return i.vu(),i}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Xs(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(nm(this.Cu)&&xE.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}},zu=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||co(e)}Qu(e,t,r,i=!1){return new ju({Cu:e,methodName:t,qu:r,path:xe.emptyPath(),xu:!1,ku:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function fl(n){let e=n._freezeSettings(),t=co(n._databaseId);return new zu(n._databaseId,!!e.ignoreUndefinedProperties,t)}function VE(n,e,t,r,i,s={}){let a=n.Qu(s.merge||s.mergeFields?2:0,e,t,i);pl("Data must be an object, but it was:",a,r);let u=rm(r,a),l,d;if(s.merge)l=new Me(a.fieldMask),d=a.fieldTransforms;else if(s.mergeFields){let p=[];for(let I of s.mergeFields){let w=Gu(e,I,t);if(!a.contains(w))throw new x(P.INVALID_ARGUMENT,`Field '${w}' is specified in your field mask but missing from your input data.`);sm(p,w)||p.push(w)}l=new Me(p),d=a.fieldTransforms.filter(I=>l.covers(I.field))}else l=null,d=a.fieldTransforms;return new $u(new Oe(u),l,d)}var Ys=class n extends hi{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function LE(n,e,t,r){let i=n.Qu(1,e,t);pl("Data must be an object, but it was:",i,r);let s=[],a=Oe.empty();vn(r,(l,d)=>{let p=ml(e,l,t);d=te(d);let I=i.Nu(p);if(d instanceof Ys)s.push(p);else{let w=vi(d,I);w!=null&&(s.push(p),a.set(p,w))}});let u=new Me(s);return new Js(a,u,i.fieldTransforms)}function ME(n,e,t,r,i,s){let a=n.Qu(1,e,t),u=[Gu(e,r,t)],l=[i];if(s.length%2!=0)throw new x(P.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let w=0;w<s.length;w+=2)u.push(Gu(e,s[w])),l.push(s[w+1]);let d=[],p=Oe.empty();for(let w=u.length-1;w>=0;--w)if(!sm(d,u[w])){let R=u[w],k=l[w];k=te(k);let O=a.Nu(R);if(k instanceof Ys)d.push(R);else{let C=vi(k,O);C!=null&&(d.push(R),p.set(R,C))}}let I=new Me(d);return new Js(p,I,a.fieldTransforms)}function FE(n,e,t,r=!1){return vi(t,n.Qu(r?4:3,e))}function vi(n,e){if(im(n=te(n)))return pl("Unsupported field value:",e,n),rm(n,e);if(n instanceof hi)return function(r,i){if(!nm(i.Cu))throw i.Bu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Bu(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,i){let s=[],a=0;for(let u of r){let l=vi(u,i.Lu(a));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),a++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=te(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return ww(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=_e.fromDate(r);return{timestampValue:Ls(i.serializer,s)}}if(r instanceof _e){let s=new _e(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ls(i.serializer,s)}}if(r instanceof di)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof li)return{bytesValue:Pp(i.serializer,r._byteString)};if(r instanceof Se){let s=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(s))throw i.Bu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:rl(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof fi)return function(a,u){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(l=>{if(typeof l!="number")throw u.Bu("VectorValues must only contain numeric values.");return nl(u.serializer,l)})}}}}}}(r,i);throw i.Bu(`Unsupported field value: ${ho(r)}`)}(n,e)}function rm(n,e){let t={};return sp(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):vn(n,(r,i)=>{let s=vi(i,e.Mu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function im(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof _e||n instanceof di||n instanceof li||n instanceof Se||n instanceof hi||n instanceof fi)}function pl(n,e,t){if(!im(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=ho(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function Gu(n,e,t){if((e=te(e))instanceof nr)return e._internalPath;if(typeof e=="string")return ml(n,e);throw Xs("Field path arguments must be of type string or ",n,!1,void 0,t)}var UE=new RegExp("[~\\*/\\[\\]]");function ml(n,e,t){if(e.search(UE)>=0)throw Xs(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new nr(...e.split("."))._internalPath}catch{throw Xs(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Xs(n,e,t,r,i){let s=r&&!r.isEmpty(),a=i!==void 0,u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new x(P.INVALID_ARGUMENT,u+n+l)}function sm(n,e){return n.some(t=>t.isEqual(e))}var Zs=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Se(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Wu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(po("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Wu=class extends Zs{data(){return super.data()}};function po(n,e){return typeof e=="string"?ml(n,e):e instanceof nr?e._internalPath:e._delegate._internalPath}function om(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new x(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var pi=class{},eo=class extends pi{};function am(n,e,...t){let r=[];e instanceof pi&&r.push(e),r=r.concat(t),function(s){let a=s.filter(l=>l instanceof Ku).length,u=s.filter(l=>l instanceof to).length;if(a>1||a>0&&u>0)throw new x(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var to=class n extends eo{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return lm(e._query,t),new Kt(e.firestore,e.converter,qc(e._query,t))}_parse(e){let t=fl(e.firestore);return function(s,a,u,l,d,p,I){let w;if(d.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new x(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){rp(I,p);let R=[];for(let k of I)R.push(np(l,s,k));w={arrayValue:{values:R}}}else w=np(l,s,I)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||rp(I,p),w=FE(u,a,I,p==="in"||p==="not-in");return de.create(d,p,w)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function cm(n,e,t){let r=e,i=po("where",n);return to._create(i,r,t)}var Ku=class n extends pi{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Ge.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let a=i,u=s.getFlattenedFilters();for(let l of u)lm(a,l),a=qc(a,l)}(e._query,t),new Kt(e.firestore,e.converter,qc(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Hu=class n extends eo{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,s,a){if(i.startAt!==null)throw new x(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new x(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new gn(s,a)}(e._query,this._field,this._direction);return new Kt(e.firestore,e.converter,function(i,s){let a=i.explicitOrderBy.concat([s]);return new zt(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function um(n,e="asc"){let t=e,r=po("orderBy",n);return Hu._create(r,t)}function np(n,e,t){if(typeof(t=te(t))=="string"){if(t==="")throw new x(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!pp(e)&&t.indexOf("/")!==-1)throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(se.fromString(t));if(!L.isDocumentKey(r))throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Rf(n,new L(r))}if(t instanceof Se)return Rf(n,t._key);throw new x(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ho(t)}.`)}function rp(n,e){if(!Array.isArray(n)||n.length===0)throw new x(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function lm(n,e){let t=function(i,s){for(let a of i)for(let u of a.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new x(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new x(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Qu=class{convertValue(e,t="none"){switch(mn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return re(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(jt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw B()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return vn(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(a=>re(a.doubleValue));return new fi(s)}convertGeoPoint(e){return new di(re(e.latitude),re(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=Xu(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(ni(e));default:return null}}convertTimestamp(e){let t=wt(e);return new _e(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=se.fromString(e);Y(xp(r));let i=new Cs(r.get(1),r.get(3)),s=new L(r.popFirst(5));return i.isEqual(t)||vt(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function BE(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var dn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},no=class extends Zs{constructor(e,t,r,i,s,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new zn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(po("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},zn=class extends no{data(e={}){return super.data(e)}},ro=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new dn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new zn(this._firestore,this._userDataWriter,r.key,r,new dn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new x(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>{let l=new zn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new dn(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||u.type!==3).map(u=>{let l=new zn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new dn(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,p=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),p=a.indexOf(u.doc.key)),{type:qE(u.type),doc:l,oldIndex:d,newIndex:p}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function qE(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return B()}}function hm(n){n=Fe(n,Se);let e=Fe(n.firestore,Tt);return kE(fo(e),n._key).then(t=>gm(e,n,t))}var mi=class extends Qu{constructor(e){super(),this.firestore=e}convertBytes(e){return new li(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Se(this.firestore,null,t)}};function dm(n){n=Fe(n,Kt);let e=Fe(n.firestore,Tt),t=fo(e),r=new mi(e);return om(n._query),DE(t,n._query).then(i=>new ro(e,r,n,i))}function fm(n,e,t){n=Fe(n,Se);let r=Fe(n.firestore,Tt),i=BE(n.converter,e,t);return mm(r,[VE(fl(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,qt.none())])}function pm(n,e,t,...r){n=Fe(n,Se);let i=Fe(n.firestore,Tt),s=fl(i),a;return a=typeof(e=te(e))=="string"||e instanceof nr?ME(s,"updateDoc",n._key,e,t,r):LE(s,"updateDoc",n._key,e),mm(i,[a.toMutation(n._key,qt.exists(!0))])}function gl(n,...e){var t,r,i;n=te(n);let s={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||tp(e[a])||(s=e[a],a++);let u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(tp(e[a])){let I=e[a];e[a]=(t=I.next)===null||t===void 0?void 0:t.bind(I),e[a+1]=(r=I.error)===null||r===void 0?void 0:r.bind(I),e[a+2]=(i=I.complete)===null||i===void 0?void 0:i.bind(I)}let l,d,p;if(n instanceof Se)d=Fe(n.firestore,Tt),p=so(n._key.path),l={next:I=>{e[a]&&e[a](gm(d,n,I))},error:e[a+1],complete:e[a+2]};else{let I=Fe(n,Kt);d=Fe(I.firestore,Tt),p=I._query;let w=new mi(d);l={next:R=>{e[a]&&e[a](new ro(d,w,I,R))},error:e[a+1],complete:e[a+2]},om(n._query)}return function(w,R,k,O){let C=new ui(O),U=new ci(R,C,k);return w.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return ul(yield Ks(w),U)})),()=>{C.Za(),w.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return ll(yield Ks(w),U)}))}}(fo(d),p,u,l)}function mm(n,e){return function(r,i){let s=new je;return r.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return IE(yield CE(r),i,s)})),s.promise}(fo(n),e)}function gm(n,e,t){let r=t.docs.get(e._key),i=new mi(n);return new no(n,i,e._key,r,new dn(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(i){rr=i})(qe),Be(new ke("firestore",(r,{instanceIdentifier:i,options:s})=>{let a=r.getProvider("app").getImmediate(),u=new Tt(new wc(r.getProvider("auth-internal")),new bc(r.getProvider("app-check-internal")),function(d,p){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new x(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Cs(d.options.projectId,p)}(a,i),a);return s=Object.assign({useFetchStreams:t},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),Z(Tf,"4.7.3",e),Z(Tf,"4.7.3","esm2017")})();var mo=function(){return mo=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},mo.apply(this,arguments)};var zE={includeMetadataChanges:!1};function _l(n,e){return e===void 0&&(e=zE),new Nr(function(t){var r=gl(n,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:r}})}function _m(n){return _l(n,{includeMetadataChanges:!0})}function ym(n,e){var t;e===void 0&&(e={});var r=n.data(e);return!n.exists()||typeof r!="object"||r===null||!e.idField?r:mo(mo({},r),(t={},t[e.idField]=n.id,t))}function Im(n){return _l(n,{includeMetadataChanges:!0}).pipe(Or(function(e){return e.docs}))}function vm(n,e){return e===void 0&&(e={}),Im(n).pipe(Or(function(t){return t.map(function(r){return ym(r,e)})}))}var En=class{constructor(e){return e}},wm="firestore",yl=class{constructor(){return nn(wm)}};var Il=new kt("angularfire2.firestore-instances");function GE(n,e){let t=Vn(wm,n,e);return t&&new En(t)}function WE(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new En(r)}}var KE={provide:yl,deps:[[new ge,Il]]},HE={provide:En,useFactory:GE,deps:[[new ge,Il],$e]};function CR(n,...e){return Z("angularfire",dt.full,"fst"),Nt([HE,KE,{provide:Il,useFactory:WE(n),multi:!0,deps:[Ke,Ot,Mt,ft,[new ge,un],[new ge,Lt],...e]}])}var sr=ne(vm,!0);var go=ne(_m,!0);var rt=ne(Zp,!0);var Tn=ne(em,!0);var Em=ne(hm,!0);var Tm=ne(dm,!0);var kR=ne(tm,!0);var vl=ne(um,!0);var or=ne(am,!0);var _o=ne(fm,!0);var Am=ne(pm,!0);var yo=ne(cm,!0);var Nm="firebasestorage.googleapis.com",Om="storageBucket",JE=2*60*1e3,YE=10*60*1e3,XE=1e3;var oe=class n extends Te{constructor(e,t,r=0){super(wl(e),`Firebase Storage: ${t} (${wl(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,n.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return wl(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}},ie=function(n){return n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment",n}(ie||{});function wl(n){return"storage/"+n}function kl(){let n="An unknown error occurred, please check the error payload for server response.";return new oe(ie.UNKNOWN,n)}function ZE(n){return new oe(ie.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function eT(n){return new oe(ie.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function tT(){let n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new oe(ie.UNAUTHENTICATED,n)}function nT(){return new oe(ie.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function rT(n){return new oe(ie.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function xm(){return new oe(ie.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Vm(){return new oe(ie.CANCELED,"User canceled the upload/download.")}function iT(n){return new oe(ie.INVALID_URL,"Invalid URL '"+n+"'.")}function sT(n){return new oe(ie.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function oT(){return new oe(ie.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Om+"' property when initializing the app?")}function Lm(){return new oe(ie.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function aT(){return new oe(ie.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function cT(){return new oe(ie.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function uT(n){return new oe(ie.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Tl(n){return new oe(ie.INVALID_ARGUMENT,n)}function Mm(){return new oe(ie.APP_DELETED,"The Firebase app was deleted.")}function lT(n){return new oe(ie.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Ei(n,e){return new oe(ie.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function wi(n){throw new oe(ie.INTERNAL_ERROR,"Internal error: "+n)}var We=class n{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=n.makeFromUrl(e,t)}catch{return new n(e,"")}if(r.path==="")return r;throw sT(e)}static makeFromUrl(e,t){let r=null,i="([A-Za-z0-9.\\-_]+)";function s(j){j.path.charAt(j.path.length-1)==="/"&&(j.path_=j.path_.slice(0,-1))}let a="(/(.*))?$",u=new RegExp("^gs://"+i+a,"i"),l={bucket:1,path:3};function d(j){j.path_=decodeURIComponent(j.path)}let p="v[A-Za-z0-9_]+",I=t.replace(/[.]/g,"\\."),w="(/([^?#]*).*)?$",R=new RegExp(`^https?://${I}/${p}/b/${i}/o${w}`,"i"),k={bucket:1,path:3},O=t===Nm?"(?:storage.googleapis.com|storage.cloud.google.com)":t,C="([^?#]*)",U=new RegExp(`^https?://${O}/${i}/${C}`,"i"),M=[{regex:u,indices:l,postModify:s},{regex:R,indices:k,postModify:d},{regex:U,indices:{bucket:1,path:2},postModify:d}];for(let j=0;j<M.length;j++){let ae=M[j],W=ae.regex.exec(e);if(W){let E=W[ae.indices.bucket],m=W[ae.indices.path];m||(m=""),r=new n(E,m),ae.postModify(r);break}}if(r==null)throw iT(e);return r}},Al=class{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}};function hT(n,e,t){let r=1,i=null,s=null,a=!1,u=0;function l(){return u===2}let d=!1;function p(...C){d||(d=!0,e.apply(null,C))}function I(C){i=setTimeout(()=>{i=null,n(R,l())},C)}function w(){s&&clearTimeout(s)}function R(C,...U){if(d){w();return}if(C){w(),p.call(null,C,...U);return}if(l()||a){w(),p.call(null,C,...U);return}r<64&&(r*=2);let M;u===1?(u=2,M=0):M=(r+Math.random())*1e3,I(M)}let k=!1;function O(C){k||(k=!0,w(),!d&&(i!==null?(C||(u=2),clearTimeout(i),I(0)):C||(u=1)))}return I(0),s=setTimeout(()=>{a=!0,O(!0)},t),O}function dT(n){n(!1)}function fT(n){return n!==void 0}function pT(n){return typeof n=="function"}function mT(n){return typeof n=="object"&&!Array.isArray(n)}function Eo(n){return typeof n=="string"||n instanceof String}function bm(n){return Dl()&&n instanceof Blob}function Dl(){return typeof Blob<"u"}function Sm(n,e,t,r){if(r<e)throw Tl(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw Tl(`Invalid value for '${n}'. Expected ${t} or less.`)}function bi(n,e,t){let r=e;return t==null&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function Fm(n){let e=encodeURIComponent,t="?";for(let r in n)if(n.hasOwnProperty(r)){let i=e(r)+"="+e(n[r]);t=t+i+"&"}return t=t.slice(0,-1),t}var lr=function(n){return n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT",n}(lr||{});function Um(n,e){let t=n>=500&&n<600,i=[408,429].indexOf(n)!==-1,s=e.indexOf(n)!==-1;return t||i||s}var bl=class{constructor(e,t,r,i,s,a,u,l,d,p,I,w=!0){this.url_=e,this.method_=t,this.headers_=r,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=a,this.callback_=u,this.errorCallback_=l,this.timeout_=d,this.progressCallback_=p,this.connectionFactory_=I,this.retry=w,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((R,k)=>{this.resolve_=R,this.reject_=k,this.start_()})}start_(){let e=(r,i)=>{if(i){r(!1,new ur(!1,null,!0));return}let s=this.connectionFactory_();this.pendingConnection_=s;let a=u=>{let l=u.loaded,d=u.lengthComputable?u.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,d)};this.progressCallback_!==null&&s.addUploadProgressListener(a),s.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(a),this.pendingConnection_=null;let u=s.getErrorCode()===lr.NO_ERROR,l=s.getStatus();if(!u||Um(l,this.additionalRetryCodes_)&&this.retry){let p=s.getErrorCode()===lr.ABORT;r(!1,new ur(!1,null,p));return}let d=this.successCodes_.indexOf(l)!==-1;r(!0,new ur(d,s))})},t=(r,i)=>{let s=this.resolve_,a=this.reject_,u=i.connection;if(i.wasSuccessCode)try{let l=this.callback_(u,u.getResponse());fT(l)?s(l):s()}catch(l){a(l)}else if(u!==null){let l=kl();l.serverResponse=u.getErrorText(),this.errorCallback_?a(this.errorCallback_(u,l)):a(l)}else if(i.canceled){let l=this.appDelete_?Mm():Vm();a(l)}else{let l=xm();a(l)}};this.canceled_?t(!1,new ur(!1,null,!0)):this.backoffId_=hT(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&dT(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}},ur=class{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}};function gT(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function _T(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function yT(n,e){e&&(n["X-Firebase-GMPID"]=e)}function IT(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function vT(n,e,t,r,i,s,a=!0){let u=Fm(n.urlParams),l=n.url+u,d=Object.assign({},n.headers);return yT(d,e),gT(d,t),_T(d,s),IT(d,r),new bl(l,n.method,d,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,i,a)}function wT(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function ET(...n){let e=wT();if(e!==void 0){let t=new e;for(let r=0;r<n.length;r++)t.append(n[r]);return t.getBlob()}else{if(Dl())return new Blob(n);throw new oe(ie.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function TT(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}function AT(n){if(typeof atob>"u")throw uT("base-64");return atob(n)}var it={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},Ti=class{constructor(e,t){this.data=e,this.contentType=t||null}};function bT(n,e){switch(n){case it.RAW:return new Ti(Bm(e));case it.BASE64:case it.BASE64URL:return new Ti(qm(n,e));case it.DATA_URL:return new Ti(RT(e),PT(e))}throw kl()}function Bm(n){let e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{let s=r,a=n.charCodeAt(++t);r=65536|(s&1023)<<10|a&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function ST(n){let e;try{e=decodeURIComponent(n)}catch{throw Ei(it.DATA_URL,"Malformed data URL.")}return Bm(e)}function qm(n,e){switch(n){case it.BASE64:{let i=e.indexOf("-")!==-1,s=e.indexOf("_")!==-1;if(i||s)throw Ei(n,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case it.BASE64URL:{let i=e.indexOf("+")!==-1,s=e.indexOf("/")!==-1;if(i||s)throw Ei(n,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=AT(e)}catch(i){throw i.message.includes("polyfill")?i:Ei(n,"Invalid character found")}let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}var vo=class{constructor(e){this.base64=!1,this.contentType=null;let t=e.match(/^data:([^,]+)?,/);if(t===null)throw Ei(it.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");let r=t[1]||null;r!=null&&(this.base64=CT(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}};function RT(n){let e=new vo(n);return e.base64?qm(it.BASE64,e.rest):ST(e.rest)}function PT(n){return new vo(n).contentType}function CT(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}var wo=class n{constructor(e,t){let r=0,i="";bm(e)?(this.data_=e,r=e.size,i=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,t){if(bm(this.data_)){let r=this.data_,i=TT(r,e,t);return i===null?null:new n(i)}else{let r=new Uint8Array(this.data_.buffer,e,t-e);return new n(r,!0)}}static getBlob(...e){if(Dl()){let t=e.map(r=>r instanceof n?r.data_:r);return new n(ET.apply(null,t))}else{let t=e.map(a=>Eo(a)?bT(it.RAW,a).data:a.data_),r=0;t.forEach(a=>{r+=a.byteLength});let i=new Uint8Array(r),s=0;return t.forEach(a=>{for(let u=0;u<a.length;u++)i[s++]=a[u]}),new n(i,!0)}}uploadData(){return this.data_}};function $m(n){let e;try{e=JSON.parse(n)}catch{return null}return mT(e)?e:null}function kT(n){if(n.length===0)return null;let e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function DT(n,e){let t=e.split("/").filter(r=>r.length>0).join("/");return n.length===0?t:n+"/"+t}function jm(n){let e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}function NT(n,e){return e}var ye=class{constructor(e,t,r,i){this.server=e,this.local=t||e,this.writable=!!r,this.xform=i||NT}},Io=null;function OT(n){return!Eo(n)||n.length<2?n:jm(n)}function zm(){if(Io)return Io;let n=[];n.push(new ye("bucket")),n.push(new ye("generation")),n.push(new ye("metageneration")),n.push(new ye("name","fullPath",!0));function e(s,a){return OT(a)}let t=new ye("name");t.xform=e,n.push(t);function r(s,a){return a!==void 0?Number(a):a}let i=new ye("size");return i.xform=r,n.push(i),n.push(new ye("timeCreated")),n.push(new ye("updated")),n.push(new ye("md5Hash",null,!0)),n.push(new ye("cacheControl",null,!0)),n.push(new ye("contentDisposition",null,!0)),n.push(new ye("contentEncoding",null,!0)),n.push(new ye("contentLanguage",null,!0)),n.push(new ye("contentType",null,!0)),n.push(new ye("metadata","customMetadata",!0)),Io=n,Io}function xT(n,e){function t(){let r=n.bucket,i=n.fullPath,s=new We(r,i);return e._makeStorageReference(s)}Object.defineProperty(n,"ref",{get:t})}function VT(n,e,t){let r={};r.type="file";let i=t.length;for(let s=0;s<i;s++){let a=t[s];r[a.local]=a.xform(r,e[a.server])}return xT(r,n),r}function Gm(n,e,t){let r=$m(e);return r===null?null:VT(n,r,t)}function LT(n,e,t,r){let i=$m(e);if(i===null||!Eo(i.downloadTokens))return null;let s=i.downloadTokens;if(s.length===0)return null;let a=encodeURIComponent;return s.split(",").map(d=>{let p=n.bucket,I=n.fullPath,w="/b/"+a(p)+"/o/"+a(I),R=bi(w,t,r),k=Fm({alt:"media",token:d});return R+k})[0]}function Wm(n,e){let t={},r=e.length;for(let i=0;i<r;i++){let s=e[i];s.writable&&(t[s.server]=n[s.local])}return JSON.stringify(t)}var Ht=class{constructor(e,t,r,i){this.url=e,this.method=t,this.handler=r,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}};function At(n){if(!n)throw kl()}function Nl(n,e){function t(r,i){let s=Gm(n,i,e);return At(s!==null),s}return t}function MT(n,e){function t(r,i){let s=Gm(n,i,e);return At(s!==null),LT(s,i,n.host,n._protocol)}return t}function Si(n){function e(t,r){let i;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?i=nT():i=tT():t.getStatus()===402?i=eT(n.bucket):t.getStatus()===403?i=rT(n.path):i=r,i.status=t.getStatus(),i.serverResponse=r.serverResponse,i}return e}function Km(n){let e=Si(n);function t(r,i){let s=e(r,i);return r.getStatus()===404&&(s=ZE(n.path)),s.serverResponse=i.serverResponse,s}return t}function FT(n,e,t){let r=e.fullServerUrl(),i=bi(r,n.host,n._protocol),s="GET",a=n.maxOperationRetryTime,u=new Ht(i,s,Nl(n,t),a);return u.errorHandler=Km(e),u}function UT(n,e,t){let r=e.fullServerUrl(),i=bi(r,n.host,n._protocol),s="GET",a=n.maxOperationRetryTime,u=new Ht(i,s,MT(n,t),a);return u.errorHandler=Km(e),u}function BT(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function Hm(n,e,t){let r=Object.assign({},t);return r.fullPath=n.path,r.size=e.size(),r.contentType||(r.contentType=BT(null,e)),r}function qT(n,e,t,r,i){let s=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"};function u(){let M="";for(let j=0;j<2;j++)M=M+Math.random().toString().slice(2);return M}let l=u();a["Content-Type"]="multipart/related; boundary="+l;let d=Hm(e,r,i),p=Wm(d,t),I="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+p+`\r
--`+l+`\r
Content-Type: `+d.contentType+`\r
\r
`,w=`\r
--`+l+"--",R=wo.getBlob(I,r,w);if(R===null)throw Lm();let k={name:d.fullPath},O=bi(s,n.host,n._protocol),C="POST",U=n.maxUploadRetryTime,q=new Ht(O,C,Nl(n,t),U);return q.urlParams=k,q.headers=a,q.body=R.uploadData(),q.errorHandler=Si(e),q}var hr=class{constructor(e,t,r,i){this.current=e,this.total=t,this.finalized=!!r,this.metadata=i||null}};function Ol(n,e){let t=null;try{t=n.getResponseHeader("X-Goog-Upload-Status")}catch{At(!1)}return At(!!t&&(e||["active"]).indexOf(t)!==-1),t}function $T(n,e,t,r,i){let s=e.bucketOnlyServerUrl(),a=Hm(e,r,i),u={name:a.fullPath},l=bi(s,n.host,n._protocol),d="POST",p={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},I=Wm(a,t),w=n.maxUploadRetryTime;function R(O){Ol(O);let C;try{C=O.getResponseHeader("X-Goog-Upload-URL")}catch{At(!1)}return At(Eo(C)),C}let k=new Ht(l,d,R,w);return k.urlParams=u,k.headers=p,k.body=I,k.errorHandler=Si(e),k}function jT(n,e,t,r){let i={"X-Goog-Upload-Command":"query"};function s(d){let p=Ol(d,["active","final"]),I=null;try{I=d.getResponseHeader("X-Goog-Upload-Size-Received")}catch{At(!1)}I||At(!1);let w=Number(I);return At(!isNaN(w)),new hr(w,r.size(),p==="final")}let a="POST",u=n.maxUploadRetryTime,l=new Ht(t,a,s,u);return l.headers=i,l.errorHandler=Si(e),l}var Rm=256*1024;function zT(n,e,t,r,i,s,a,u){let l=new hr(0,0);if(a?(l.current=a.current,l.total=a.total):(l.current=0,l.total=r.size()),r.size()!==l.total)throw aT();let d=l.total-l.current,p=d;i>0&&(p=Math.min(p,i));let I=l.current,w=I+p,R="";p===0?R="finalize":d===p?R="upload, finalize":R="upload";let k={"X-Goog-Upload-Command":R,"X-Goog-Upload-Offset":`${l.current}`},O=r.slice(I,w);if(O===null)throw Lm();function C(j,ae){let W=Ol(j,["active","final"]),E=l.current+p,m=r.size(),_;return W==="final"?_=Nl(e,s)(j,ae):_=null,new hr(E,m,W==="final",_)}let U="POST",q=e.maxUploadRetryTime,M=new Ht(t,U,C,q);return M.headers=k,M.body=O.uploadData(),M.progressCallback=u||null,M.errorHandler=Si(n),M}var De={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function El(n){switch(n){case"running":case"pausing":case"canceling":return De.RUNNING;case"paused":return De.PAUSED;case"success":return De.SUCCESS;case"canceled":return De.CANCELED;case"error":return De.ERROR;default:return De.ERROR}}var Sl=class{constructor(e,t,r){if(pT(e)||t!=null||r!=null)this.next=e,this.error=t??void 0,this.complete=r??void 0;else{let s=e;this.next=s.next,this.error=s.error,this.complete=s.complete}}};function ar(n){return(...e)=>{Promise.resolve().then(()=>n(...e))}}var Pm=null,Rl=class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=lr.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=lr.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=lr.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,i){if(this.sent_)throw wi("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),i!==void 0)for(let s in i)i.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,i[s].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw wi("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw wi("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw wi("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw wi("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}},Pl=class extends Rl{initXhr(){this.xhr_.responseType="text"}};function cr(){return Pm?Pm():new Pl}var Cl=class{constructor(e,t,r=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=r,this._mappings=zm(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=i=>{if(this._request=void 0,this._chunkMultiplier=1,i._codeEquals(ie.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{let s=this.isExponentialBackoffExpired();if(Um(i.status,[]))if(s)i=xm();else{this.sleepTime=Math.max(this.sleepTime*2,XE),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=i,this._transition("error")}},this._metadataErrorHandler=i=>{this._request=void 0,i._codeEquals(ie.CANCELED)?this.completeTransitions_():(this._error=i,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((i,s)=>{this._resolve=i,this._reject=s,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){let e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([t,r])=>{switch(this._state){case"running":e(t,r);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,t)=>{let r=$T(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(r,cr,e,t);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._uploadUrl=s,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){let e=this._uploadUrl;this._resolveToken((t,r)=>{let i=jT(this._ref.storage,this._ref._location,e,this._blob),s=this._ref.storage._makeRequest(i,cr,t,r);this._request=s,s.getPromise().then(a=>{a=a,this._request=void 0,this._updateProgress(a.current),this._needToFetchStatus=!1,a.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){let e=Rm*this._chunkMultiplier,t=new hr(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken((i,s)=>{let a;try{a=zT(this._ref._location,this._ref.storage,r,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(l){this._error=l,this._transition("error");return}let u=this._ref.storage._makeRequest(a,cr,i,s,!1);this._request=u,u.getPromise().then(l=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(l.current),l.finalized?(this._metadata=l.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){Rm*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{let r=FT(this._ref.storage,this._ref._location,this._mappings),i=this._ref.storage._makeRequest(r,cr,e,t);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{let r=qT(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(r,cr,e,t);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){let t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":let t=this._state==="paused";this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=Vm(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){let e=El(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,r,i){let s=new Sl(t||void 0,r||void 0,i||void 0);return this._addObserver(s),()=>{this._removeObserver(s)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){let t=this._observers.indexOf(e);t!==-1&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(t=>{this._notifyObserver(t)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(El(this._state)){case De.SUCCESS:ar(this._resolve.bind(null,this.snapshot))();break;case De.CANCELED:case De.ERROR:let t=this._reject;ar(t.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(El(this._state)){case De.RUNNING:case De.PAUSED:e.next&&ar(e.next.bind(e,this.snapshot))();break;case De.SUCCESS:e.complete&&ar(e.complete.bind(e))();break;case De.CANCELED:case De.ERROR:e.error&&ar(e.error.bind(e,this._error))();break;default:e.error&&ar(e.error.bind(e,this._error))()}}resume(){let e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){let e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){let e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}};var dr=class n{constructor(e,t){this._service=e,t instanceof We?this._location=t:this._location=We.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new n(e,t)}get root(){let e=new We(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return jm(this._location.path)}get storage(){return this._service}get parent(){let e=kT(this._location.path);if(e===null)return null;let t=new We(this._location.bucket,e);return new n(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw lT(e)}};function GT(n,e,t){return n._throwIfRoot("uploadBytesResumable"),new Cl(n,new wo(e),t)}function WT(n){n._throwIfRoot("getDownloadURL");let e=UT(n.storage,n._location,zm());return n.storage.makeRequestWithTokens(e,cr).then(t=>{if(t===null)throw cT();return t})}function KT(n,e){let t=DT(n._location.path,e),r=new We(n._location.bucket,t);return new dr(n.storage,r)}function HT(n){return/^[A-Za-z]+:\/\//.test(n)}function QT(n,e){return new dr(n,e)}function Qm(n,e){if(n instanceof Ai){let t=n;if(t._bucket==null)throw oT();let r=new dr(t,t._bucket);return e!=null?Qm(r,e):r}else return e!==void 0?KT(n,e):n}function JT(n,e){if(e&&HT(e)){if(n instanceof Ai)return QT(n,e);throw Tl("To use ref(service, url), the first argument must be a Storage instance.")}else return Qm(n,e)}function Cm(n,e){let t=e?.[Om];return t==null?null:We.makeFromBucketSpec(t,n)}function YT(n,e,t,r={}){n.host=`${e}:${t}`,n._protocol="http";let{mockUserToken:i}=r;i&&(n._overrideAuthToken=typeof i=="string"?i:Ki(i,n.app.options.projectId))}var Ai=class{constructor(e,t,r,i,s){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=Nm,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=JE,this._maxUploadRetryTime=YE,this._requests=new Set,i!=null?this._bucket=We.makeFromBucketSpec(i,this._host):this._bucket=Cm(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=We.makeFromBucketSpec(this._url,e):this._bucket=Cm(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Sm("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Sm("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){return g(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=yield e.getToken();if(t!==null)return t.accessToken}return null})}_getAppCheckToken(){return g(this,null,function*(){let e=this._appCheckProvider.getImmediate({optional:!0});return e?(yield e.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new dr(this,e)}_makeRequest(e,t,r,i,s=!0){if(this._deleted)return new Al(Mm());{let a=vT(e,this._appId,r,i,t,this._firebaseVersion,s);return this._requests.add(a),a.getPromise().then(()=>this._requests.delete(a),()=>this._requests.delete(a)),a}}makeRequestWithTokens(e,t){return g(this,null,function*(){let[r,i]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,i).getPromise()})}},km="@firebase/storage",Dm="0.13.2";var Jm="storage";function Ym(n,e,t){return n=te(n),GT(n,e,t)}function Xm(n){return n=te(n),WT(n)}function Zm(n,e){return n=te(n),JT(n,e)}function eg(n=ht(),e){n=te(n);let r=lt(n,Jm).getImmediate({identifier:e}),i=Wi("storage");return i&&tg(r,...i),r}function tg(n,e,t,r={}){YT(n,e,t,r)}function XT(n,{instanceIdentifier:e}){let t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),i=n.getProvider("app-check-internal");return new Ai(t,r,i,e,qe)}function ZT(){Be(new ke(Jm,XT,"PUBLIC").setMultipleInstances(!0)),Z(km,Dm,""),Z(km,Dm,"esm2017")}ZT();var An=class{constructor(e){return e}},ng="storage",xl=class{constructor(){return nn(ng)}};var Vl=new kt("angularfire2.storage-instances");function eA(n,e){let t=Vn(ng,n,e);return t&&new An(t)}function tA(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new An(r)}}var nA={provide:xl,deps:[[new ge,Vl]]},rA={provide:An,useFactory:eA,deps:[[new ge,Vl],$e]};function n0(n,...e){return Z("angularfire",dt.full,"gcs"),Nt([rA,nA,{provide:Vl,useFactory:tA(n),multi:!0,deps:[Ke,Ot,Mt,ft,[new ge,un],[new ge,Lt],...e]}])}var rg=ne(Xm,!0);var r0=ne(eg,!0);var ig=ne(Zm,!0);var sg=ne(Ym,!0);var To=class n{constructor(e,t){this.firestore=e;this.storage=t}obtenerDatosUsuario(e){return Em(Tn(this.firestore,"usuarios",e))}asignarDatosUsuario(e){let t=Tn(this.firestore,"usuarios",e);return go(t).pipe(Or(r=>{if(go.exists())return go.data()}))}obtenerUsuarios(){let e=rt(this.firestore,"usuarios"),t=or(e,vl("tipo","desc"));return sr(t,{idField:"id"})}obtenerEspecialistas(){let e=rt(this.firestore,"usuarios"),t=or(e,yo("tipo","==","especialista"));return sr(t,{idField:"id"})}obtenerPacientes(){let e=rt(this.firestore,"usuarios"),t=or(e,yo("tipo","==","paciente"));return sr(t,{idField:"id"})}obtenerEspecialidades(){let e=rt(this.firestore,"especialidades");return sr(e,{idField:"id"})}agregarEspecialidad(e){let t=rt(this.firestore,"especialidades"),r=Tn(t),i=r.id;_o(r,{id:i,nombre:e})}agregarUsuario(e){return g(this,null,function*(){let t=rt(this.firestore,"usuarios");e.imagen1=yield this.subirArchivos(e.imagen1,e.id+"-1"),e.imagen2&&(e.imagen2=yield this.subirArchivos(e.imagen2,e.id+"-2"));let r=Tn(t,e.id);_o(r,e)})}cambiarEstado(e,t){let r=Tn(this.firestore,"usuarios",e);return Am(r,{habilitado:t})}subirArchivos(e,t){return g(this,null,function*(){let r=ig(this.storage,`imagenes/${t}`),i=yield sg(r,e);return yield rg(r)})}usuarioExiste(e){return g(this,null,function*(){let t=rt(this.firestore,"usuarios"),r=or(t,yo("email","==",e));return(yield Tm(r)).size!==0})}generarLog(e){if(e){let t=rt(this.firestore,"logs"),r=Tn(t),i=r.id;_o(r,{id:i,idUsuario:e.id,nombre:e.nombre+" "+e.apellido,dni:e.dni,tipo:e.tipo,fecha:new Date().toUTCString()})}}obtenerLogs(){let e=rt(this.firestore,"logs"),t=or(e,vl("fecha","asc"));return sr(t,{idField:"id"})}static \u0275fac=function(t){return new(t||n)(Dt(En),Dt(An))};static \u0275prov=Cn({token:n,factory:n.\u0275fac,providedIn:"root"})};var og=class n{constructor(e,t){this.db=e;this.auth=t}datos=void 0;sub;obtenerDatos(){return new Promise((e,t)=>{this.db.obtenerDatosUsuario(this.auth.currentUser?.uid).then(r=>{r.exists()&&(this.datos=r.data(),e(this.datos))}).catch(r=>t(r))})}vincularDatos(e){this.sub||(this.sub=this.db.asignarDatosUsuario(e).subscribe(t=>{this.datos=t}))}cerrarSesion(){this.datos=void 0,this.auth.signOut(),this.sub&&(this.sub.unsubscribe(),this.sub=void 0)}static \u0275fac=function(t){return new(t||n)(Dt(To),Dt(cn))};static \u0275prov=Cn({token:n,factory:n.\u0275fac,providedIn:"root"})};export{zg as a,Wg as b,ct as c,oA as d,rd as e,ke as f,xt as g,Mr as h,_a as i,z_ as j,Be as k,qe as l,Yi as m,wa as n,Z as o,vd as p,wd as q,ey as r,FA as s,UA as t,cn as u,Nb as v,Ob as w,xb as x,Vb as y,Lb as z,CR as A,kR as B,n0 as C,r0 as D,To as E,og as F};
